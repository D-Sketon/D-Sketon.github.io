var getRealPath=(e=window.location.pathname,t=!1)=>{const a=e.split("/").filter(c=>(c=c.trim()).length>0&&c!=="/"&&c!=="index.html");return t?a[0]||"/":a[a.length-1]||"/"},scrollIntoViewAndWait=e=>new Promise(t=>{"onscrollend"in window?(document.addEventListener("scrollend",t,{once:!0}),e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})):(e.scrollIntoView({block:"center",inline:"center"}),t())});_$$(".article-entry h1>a, .article-entry h2>a, .article-entry h3>a, .article-entry h4>a, .article-entry h5>a, .article-entry h6>a").forEach(e=>{window.REIMU_CONFIG.icon_font?e.innerHTML=window.REIMU_CONFIG.anchor_icon?`&#x${window.REIMU_CONFIG.anchor_icon};`:window.REIMU_CONFIG.anchor_icon===!1?"":"&#xe635;":e.innerHTML=window.REIMU_CONFIG.anchor_icon?`&#x${window.REIMU_CONFIG.anchor_icon};`:window.REIMU_CONFIG.anchor_icon===!1?"":"&#xf292;"}),_$$(".article-entry img").forEach(e=>{if(e.parentElement.classList.contains("friend-icon")||e.parentElement.tagName==="A"||e.classList.contains("no-lightbox"))return;const t=document.createElement("a");t.href?t.href=e.src:t.setAttribute("href",e.src),e.naturalWidth||e.naturalHeight?(t.dataset.pswpWidth=e.naturalWidth,t.dataset.pswpHeight=e.naturalHeight):(console.warn("Image naturalWidth and naturalHeight cannot be obtained right now, fallback to onload."),e.onload=()=>{t.dataset.pswpWidth=e.naturalWidth,t.dataset.pswpHeight=e.naturalHeight}),t.target="_blank",t.classList.add("article-gallery-item"),e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),t.appendChild(e)}),window.lightboxStatus="ready",window.dispatchEvent(new Event("lightbox:ready"));var isMobileNavAnim=!1;_$("#main-nav-toggle").off("click").on("click",()=>{isMobileNavAnim||(isMobileNavAnim=!0,document.body.classList.toggle("mobile-nav-on"),_$("#mask").classList.remove("hide"),setTimeout(()=>{isMobileNavAnim=!1},300))}),_$("#mask")?.off("click").on("click",()=>{!isMobileNavAnim&&document.body.classList.contains("mobile-nav-on")&&(document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide"))}),_$$(".sidebar-toc-btn").forEach(e=>{e.off("click").on("click",function(){this.classList.contains("current")||(_$$(".sidebar-toc-btn").forEach(t=>t.classList.add("current")),_$$(".sidebar-common-btn").forEach(t=>t.classList.remove("current")),_$$(".sidebar-toc-sidebar").forEach(t=>t.classList.remove("hidden")),_$$(".sidebar-common-sidebar").forEach(t=>t.classList.add("hidden")))})}),_$$(".sidebar-common-btn").forEach(e=>{e.off("click").on("click",function(){this.classList.contains("current")||(_$$(".sidebar-common-btn").forEach(t=>t.classList.add("current")),_$$(".sidebar-toc-btn").forEach(t=>t.classList.remove("current")),_$$(".sidebar-common-sidebar").forEach(t=>t.classList.remove("hidden")),_$$(".sidebar-toc-sidebar").forEach(t=>t.classList.add("hidden")))})}),(()=>{const e=getRealPath(window.location.pathname);_$$(".sidebar-menu-link-wrap").forEach(t=>{let a=t.querySelector("a").getAttribute("href");a&&getRealPath(a)===e&&t.classList.add("link-active")})})(),_$$(".article-entry img").forEach(e=>{e.classList.contains("lazyload")||(e.classList.add("lazyload"),e.setAttribute("data-src",e.src),e.setAttribute("data-sizes","auto"),e.removeAttribute("src"))});var __sidebarTopScrollHandler,sidebarTop=_$(".sidebar-top");function tocInit(){if(!_$("#sidebar"))return;const e=getComputedStyle(_$("#sidebar")).display==="block"?_$$("#sidebar .sidebar-toc-wrapper li"):_$$("#mobile-nav .sidebar-toc-wrapper li");if(!e.length)return;let t=null;const a=(r,o)=>{r.preventDefault();const i=document.getElementById(decodeURI(r.currentTarget.getAttribute("href")).slice(1));t=o,scrollIntoViewAndWait(i).then(()=>{d(o),t=null})},c=[...e].map((r,o)=>{const i=r.querySelector("a.toc-link");i.off("click").on("click",l=>a(l,o));const n=document.getElementById(decodeURI(i.getAttribute("href")).slice(1));return n?(n.querySelector("a")?.off("click").on("click",l=>a(l,o)),n):null}),d=r=>{const o=e[r];if(!o||o.classList.contains("current"))return;_$$(".sidebar-toc-wrapper .active").forEach(n=>{n.classList.remove("active","current")}),c.forEach(n=>{n?.classList.remove("active")}),o.classList.add("active","current"),c[r]?.classList.add("active");let i=o.parentNode;for(;!i.matches(".sidebar-toc-sidebar");){if(i.matches("li")){i.classList.add("active");const n=document.getElementById(decodeURI(i.querySelector("a.toc-link").getAttribute("href").slice(1)));n&&n.classList.add("active")}i=i.parentNode}if(!_$(".sidebar-toc-sidebar").classList.contains("hidden")){const n=_$(".sidebar-toc-wrapper");n.scrollTo({top:n.scrollTop+o.offsetTop-n.offsetHeight/2,behavior:"smooth"})}},h=new IntersectionObserver(r=>{const o=(i=>{let n=0,s=i[n];if(s.boundingClientRect.top>0)return n=c.indexOf(s.target),n===0?0:n-1;for(;n<i.length;n++){if(!(i[n].boundingClientRect.top<=0))return c.indexOf(s.target);s=i[n]}return c.indexOf(s.target)})(r)+(window.diffY>0?1:0);t===null&&d(o)},{rootMargin:"0px 0px -100% 0px",threshold:0});c.forEach(r=>{r&&h.observe(r)})}sidebarTop&&(sidebarTop.style.transition="all .3s",sidebarTop.off("click").on("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),document.documentElement.scrollTop<10&&(sidebarTop.style.opacity=0)),__sidebarTopScrollHandler&&window.off("scroll",__sidebarTopScrollHandler),__sidebarTopScrollHandler=()=>{const e=_$(".sidebar-top");document.documentElement.scrollTop<10?e.style.opacity=0:e.style.opacity=1},window.on("scroll",__sidebarTopScrollHandler),_$$("#mobile-nav .toc li").forEach(e=>{e.off("click").on("click",()=>{!isMobileNavAnim&&document.body.classList.contains("mobile-nav-on")&&(document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide"))})}),_$$("#mobile-nav .sidebar-menu-link-dummy").forEach(e=>{e.off("click").on("click",()=>{!isMobileNavAnim&&document.body.classList.contains("mobile-nav-on")&&setTimeout(()=>{document.body.classList.remove("mobile-nav-on"),_$("#mask").classList.add("hide")},200)})}),window.off("hexo-blog-decrypt").on("hexo-blog-decrypt",tocInit).on("hexo-blog-decrypt",()=>{const e=document.createElement("script");e.src="/js/insert_highlight.js",e.setAttribute("data-pjax",!0),document.body.appendChild(e)}),tocInit(),_$(".sponsor-button")?.off("click").on("click",()=>{_$(".sponsor-button")?.classList.toggle("active"),_$(".sponsor-tip")?.classList.toggle("active"),_$(".sponsor-qr")?.classList.toggle("active")}),_$(".share-icon.icon-weixin")?.off("click").on("click",function(e){const t=this.getBoundingClientRect(),a=this.querySelector("#share-weixin");if(t.x-148<0?a.style.left=`-${t.x-10}px`:t.x+172>window.innerWidth?a.style.left=`-${310-window.innerWidth+t.x}px`:a.style.left="-138px",e.target===this&&a.classList.toggle("active"),_$(".share-weixin-canvas").children.length)return;const{cover:c,excerpt:d,description:h,title:r,stripContent:o,author:i}=window.REIMU_POST;_$("#share-weixin-banner").src=c,_$("#share-weixin-title").innerText=r,_$("#share-weixin-desc").innerText=d||h||o,_$("#share-weixin-author").innerText="By: "+i,QRCode.toDataURL(window.REIMU_POST.url,function(n,s){n?console.error(n):(_$("#share-weixin-qr").src=s,snapdom.toPng(_$(".share-weixin-dom")).then(l=>{_$(".share-weixin-canvas").appendChild(l)}).catch(()=>{_$("#share-weixin-banner").remove(),snapdom.toPng(_$(".share-weixin-dom")).then(l=>{_$(".share-weixin-canvas").appendChild(l)}).catch(()=>{console.error("Failed to generate weixin share image.")})}))})});var imgElement=_$("#header > img");imgElement.src||imgElement.style.background?window.bannerElement=imgElement:window.bannerElement=_$("#header > picture img"),window.generateSchemeHandler?.();
