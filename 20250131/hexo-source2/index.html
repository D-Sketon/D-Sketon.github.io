<!DOCTYPE html><html lang="zh-CN" data-theme-mode="auto"><head><link rel="preconnect" href="https://npm.webcache.cn" crossorigin><link rel="dns-prefetch" href="https://npm.webcache.cn" crossorigin><meta charset="utf-8"><script async src="https://hm.baidu.com/hm.js?55ca897d064d6eb98df32d62c6984cc0"></script><script data-pjax>var _hmt=_hmt||[];_hmt.push(['_trackPageview',location.pathname]);</script><script>window.REIMU_CONFIG={},window.REIMU_CONFIG.icon_font='4552607_4k4bc36ef96',window.REIMU_CONFIG.clipboard_tips={success:{'zh-CN':'复制成功 (*^▽^*)',en:'Copy successfully (*^▽^*)'},fail:{'zh-CN':'复制失败 (ﾟ⊿ﾟ)ﾂ',en:'Copy failed (ﾟ⊿ﾟ)ﾂ'},copyright:{enable:!1,count:50,license_type:'by-nc-sa'}},window.REIMU_CONFIG.clipboard_tips.copyright.content='本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！',window.REIMU_CONFIG.code_block={expand:!0},window.REIMU_CONFIG.base='https://d-sketon.github.io',window.REIMU_CONFIG.i18n_languages=['en'];</script><title> 我是如何让Hexo占用的内存减少30%的 | 拔剑Sketon </title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="preload" as="style" href="https://fontsapi.zeoseven.com/292/main/result.css" onload="this.rel&#x3D;&#39;stylesheet&#39;" crossorigin><link rel="preload" href="//at.alicdn.com/t/c/font_4552607_4k4bc36ef96.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/loader.css"><meta name="description" content="众所周知，Hexo 虽然是一个非常优秀的静态博客框架，但是由于 Node.js 的特性，Hexo 在编译的时候相比于 Hugo 会占用大量的内存，这对于一些配置较低的服务器来说是一个很大的问题。#5522、#2165 等 ISSUE 也反映了这个问题。难道这就是 Hexo 的极限了吗？当然不是，下面我就来介绍一下我是如何让 Hexo 占用的内存减少 30% 的。"><meta property="og:type" content="article"><meta property="og:title" content="我是如何让Hexo占用的内存减少30%的"><meta property="og:url" content="https://d-sketon.github.io/20250131/hexo-source2/index.html"><meta property="og:site_name" content="拔剑Sketon"><meta property="og:description" content="众所周知，Hexo 虽然是一个非常优秀的静态博客框架，但是由于 Node.js 的特性，Hexo 在编译的时候相比于 Hugo 会占用大量的内存，这对于一些配置较低的服务器来说是一个很大的问题。#5522、#2165 等 ISSUE 也反映了这个问题。难道这就是 Hexo 的极限了吗？当然不是，下面我就来介绍一下我是如何让 Hexo 占用的内存减少 30% 的。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/D-Sketon/blog-img/407218397-295f45f6-26fa-4092-8277-98c233d35fcc.png"><meta property="og:image" content="https://fastly.jsdelivr.net/gh/D-Sketon/blog-img/407218479-c01212ca-04ff-4080-a637-4f55878dde67.png"><meta property="article:published_time" content="2025-01-31T07:32:04.000Z"><meta property="article:modified_time" content="2025-01-31T07:32:04.000Z"><meta property="article:author" content="D-Sketon"><meta property="article:tag" content="Hexo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://fastly.jsdelivr.net/gh/D-Sketon/blog-img/407218397-295f45f6-26fa-4092-8277-98c233d35fcc.png"><meta name="keywords" content="hexo, 源码, 博客"><link rel="alternate" href="/atom.xml" title="拔剑Sketon" type="application/atom+xml"><link rel="icon shortcut" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" integrity="sha384-IfxC36XL&#x2F;toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx&#x2F;1oA&#x2F;0l8ysE" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/katex@0.16.24/dist/katex.min.css" integrity="sha384-tTgKLjMYmJr94v8qu2PE5MUGSMbyN2xiH266JUB3gpm8vnnJywd1dWSOEfrFz+YI" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.css" integrity="sha384-vltfZtesCdl6NYVcFVcjEaIi5RpNvZe9t7fXvq8twVtcoy+Ub9QgnxUYJmwOhYCK" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css" integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin><link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" integrity="sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj+vDDLIL+xBGQU&#x2F;voDBY5XE2lVh" crossorigin><meta name="generator" content="Hexo 8.1.1"></head><body> <div id="loader"> <div class="loading-bg loading-left-bg"></div> <div class="loading-bg loading-right-bg"></div> <div class="spinner-box"> <div class="loading-taichi rotate"> <svg width="150" height="150" viewbox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision"> <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)"></path> <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)"></path> </svg> </div> <div class="loading-word">少女祈祷中...</div> </div> </div> <script>var time=null,loaderEl=document.getElementById('loader'),startLoading=()=>{time=Date.now(),loaderEl.classList.remove('loading')},hideLoader=()=>{document.body.style.overflow='auto',loader.classList.add('loading')},endLoading=()=>{time?500<Date.now()-time?(time=null,hideLoader()):(setTimeout(endLoading,500-(Date.now()-time)),time=null):hideLoader()};window.addEventListener('DOMContentLoaded',endLoading),loaderEl.addEventListener('click',endLoading);</script> <div id="copy-tooltip"></div> <div id="heatmap-tooltip"></div> <div id="container"> <div id="wrap"> <div id="header-nav"> <nav id="main-nav" aria-label="Primary navigation"> <a class="main-nav-link-wrap" href="/"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <span class="main-nav-link">首页</span> <a class="main-nav-link-wrap" href="/archives"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <span class="main-nav-link">归档</span> <a class="main-nav-link-wrap" href="/about"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <span class="main-nav-link">关于</span> <a class="main-nav-link-wrap" href="/friend"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <span class="main-nav-link">友链</span> <a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a> </a></a></a></a></nav> <nav id="sub-nav" aria-label="Secondary navigation"> <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS 订阅" aria-label="RSS 订阅" target="_blank"></a> <a id="nav-search-btn" class="nav-icon popup-trigger" title="搜索" aria-label="搜索"></a> </nav> <nav id="i18n-nav" aria-label="Language selection"> <div class="custom-dropdown"> <div class="select-selected" id="select-selected" role="button" aria-haspopup="listbox" aria-expanded="false" aria-label="Language menu"> <span id="nav-language-btn" class="nav-icon" style="padding:0 20px 0 0"></span> <span id="selected-lang">简体中文</span> </div> <ul class="select-items" id="select-items" role="listbox" aria-label="Languages"> <li data-value="zh-CN" role="option" class="selected" aria-selected="true">简体中文</li> <li data-value="en" role="option" aria-selected="false">English</li> </ul> </div> <script>var selectSelected=document.getElementById('select-selected'),selectedLang=document.getElementById('selected-lang'),selectItems=document.getElementById('select-items'),selectOptions=selectItems.querySelectorAll('li');selectSelected.addEventListener('click',()=>{selectItems.classList.toggle('show');var expanded='true'===selectSelected.getAttribute('aria-expanded');selectSelected.setAttribute('aria-expanded',(!expanded).toString())}),selectOptions.forEach(item=>{item.addEventListener('click',()=>{var langMap={'zh-CN':'/20250131/hexo-source2/',en:'/en/20250131/hexo-source2/'};selectedLang.textContent=item.textContent,selectItems.classList.remove('show'),selectOptions.forEach(option=>{option.classList.remove('selected')}),item.classList.add('selected'),window.location=langMap[item.dataset.value]})}),document.addEventListener('click',event=>{event.target.closest('.custom-dropdown')||(selectItems.classList.remove('show'),selectSelected.setAttribute('aria-expanded','false'))});</script> </nav> <a href="https://github.com/D-Sketon/hexo-theme-reimu" class="triangle-badge" title="github" target="_blank" rel="nofollow noopener noreferrer"> <div class="icon icon-github triangle-badge-icon"></div> </a> </div> <header id="header" aria-label="Site header"> <picture> <source media="(max-width: 479px)" srcset="/images/banner-600w.webp"> <source media="(max-width: 799px)" srcset="/images/banner-800w.webp"> <source media="(min-width: 800px)" srcset="/images/banner.webp"> <img fetchpriority="high" src="/images/banner.webp" alt="我是如何让Hexo占用的内存减少30%的"> </picture> <img alt="我是如何让Hexo占用的内存减少30%的" style="visibility:hidden"> <div id="header-outer"> <div id="header-title"> <span id="logo"> <h1 data-aos="slide-up">我是如何让Hexo占用的内存减少30%的</h1> </span> <h2 id="subtitle-wrap" data-aos="slide-down"> </h2> </div> </div> </header> <div id="content" aria-label="Page content" class="sidebar-left"> <aside id="sidebar" aria-label="Sidebar"> <div class="sidebar-wrapper-container sticky"> <meting-js theme="var(--color-link)" id="2265921590" server="netease" type="playlist" order="random" list-folded="true"></meting-js> <div class="sidebar-wrapper"> <div class="sidebar-wrap" data-aos="fade-up"> <div class="sidebar-toc-sidebar"><h3 class="toc-title">文章目录</h3> <div class="sidebar-toc-wrapper toc-div-class"> <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text"> 优化字符串拼接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#v8-%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.1.</span> <span class="toc-text"> v8 中的字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5-2"><span class="toc-number">1.2.</span> <span class="toc-text"> 优化字符串拼接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text"> 优化文件写入</span></a></li></ol> </div> </div> <div class="hidden sidebar-common-sidebar"><div class="sidebar-author"> <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="D-Sketon" class="lazyload"> <div class="sidebar-author-name">D-Sketon</div> <div class="sidebar-description">D-Sketon&#39;s blog</div> </div> <div class="sidebar-state"> <div class="sidebar-state-article"> <div>文章</div> <div class="sidebar-state-number">75</div> </div> <div class="sidebar-state-category"> <div>分类</div> <div class="sidebar-state-number">10</div> </div> <div class="sidebar-state-tag"> <div>标签</div> <div class="sidebar-state-number">19</div> </div> </div> <div class="sidebar-social"> <div class="icon-github sidebar-social-icon"> <a href="https://github.com/D-Sketon" itemprop="url" target="_blank" aria-label="github" rel="nofollow noopener noreferrer"></a> </div> <div class="icon-bilibili sidebar-social-icon"> <a href="https://space.bilibili.com/20339857" itemprop="url" target="_blank" aria-label="bilibili" rel="nofollow noopener noreferrer"></a> </div> </div> <div class="sidebar-menu"> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">首页</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">归档</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">关于</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">友链</div> </div> </div> </div> <div class="sidebar-btn-wrapper" style="position:static"> <div class="current sidebar-toc-btn"></div> <div class="sidebar-common-btn"></div> </div> </div> </div> <div class="sidebar-widget"> </div> </div> </aside> <section id="main" aria-label="Main content"><article id="post-我是如何让Hexo占用的内存减少50%" class="article h-entry" itemscope itemtype="https://schema.org/BlogPosting"> <div class="article-inner" data-aos="fade-up"> <div class="article-meta"> <div class="article-date"> <span class="article-date-link icon-calendar" data-aos="zoom-in"> <time datetime="2025-01-31T07:32:04.000Z" itemprop="datePublished">2025-01-31</time> <time style="display:none" id="post-update-time">2025-01-31</time> </span> </div> <div class="article-category"> <a class="article-category-link" href="/categories/%E8%AE%A1%E8%BD%AF%E6%9D%82%E8%B0%88/" title="计软杂谈">计软杂谈</a><a class="article-category-link" href="/categories/%E8%AE%A1%E8%BD%AF%E6%9D%82%E8%B0%88/hexo/" title="hexo">hexo</a> </div> </div> <div class="hr-line"></div> <div class="article-entry e-content" itemprop="articleBody"> <div class="custom-block warning"> <p class="custom-block-title">WARNING</p> <p>本文最后更新于 2025-01-31，请注意文中内容可能已不适用。</p> </div> <p>众所周知，Hexo 虽然是一个非常优秀的静态博客框架，但是由于 Node.js 的特性，Hexo 在编译的时候相比于 Hugo 会占用大量的内存，这对于一些配置较低的服务器来说是一个很大的问题。<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues/5552">#5522</a>、<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues/2165">#2165</a> 等 ISSUE 也反映了这个问题。难道这就是 Hexo 的极限了吗？当然不是，下面我就来介绍一下我是如何让 Hexo 占用的内存减少 30% 的。</p> <span id="more"></span> <p>首先，介绍一下我的环境和我是如何进行 benchmark 的。</p> <p>我的环境为：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OS: Windows_NT 10.0.22631 x64</span><br><span class="line">CPU: 13th Gen Intel(R) Core(TM) i5-13400F x 16</span><br><span class="line">Memory: 32581.421875 MiB</span><br><span class="line">Node: 20.13.1</span><br></pre></td></tr></table></figure> <p>Hexo 版本为 <code>7.3.0</code> 和我自己的构建的分支 <code>test/latest</code>。主题为 <code>hexo-theme-landscape</code>。测试文章使用 <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo-many-posts">hexo-many-posts</a>。使用如下脚本和命令进行测试：</p> <figure class="highlight js"><figcaption><span>test/benchmark.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cli = <span class="built_in">require</span>(<span class="string">&#x27;hexo-cli&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> <span class="function_ title">cli</span>(testDir, &#123; <span class="attr">_</span>: [<span class="string">&#x27;c&#x27;</span>] &#125;);</span><br><span class="line"><span class="keyword">await</span> <span class="function_ title">cli</span>(testDir, &#123; <span class="attr">_</span>: [<span class="string">&#x27;g&#x27;</span>], <span class="attr">concurrency</span>: <span class="number">20</span> &#125;);</span><br></pre></td></tr></table></figure> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node --trace-gc <span class="built_in">test</span>/benchmark.js &gt; gc-log.log</span><br></pre></td></tr></table></figure> <p>将收集到的日志进行清洗，得到如下结果：</p> <p>1x hexo-many-posts</p> <div id="echarts4824" style="width:100%;height:500px;margin:0 auto"></div> <script src="https://unpkg.com/echarts@6.0.0/dist/echarts.min.js"></script> <script>window.eChartecharts4824ResizeHandler&&window.removeEventListener('resize',eChartecharts4824ResizeHandler);var eChartecharts4824,eChartecharts4824ResizeHandler,optionecharts4824={title:{text:'内存使用情况',left:'center'},tooltip:{trigger:'axis',confine:!1,appendTo:document.body},legend:{data:['test/latest','7.3.0'],top:'10%'},grid:{left:0,right:0},xAxis:{type:'category',boundaryGap:!1,data:[36,86,136,186,236,286,336,386,436,486,536,586,636,686,736,786,836,886,936,986,1036,1086,1136,1186,1236,1286,1336,1386,1436,1486,1536,1586,1636,1686,1736,1786,1836,1886,1936,1986,2036,2086,2136,2186,2236,2286,2336,2386,2436,2486,2536,2586,2636,2686,2736,2786,2836,2886,2936,2986,3036,3086,3136,3186,3236,3286,3336,3386,3436,3486,3536,3586,3636,3686,3736,3786,3836,3886,3936,3986,4036,4086,4136,4186,4236,4286,4336,4386,4436,4486,4536,4586,4636,4686,4736,4786,4836,4886,4936,4986,5036,5086,5136,5186,5236,5286,5336,5386,5436,5486,5536,5586,5636,5686,5736,5786,5836,5886,5936,5986,6036,6086,6136,6186,6236,6286,6336,6386,6436,6486],axisLabel:{}},yAxis:{type:'value',axisLabel:{formatter:'{value} MB'}},series:[{name:'test/latest',type:'line',data:[4.6,7.581818181818182,9.707692307692307,12.52,14.189743589743589,15.423110785033016,15.588187820983126,15.753264856933235,15.918341892883346,16.083418928833456,16.248495964783565,16.413573000733678,16.578650036683786,16.743727072633895,16.908804108584004,17.073881144534116,17.238958180484225,17.404035216434337,17.569112252384446,17.734189288334555,17.899266324284667,18.064343360234776,18.229420396184885,18.394497432134994,18.559574468085106,18.724651504035215,18.889728539985327,19.054805575935436,19.219882611885545,19.384959647835657,19.550036683785766,19.715113719735875,19.880190755685984,19.69047619047619,20.05681818181818,22.84090909090909,24.95774647887324,26.354545454545455,34.08181818181818,23.36,36.24464285714286,39.51923076923077,43.14901960784314,45.6,48.39230769230769,51.99642857142857,49.8826923076923,46.324999999999996,46.21047619047619,47.30571428571429,50.58524590163935,55.73235294117647,59.55,62.26,65.08,67.94,70.9,73.65263157894738,76.58947368421053,79.9,83.88378378378378,85.3027027027027,86.4448275862069,87.47037037037038,88.63396226415095,89.9764705882353,91.38823529411765,92.73018867924529,94.4090909090909,97.61333333333333,101.12857142857143,105.084,109.20400000000001,113.316,117.35600000000001,121.24,125.56,140.5,84.61,86.26388888888889,93.10677966101694,98.7,97.88181818181818,100.95625,112.22045454545454,114.93513513513513,125.71764705882353,127.38333333333333,137.2,135.4142857142857,135.13333333333333,136.63846153846154,136.46,137.4125,136.3857142857143,139.58333333333331,138.24,139.21363636363637,141.02083333333334,140.96136363636361,142.3904761904762,141.8,143.27826086956523,142.8,143.94782608695652,144.88260869565218,146.33913043478262,146.16363636363636,148.088,149.6,150.33636363636364,155.53103448275863,159.816,160.66,163.2142857142857,166.15454545454546,169.90714285714284,170.37692307692308,172.964,178.42592592592592,180.15,181.70434782608697,185.57777777777778,186.5,185.22500000000002,190.02,188.8774193548387,187.9,187.68124999999998,187.3]},{name:'7.3.0',type:'line',data:[4.6,7.59047619047619,9.561904761904762,12.3,13.853658536585366,15.4,15.711653116531165,16.023306233062332,16.334959349593497,16.64661246612466,16.958265582655827,17.26991869918699,17.581571815718156,17.89322493224932,18.204878048780486,18.516531165311655,18.82818428184282,19.139837398373984,19.45149051490515,19.763143631436314,19.93793103448276,19.957894736842103,23.181578947368422,25.270422535211267,26.56063829787234,28.422340425531914,26.7921568627451,38.59047619047619,40.71764705882353,44.020967741935486,45.55,47.05,48.15384615384615,49.08791208791209,49.71764705882353,50.305882352941175,50.965168539325845,51.695505617977524,53.3625,55.39375,57.22222222222222,59,65.05384615384615,69.75,72.56190476190476,60.39375,61.48888888888889,64.4,67.42,70.2421052631579,73.475,115.96,137.39384615384614,145.20000000000002,148.51267605633805,153.86478873239437,155.39264705882354,156.8,158.43846153846152,159.97692307692307,161.73225806451615,163.41641791044776,165.53658536585365,168.68235294117648,171.5848484848485,174.76666666666668,177.97058823529412,181.2774193548387,184.4967741935484,187.78387096774193,191.08125,194.61290322580646,197.89374999999998,149.46571428571428,89.65238095238095,92.08297872340425,99.0875,104.62857142857142,106.05714285714286,108.95,113.09642857142858,116.85,120.275,123.9,128.61739130434782,132.2,136.3,141.175,145.92272727272726,149.38095238095238,153.2,161.1673913043478,170.66153846153844,188.25555555555556,205.0657142857143,220.1375,229.8,233.4818181818182,236.4272727272727,242.50588235294117,248.8294117647059,255.98,260.2857142857143,266.67272727272723,272.51,249.98333333333332,112.9,121.54705882352941,127.91999999999999,138.7,152.36666666666667,164.9142857142857,173.1,180.94285714285715,192.60869565217394,206.06,217.28620689655173,229.764,241.8,252.84347826086957,266.1270833333333,277.0051282051282,286.925,295.5625,307.7,318.75135135135133,321.8333333333333,353.40597014925373,393.48059701492537,403.9]}]};void 0!==window.echarts&&((eChartecharts4824=echarts.init(document.getElementById('echarts4824'))).setOption(optionecharts4824),eChartecharts4824ResizeHandler=function(){eChartecharts4824.resize()},window.addEventListener('resize',eChartecharts4824ResizeHandler));</script> <p>4x hexo-many-posts</p> <div id="echarts6899" style="width:100%;height:500px;margin:0 auto"></div> <script src="https://unpkg.com/echarts@6.0.0/dist/echarts.min.js"></script> <script>window.eChartecharts6899ResizeHandler&&window.removeEventListener('resize',eChartecharts6899ResizeHandler);var eChartecharts6899,eChartecharts6899ResizeHandler,optionecharts6899={title:{text:'内存使用情况',left:'center'},tooltip:{trigger:'axis',confine:!1,appendTo:document.body},grid:{left:0,right:0},legend:{data:['test/latest','7.3.0'],top:'10%'},xAxis:{type:'category',boundaryGap:!1,data:[36,86,136,186,236,286,336,386,436,486,536,586,636,686,736,786,836,886,936,986,1036,1086,1136,1186,1236,1286,1336,1386,1436,1486,1536,1586,1636,1686,1736,1786,1836,1886,1936,1986,2036,2086,2136,2186,2236,2286,2336,2386,2436,2486,2536,2586,2636,2686,2736,2786,2836,2886,2936,2986,3036,3086,3136,3186,3236,3286,3336,3386,3436,3486,3536,3586,3636,3686,3736,3786,3836,3886,3936,3986,4036,4086,4136,4186,4236,4286,4336,4386,4436,4486,4536,4586,4636,4686,4736,4786,4836,4886,4936,4986,5036,5086,5136,5186,5236,5286,5336,5386,5436,5486,5536,5586,5636,5686,5736,5786,5836,5886,5936,5986,6036,6086,6136,6186,6236,6286,6336,6386,6436,6486,6536,6586,6636,6686,6736,6786,6836,6886,6936,6986,7036,7086,7136,7186,7236,7286,7336,7386,7436,7486,7536,7586,7636,7686,7736,7786,7836,7886,7936,7986,8036,8086,8136,8186,8236,8286,8336,8386,8436,8486,8536,8586,8636,8686,8736,8786,8836,8886,8936,8986,9036,9086,9136,9186,9236,9286,9336,9386,9436,9486,9536,9586,9636,9686,9736,9786,9836,9886,9936,9986,10036,10086,10136,10186,10236,10286,10336,10386,10436,10486,10536,10586,10636,10686,10736,10786,10836,10886,10936,10986,11036,11086,11136,11186,11236,11286,11336,11386,11436,11486,11536,11586,11636,11686,11736,11786,11836,11886,11936,11986,12036,12086,12136,12186,12236,12286,12336,12386,12436,12486,12536,12586,12636,12686,12736,12786,12836,12886,12936,12986,13036,13086,13136,13186,13236,13286,13336,13386,13436,13486,13536,13586,13636,13686,13736,13786,13836,13886,13936,13986,14036,14086,14136,14186,14236,14286,14336,14386,14436,14486,14536,14586,14636,14686,14736,14786,14836,14886,14936,14986,15036,15086,15136,15186,15236,15286,15336,15386,15436,15486,15536,15586,15636,15686,15736,15786,15836,15886,15936,15986,16036,16086,16136,16186,16236,16286,16336,16386,16436,16486,16536,16586,16636,16686,16736,16786,16836,16886,16936,16986,17036,17086,17136,17186,17236,17286,17336,17386,17436,17486,17536,17586,17636,17686,17736,17786,17836,17886,17936,17986,18036,18086,18136,18186,18236,18286,18336,18386,18436,18486,18536,18586,18636,18686,18736,18786,18836,18886,18936,18986,19036,19086,19136,19186,19236],axisLabel:{}},yAxis:{type:'value',axisLabel:{formatter:'{value} MB'}},series:[{name:'7.3.0',type:'line',data:[4.6,7.5200000000000005,9.4,12.422222222222222,13.959999999999999,15.412771739130434,15.732065217391305,16.051358695652173,16.370652173913044,16.689945652173915,17.009239130434782,17.328532608695653,17.647826086956524,17.96711956521739,18.286413043478262,18.60570652173913,18.925,19.24429347826087,19.56358695652174,19.88288043478261,19.991525423728813,20.116455696202532,23.09113924050633,25.175384615384615,29.162790697674417,36.23076923076923,36.80769230769231,29.8,29.51818181818182,40.39772727272727,50.875,58.3,75.82307692307693,80.27931034482758,82.52068965517242,84.62903225806451,86.28550724637681,87.66,88.86,90.1,91.3258064516129,92.45483870967742,93.6752688172043,95.0731182795699,96.3,97.34166666666667,98.31650485436893,99.23883495145631,100.2,101.2,102.17391304347827,103.08695652173914,104,104.70833333333333,105.41666666666667,106.14628099173554,106.8900826446281,107.6233870967742,108.30887096774194,108.99435483870968,109.68461538461538,110.37692307692308,111.13333333333334,112.46666666666667,102.36153846153846,84.63076923076923,66.9,66.9,66.9,66.9,66.9,67.348,68.148,69.31739130434784,72.52714285714285,75.31458333333333,77.29374999999999,80.65172413793103,86.73333333333333,91.73157894736842,94.44444444444444,97.28,100.18888888888888,103.12222222222222,106.35882352941177,109.37647058823529,112.20526315789473,114.945,117.91578947368421,120.8529411764706,123.81578947368422,126.83333333333333,130.04705882352943,133.14999999999998,136.1529411764706,139.28235294117647,97.87058823529411,100.2421052631579,103.3,106.43333333333334,109.44444444444444,112.34736842105264,115.74705882352941,118.93333333333334,121.82352941176471,124.92777777777778,128.19411764705882,131.56666666666666,173.325,203.2,234.96666666666667,266.06,299.46666666666664,336.8666666666667,361.26363636363635,373.546875,388.30312499999997,400.4266666666667,415.0657894736842,423.3036363636364,418.5763636363636,414.82089552238807,415.4925373134329,417.25245901639346,419.08500000000004,420.81129032258065,422.52033898305086,424.3,425.96666666666664,427.6333333333333,429.2741935483871,430.9131147540984,432.6322580645162,434.2451612903226,435.81475409836065,437.48,439.17,440.76666666666665,442.43333333333334,444.0483870967742,445.66129032258067,447.3135593220339,448.98387096774195,450.5904761904762,452.0984126984127,453.7559322033898,455.3457627118644,456.93333333333334,458.5950819672131,460.2344262295082,461.8457627118644,463.5220338983051,465.0450704225352,466.7113636363636,469.45,471.8545454545454,474.31428571428575,476.7219512195122,479.19555555555553,481.65,484.245,486.8128205128205,489.5,491.8292682926829,494.42926829268293,496.90000000000003,499.66999999999996,501.83076923076925,504.0243902439024,506.28205128205127,508.5692307692308,510.8384615384615,513.1205128205128,515.3725,517.5390243902439,519.5871794871795,521.8615384615384,523.9948717948718,526.2658536585366,528.4882352941177,531.0500000000001,533.1290322580645,535.0727272727273,536.8129032258065,538.671875,540.4161290322581,542.3033333333333,544.1272727272727,545.984375,547.8677419354839,549.741935483871,551.64375,553.45,555.3,557.1774193548388,559,560.784375,562.659375,564.4125,577.4599999999999,650.0217391304348,663.7291666666666,667.572,670.2666666666667,671.3777777777779,672.429411764706,673.3117647058824,674.2714285714286,675.5051948051948,677.0121495327103,678.6476635514018,681.509375,691.65,695.3791666666666,697.9483870967741,702.9187499999999,705.0552631578947,708.4818181818182,712.0347826086957,716.0615384615385,719.6,723.7,726.81,730.05,733.3714285714286,736.4,741.75,745.7476190476191,749.5708333333333,753.1761904761905,756.104347826087,759.4428571428572,763.8307692307693,766.2636363636364,771.304,773.5157894736842,777.9130434782609,782.1458333333334,784.7727272727273,789.7,792.62,794.9909090909091,799.125,803.0782608695653,807.8954545454545,811.3545454545455,815.0105263157894,819.7,822.047619047619,826.195652173913,830.55,833.4777777777779,837.8666666666667,842.32,844.3684210526316,849.5652173913044,853.6478260869565,856.1684210526315,862.4,875.2517241379311,886.55625,898.8787878787879,910.7727272727274,920.7,932.4428571428572,940.364705882353,770.8271186440678,200.72272727272727,211.56756756756758,220.5304347826087,234.27297297297298,241.08709677419353,258.9222222222222,266.48064516129034,281.28055555555557,288.56666666666666,303.1217391304348,315.17894736842106,316.16086956521735,319.5318181818182,324.3619047619048,327.9263157894737,330.65714285714284,334.81304347826085,338.09,341.85714285714283,345.8333333333333,349.98333333333335,355.5375,360.2351351351351,365.22857142857146,369.15999999999997,374.81,378.36315789473684,383.6,388.3,393.16956521739127,397.58125,402.38695652173914,406.72962962962964,409.71333333333337,242.22222222222223,194.57999999999998,199,204.8875,207.5857142857143,212.29999999999998,216.28,218.6421052631579,222.81875,227,232.3108695652174,245.70000000000002,257.7153846153846,269.1333333333333,279.5,292.0962962962963,302.4769230769231,313.06857142857143,323.54615384615386,334.012,345.8,357.6653846153846,368.15,378.1409090909091,391.36296296296297,402.29622641509434,413.0695652173913,425.4,438.3739130434783,337.1544303797468,213.604,224.108,235.53846153846152,246.7,259.8925925925926,270.58,281.2034482758621,293.0076923076923,303.74615384615385,313.4428571428572,326.0931034482759,334.97142857142853,346.4862068965517,359.2407407407407,370.6272727272727,382.5652173913044,397.4888888888889,407.348,418.7785714285714,430.59999999999997,442.32608695652175,452.29999999999995,466.53000000000003,476.0130434782609,487.1363636363636,336.905,228.5,239.65483870967742,252.2625,264.6666666666667,276.34761904761905,289.6166666666667,301.39000000000004,314.29999999999995,322.9714285714286,337.3545454545455,350.1703703703704,361.5590909090909,374.4375,386.2695652173913,397.62,411.64705882352945,411.1612903225806,417.42,451.2714285714286,481.5125,511.1142857142857,544.1733333333334,576.44,617.2825688073394,663.6357798165138,709.988990825688,756.3422018348624,769.3]},{name:'test/latest',type:'line',data:[4.6,7.4904761904761905,9.63170731707317,12.444444444444445,14.052631578947368,15.423350253807106,15.656852791878173,15.890355329949239,16.123857868020306,16.35736040609137,16.59086294416244,16.824365482233503,17.057868020304568,17.291370558375636,17.5248730964467,17.758375634517765,17.991878172588834,18.2253807106599,18.458883248730963,18.69238578680203,18.925888324873096,19.159390862944164,19.39289340101523,19.626395939086294,19.859898477157362,19.814814814814813,20.492405063291137,23.593670886075948,25.298571428571428,28.905,36.07088607594937,36.577215189873414,30.266666666666666,28.957142857142856,37.10952380952381,44.90869565217391,51.805128205128206,69.24193548387098,75.13333333333334,77.50434782608696,80.52727272727273,83.29756097560976,86.91538461538462,91.01794871794871,95.48529411764706,100.21470588235294,104.67058823529412,109.88214285714285,120.5,126.69999999999999,76.41999999999999,64.59285714285714,67.61531531531531,69.95765765765765,72.3,77.80000000000001,83.6,86.35,89.02,91.7,94.62777777777778,97.44545454545454,100.33684210526316,103.34210526315789,106.12631578947368,108.95,111.56,114.43684210526315,117.15263157894738,120.06,122.88888888888889,125.75263157894737,128.43157894736842,131.3,134.1263157894737,137.03,140.11111111111111,143.08,145.16842105263157,147.98888888888888,150.85555555555555,153.68421052631578,156.62105263157895,159.34117647058824,162.53529411764706,165.55263157894737,168.4125,173.3,178.35,183.14444444444445,187.8,192.01216216216216,193.4310810810811,194.4607142857143,195.668,197.14897959183673,198.58510638297872,200.11702127659575,201.41199999999998,202.83999999999997,204.17021276595744,205.70851063829787,206.97755102040816,208.24893617021277,209.6255319148936,210.90434782608696,212.22608695652175,213.60638297872342,214.9,216.26521739130433,217.6,218.89333333333335,220.27608695652174,196.61176470588234,162.2,162.36304347826086,163.95999999999998,165.57142857142858,168.17857142857142,172.12,176.16666666666666,180.456,184.6608695652174,189.1909090909091,193.50434782608696,197.94,201.84583333333333,205.62608695652173,209.27499999999998,212.875,216.572,220.09565217391304,223.80434782608697,227.73478260869564,232.39999999999998,236.2,240.08125,244,247.64999999999998,251.57500000000002,255.28666666666666,259.4125,263.24,269.9,341.81666666666666,362.1727272727273,367.11153846153843,370.38,373.9,376.21142857142854,378.49411764705883,381.7423076923077,392.8,395.0285714285714,398.85833333333335,404.27500000000003,405.36206896551727,409.1888888888889,413.92,417.3644444444444,420.584,423.7,427.7428571428572,432.8541666666667,435.91999999999996,440.076,443.31,448.2086956521739,450.71764705882356,453.04545454545456,456.8,459.56666666666666,464.2761904761905,468.3,472.35714285714283,476.9636363636364,480.90000000000003,483.3666666666667,486.7304347826087,490.49600000000004,493.4666666666667,497.05454545454546,501.55,505.39,509.63,512.62,517.4545454545455,521.1782608695653,525.1130434782609,528.1850000000001,533.2,536.9787878787879,500.9837837837838,192.81,196.5909090909091,201.8388888888889,205.59,208.68571428571428,211.79545454545456,216.82608695652175,219.51176470588237,224.43636363636364,226.24444444444447,231.10000000000002,235.54117647058825,240.3909090909091,248.32857142857145,261.04545454545456,273.065,281.7666666666667,296.5833333333333,307.21250000000003,316.6255319148936,327.1875,338.52,351.6333333333333,360.1625,375.2612903225807,382.85714285714283,397.56216216216217,405.6027027027027,417.7230769230769,430.58947368421053,445.144262295082,453.1037037037037,453.92105263157896,442.3,242.3,198.775,203.7,209.43333333333334,212.3,217.79999999999998,222.35294117647058,228.70588235294116,232.1,238.93333333333334,244.20454545454547,248.27083333333334,249.61481481481482,255.76521739130436,259.2789473684211,263.74444444444447,269.55555555555554,274.0157894736842,276.4125,280.8666666666667,284.9235294117647,287.9727272727273,291.04999999999995,301.06666666666666,314.84285714285716,326.25,336.84000000000003,350.14,360.44,374.96153846153845,383.3567567567568,391.7083333333333,282.125,213.44285714285715,225.99166666666667,236.5,246.4,257.14444444444445,266.45,279.6583333333333,291.94615384615383,302.94864864864866,309.6428571428571,321.084,335.2923076923077,346.75384615384615,355.675,367.5369565217391,379.775,392.168,402.95,411.4972222222222,418.5363636363636,430.648,442.892,454.52758620689656,465.23125,476.72,455.0072289156626,294.0433734939759,225.05161290322582,235.03199999999998,244.33529411764707,253.5,267.1217391304348,276.67692307692306,286.32307692307694,298,310.84761904761905,322.50399999999996,334.8071428571428,343.5,355.6,363.4761904761905,377.85,389.0086956521739,397.785,407.9583333333333,418.3290322580645,429.53571428571433,436.9227272727273,452.3,462.44814814814816,475.428,484.625,467.88,321.10222222222217,233.596,247.828,248.07500000000002,248.4,248.28620689655173,248.1,248.4,248.32,248.3294117647059,248.55652173913043,248.54285714285714,248.4375,248.33076923076922,248.7,248.36470588235295,247.72187499999998]}]};void 0!==window.echarts&&((eChartecharts6899=echarts.init(document.getElementById('echarts6899'))).setOption(optionecharts6899),eChartecharts6899ResizeHandler=function(){eChartecharts6899.resize()},window.addEventListener('resize',eChartecharts6899ResizeHandler));</script> <p>12x hexo-many-posts</p> <div id="echarts6681" style="width:100%;height:500px;margin:0 auto"></div> <script src="https://unpkg.com/echarts@6.0.0/dist/echarts.min.js"></script> <script>window.eChartecharts6681ResizeHandler&&window.removeEventListener('resize',eChartecharts6681ResizeHandler);var eChartecharts6681,eChartecharts6681ResizeHandler,optionecharts6681={title:{text:'内存使用情况',left:'center'},tooltip:{trigger:'axis',confine:!1,appendTo:document.body},legend:{data:['test/latest','7.3.0'],top:'10%'},grid:{left:0,right:0},xAxis:{type:'category',boundaryGap:!1,data:[34,184,334,484,634,784,934,1084,1234,1384,1534,1684,1834,1984,2134,2284,2434,2584,2734,2884,3034,3184,3334,3484,3634,3784,3934,4084,4234,4384,4534,4684,4834,4984,5134,5284,5434,5584,5734,5884,6034,6184,6334,6484,6634,6784,6934,7084,7234,7384,7534,7684,7834,7984,8134,8284,8434,8584,8734,8884,9034,9184,9334,9484,9634,9784,9934,10084,10234,10384,10534,10684,10834,10984,11134,11284,11434,11584,11734,11884,12034,12184,12334,12484,12634,12784,12934,13084,13234,13384,13534,13684,13834,13984,14134,14284,14434,14584,14734,14884,15034,15184,15334,15484,15634,15784,15934,16084,16234,16384,16534,16684,16834,16984,17134,17284,17434,17584,17734,17884,18034,18184,18334,18484,18634,18784,18934,19084,19234,19384,19534,19684,19834,19984,20134,20284,20434,20584,20734,20884,21034,21184,21334,21484,21634,21784,21934,22084,22234,22384,22534,22684,22834,22984,23134,23284,23434,23584,23734,23884,24034,24184,24334,24484,24634,24784,24934,25084,25234,25384,25534,25684,25834,25984,26134,26284,26434,26584,26734,26884,27034,27184,27334,27484,27634,27784,27934,28084,28234,28384,28534,28684,28834,28984,29134,29284,29434,29584,29734,29884,30034,30184,30334,30484,30634,30784,30934,31084,31234,31384,31534,31684,31834,31984,32134,32284,32434,32584,32734,32884,33034,33184,33334,33484,33634,33784,33934,34084,34234,34384,34534,34684,34834,34984,35134,35284,35434,35584,35734,35884,36034,36184,36334,36484,36634,36784,36934,37084,37234,37384,37534,37684,37834,37984,38134,38284,38434,38584,38734,38884,39034,39184,39334,39484,39634,39784,39934,40084,40234,40384,40534,40684,40834,40984,41134,41284,41434,41584,41734,41884,42034,42184,42334,42484,42634,42784,42934,43084,43234,43384,43534,43684,43834,43984,44134,44284,44434,44584,44734,44884,45034,45184,45334,45484,45634,45784,45934,46084,46234,46384,46534,46684,46834,46984,47134,47284,47434,47584,47734,47884,48034,48184,48334,48484,48634,48784,48934,49084,49234,49384,49534,49684,49834,49984,50134,50284,50434,50584,50734,50884,51034,51184,51334,51484,51634,51784,51934,52084,52234,52384,52534,52684,52834,52984,53134,53284,53434,53584,53734,53884,54034,54184,54334,54484,54634,54784,54934,55084,55234,55384,55534,55684,55834,55984,56134,56284,56434,56584,56734,56884,57034,57184,57334,57484,57634,57784,57934,58084,58234,58384,58534,58684,58834,58984,59134,59284,59434,59584,59734,59884,60034,60184,60334,60484,60634,60784,60934,61084,61234,61384,61534,61684,61834,61984,62134,62284,62434,62584,62734,62884,63034,63184,63334,63484,63634,63784,63934,64084,64234,64384,64534,64684,64834,64984,65134,65284,65434,65584,65734,65884,66034,66184,66334,66484,66634,66784,66934,67084,67234,67384,67534,67684,67834,67984,68134,68284,68434,68584,68734,68884,69034,69184,69334,69484,69634,69784,69934,70084,70234,70384,70534,70684,70834,70984,71134,71284,71434,71584,71734,71884,72034,72184,72334,72484,72634,72784,72934,73084,73234,73384,73534,73684,73834,73984,74134,74284,74434,74584,74734,74884,75034,75184,75334,75484,75634,75784,75934,76084,76234,76384,76534,76684,76834,76984,77134,77284,77434,77584,77734,77884,78034,78184,78334,78484,78634,78784,78934,79084,79234,79384,79534,79684,79834,79984,80134,80284,80434,80584,80734,80884,81034,81184,81334,81484,81634,81784,81934,82084,82234,82384,82534,82684,82834,82984,83134,83284,83434,83584,83734,83884,84034,84184,84334,84484,84634,84784],axisLabel:{}},yAxis:{type:'value',axisLabel:{formatter:'{value} MB'}},series:[{name:'test/latest',type:'line',data:[4.6,12.734375,15.583675866118615,15.988843217850851,16.394010569583088,16.799177921315327,17.204345273047565,17.6095126247798,18.01467997651204,18.419847328244273,18.825014679976512,19.23018203170875,19.635349383440985,19.870689655172413,25.094285714285714,39.580821917808215,48.96363636363636,43.22727272727273,51.94285714285714,83.72307692307692,72.25054945054946,134.6,144.00232558139533,155.58947368421053,168.41176470588235,193.3764705882353,211.304,231.40714285714284,251.69230769230768,267.8367088607595,260.5412087912088,139.1401098901099,130.69294117647058,139.7813953488372,156.05,169.5528455284553,182.04761904761904,194.2,202.61578947368423,211.17368421052632,219.8736842105263,228.5,237.04999999999998,245.81428571428572,254.2722222222222,262.72105263157897,271.5052631578948,280.0473684210526,288.42,297.0105263157895,305.5157894736842,313.1842105263158,321.65,330.22105263157897,338.665,347.35,355.9,364.5052631578948,372.94,381.5,390.12631578947367,398.6222222222222,407.2352941176471,415.65500000000003,424.30526315789473,432.84,441.2631578947368,453.33333333333337,466.77777777777777,260.9,274.6,288.2,300.2566037735849,303.81111111111113,307.9423076923077,311.904,315.8276595744681,319.6387755102041,323.425,327.20625,331.0040816326531,334.90416666666664,338.7489795918367,342.6020833333333,346.48936170212767,350.2,354.01063829787233,357.87083333333334,361.73333333333335,365.528,369.33829787234043,373.2936170212766,377.05510204081634,380.9673469387755,384.774,388.4795918367347,392.34375,396.1595744680851,400.72727272727275,411.86,423.95,436.15,446.88,457.68333333333334,469.35,480.00588235294117,491.1,502.43333333333334,513.6062499999999,524.625,535.8714285714286,547.2533333333333,558.725,569.82,581.4294117647058,592.8117647058824,604.45,615.9705882352941,627.36875,638.75,653.9666666666667,872.2,945.4961538461539,953.9555555555556,964.7307692307692,974.3307692307693,988.85375,992.5170212765958,993.4162011173185,404.475,431.6666666666667,443.3434782608695,456.4025,467.06399999999996,476.35999999999996,488,499.5625,510.7727272727273,520.9904761904762,532.8636363636364,542.6181818181818,554.4666666666667,566.5772727272728,579.1142857142858,588.6666666666666,601.4499999999999,612.6608695652174,623.8421052631578,635.9782608695652,646.9869565217391,658.46,670.66,682.18,693.5111111111111,608.1377358490566,445.73157894736846,458.5,468.1318181818182,478.47777777777776,490.8421052631579,504.65,515.4333333333334,529.255,540.9911764705882,552.0578947368421,562.9947368421052,575.7142857142858,436.38823529411764,449.3272727272727,462.4,471.88235294117646,483.84,504.64,543.86,575.123076923077,609.2153846153846,643.7483870967742,481.69603960396046,496.17777777777775,529.1392857142857,565.46,601.2066666666667,634.1612903225806,668.2454545454545,704.4057142857142,666.9384615384615,473.8242424242424,506.54545454545456,540.45,580.1571428571428,605.3916666666667,617.9705882352941,630.0578947368421,643.7,654.04,536.7513513513513,439.22857142857146,450.875,461.38,474.2888888888889,487.4185185185185,500.17,513.1090909090909,524.2421052631579,538.0526315789473,549.8294117647059,562.7473684210527,493.80243902439025,439.6,452.6,463.8571428571429,478.43220338983053,486.5,500.54285714285714,512.3,525.1333333333333,537.5761904761905,548.6157894736842,560.2727272727273,543.9073170731708,428.71818181818185,438.25,450.785,488.43157894736845,519.4170212765957,550.6571428571428,589.0181818181818,622.6739130434783,656.8,683.2608695652174,467.6,503.5,540.5321428571428,576.295652173913,607.1153846153846,642.0923076923077,672.075,708.3823529411765,539.2689655172414,487,523.1695652173913,555.0173913043478,589.8139534883721,621.6166666666667,657.1153846153846,692.884,724.5307692307692,604.8189655172414,503.53548387096777,533.75,569.5173913043478,607,640.526923076923,677.8833333333333,714.4083333333334,748.5,517.8351851851852,517.5821428571428,552.325,586.2959999999999,621.288,655.9153846153846,688.3621212121212,723.9363636363636,752.4166666666666,511.51363636363635,542.9727272727273,580.91875,614.6260869565217,646.564,685.432,716.5375,752.709090909091,705.6092783505154,532.3333333333334,570.1333333333333,600.1619047619047,635.644,668.848,699.7411764705882,735.0961538461538,768.35,696.1219512195122,541.7,578.7969696969698,607.6678571428572,607.9625,608.19375,608.032,608.2117647058824,608.4,608.3555555555555,608.5,608.3764705882353,608.2,608.1294117647059,608.5,608.2,607.6592592592592,606.9]},{name:'7.3.0',type:'line',data:[4.6,12.467647058823529,15.603600900225057,16.121230307576894,16.63885971492873,17.15648912228057,17.67411852963241,18.191747936984246,18.709377344336083,19.227006751687924,19.74463615903976,20.395294117647058,26.446153846153845,37.252,45.599999999999994,42.80833333333334,54.3,83.76153846153846,120.95185185185186,125.1,134.81323529411765,140.14634146341461,144.38688524590162,147.56923076923076,150.89158878504674,154.02459016393442,156.7984375,159.4818181818182,161.83777777777777,164.12589928057554,166.25555555555553,168.30544217687074,170.33935483870968,172.54000000000002,174.45342465753424,176.19324324324324,177.808,179.38947368421051,181.08101265822785,182.4608695652174,184.19668874172186,185.75095541401274,187.13072289156625,188.37321428571428,189.60174418604652,190.90751445086704,192.1813953488372,193.31581920903955,194.50225988700564,195.7245901639344,196.88148148148147,197.91176470588235,198.817277486911,199.91675392670157,200.88947368421054,201.8972972972973,202.92608695652174,203.935593220339,205.20677966101695,206.24237288135595,207.16236559139784,208.12553191489363,209.10212765957448,209.9,210.75051546391754,211.6456852791878,212.55223880597015,213.44145077720208,214.21865284974095,215.04871794871795,216.00602409638554,217.09036144578315,218.80600858369098,221.1079646017699,228.99887323943662,234.576338028169,240.1538028169014,240.92155339805825,241.27106796116504,241.62058252427187,241.9401151631478,242.22802303262958,242.51593090211134,242.8023346303502,242.97743190661478,243.1525291828794,243.32762645914397,243.6351145038168,244.03587786259544,244.43664122137406,244.82174757281555,245.0547572815534,245.28776699029126,245.5207766990291,245.84655172413792,246.22011494252874,246.59367816091955,246.92117647058825,247.0388235294118,247.1564705882353,247.27411764705883,247.52718446601943,247.81844660194176,248.10970873786408,248.41063829787234,248.72978723404256,249.04893617021278,249.36808510638298,249.6359223300971,249.8980582524272,250.1601941747573,250.44638783269963,250.7600760456274,251.07376425855514,251.3874524714829,251.62282398452612,251.8549323017408,252.0870406189555,252.29023437499998,252.466015625,252.641796875,252.84580152671757,253.30381679389313,253.7618320610687,254.21984732824427,254.5397312859885,254.7700575815739,255.0003838771593,255.25725190839694,255.68664122137403,256.1160305343511,256.5454198473282,256.8097142857143,256.98114285714286,257.15257142857143,257.37865168539327,257.9404494382023,258.50224719101124,259.06404494382025,259.3972067039106,259.5648044692737,259.7324022346369,259.9,260.20841121495323,260.51682242990654,260.8252336448598,261.12357414448667,261.40874524714826,261.6939163498099,261.9790874524715,262.2874060150376,262.59755639097745,262.90770676691733,263.20714285714286,263.48909774436095,263.771052631579,264.053007518797,264.3777777777778,264.7111111111111,265.0444444444445,265.3652985074627,265.64514925373135,265.925,266.2048507462687,266.4840148698885,266.7628252788104,267.04163568773237,267.31458333333336,267.513446969697,267.7123106060606,267.91117424242424,268.23446327683615,268.65819209039546,269.0819209039548,269.50225988700566,269.6717514124294,269.8412429378531,270.01073446327683,270.2810564663024,270.66357012750456,271.04608378870677,271.4285974499089,271.02850241545895,270.512,285.12,297.5872727272727,312,320.8894736842105,330.20588235294116,339.5777777777778,348.74117647058824,160.31764705882352,169.5705882352941,178.58333333333334,188.08235294117645,197.43333333333334,206.96470588235294,216.3470588235294,225.68235294117648,235.04117647058825,244.35294117647058,253.99411764705883,263.15555555555557,272.58235294117645,281.89444444444445,291.45,300.9529411764706,310.1764705882353,319.72499999999997,329.06111111111113,338.1277777777778,347.6,356.85,365.8764705882353,450.15,550,605.4947368421052,645.65,586.1416666666667,686.0111111111111,783.1333333333333,869.9,975.3083333333334,1065.4692307692308,1136.7115384615383,1148.9125000000001,1153.5677419354838,1158.6333333333334,1163.8475409836065,1168.8084745762712,1173.704918032787,1178.5440677966103,1183.439344262295,1188.2196721311475,1193.1016393442621,1197.8333333333333,1202.4806451612903,1207.1741935483872,1211.988524590164,1216.7737704918034,1221.5290322580645,1226.443103448276,1231.260655737705,1236.2559322033899,1241.2918032786886,1246.151612903226,1250.9426229508197,1255.8983333333333,1260.808064516129,1265.8098360655738,1270.7180327868853,1275.7409836065574,1280.5064516129032,1285.177049180328,1290,1294.8338709677419,1299.582075471698,1303.4107526881721,1306.6020408163265,1309.9555555555555,1312.9692307692308,1315.7528301886794,1318.4779816513762,1321.4571428571428,1324.3633663366336,1327.1938053097344,1329.8663716814158,1332.56,1335.343925233645,1338.079245283019,1340.3185185185184,1342.8141304347826,1345.5709677419356,1348.245871559633,1350.9041666666667,1353.0081300813008,1355.3281553398058,1357.709090909091,1360.2785046728973,1362.9789473684211,1366.0066666666667,1368.4962962962964,1370.4758620689656,1372.6074074074074,1374.73,1376.905,1379.177108433735,1381.3219512195121,1383.490243902439,1385.5124999999998,1387.695061728395,1389.9407407407407,1392.1444444444446,1394.3037037037036,1396.4467532467534,1398.7544303797467,1400.835,1402.9573170731708,1405.2925925925927,1407.3505617977528,1409.375,1411.59756097561,1413.8370370370371,1415.9444444444443,1417.8446428571428,1419.2867924528302,1420.726446280992,1422.081679389313,1423.6760000000002,1425.33,1426.7622047244095,1428.5449438202247,1430.603125,1432.4666666666667,1434.0247311827957,1435.9247191011236,1438.0779069767443,1440.2444444444443,1442.3469879518073,1444.4261904761906,1446.5074074074075,1448.8700000000001,1450.6510638297873,1452.627906976744,1454.6354430379747,1456.846913580247,1459.06,1461.1759493670886,1463.4280487804879,1465.64,1467.70243902439,1470.0341772151899,1472.1307692307691,1474.4215189873416,1476.557142857143,1479.0714285714287,1481.3,1483.4061855670102,1485.3707317073172,1487.5792682926829,1489.6586206896552,1491.876923076923,1494.2481481481482,1496.4709302325582,1499.025,1501.3,1503.5925925925926,1505.974074074074,1508.2818181818182,1510.6185185185184,1513.0487804878048,1515.253846153846,1517.5395348837208,1520.065060240964,1522.24,1524.625641025641,1526.9865853658537,1529.2975308641976,1531.560759493671,1533.8538461538462,1535.897802197802,1538.0892857142858,1540.2592592592591,1542.4714285714285,1544.90987654321,1546.988888888889,1549.1855263157895,1625.75,1820.5641025641025,1850.74,1860.5884615384614,1872.1576923076923,1875.135231316726,1876.0427046263346,1876.8867692307692,1877.7175384615384,1878.6075812274369,1879.5281588447654,1881.2144827586208,1883.076551724138,1884.675,1886.2375,1887.9282685512367,1889.6625615763546,1891.8793103448277,1893.9236363636364,1895.6892733564014,1896.831141868512,1899.1145454545454,1913.2333333333333,1936.6923076923078,1948.5127659574468,1960.1923076923076,1994.2857142857142,1232.9499999999998,473.04,515.8625,562.1758620689656,612.34,655.8272727272728,698.4354838709677,743.8941176470588,788.9666666666667,833.8666666666667,444.84285714285716,491.60625,540.4285714285714,589.271875,636.6666666666667,684.9935483870968,732.240625,796.4901065956029,827.104347826087,799.0313725490196,446.1666666666667,462.59999999999997,481.95714285714286,499.5888888888889,516.6315789473684,532.4684210526316,548.0388888888889,565.6333333333333,581.4,598.5588235294118,616.5631578947368,632.02,647.0520833333334,447.84285714285716,465.05,481.68,499.5,517.3111111111111,532.2571428571429,548.9,569.025,583.9518518518519,600.2157894736843,617.8950000000001,637.34,627.4746666666666,449.15,468.06111111111113,485.31363636363636,502.10555555555555,521.5428571428571,537.62,554.0481481481481,572.3000000000001,589.7421052631579,607.49,622.48,641.4272727272728,446.956976744186,438.89130434782606,458.66999999999996,475.74,491.5,509.99375,528.8199999999999,543.9777777777778,563.2555555555556,582.3235294117648,600.3879999999999,618.51875,513.7012658227848,438.03333333333336,455.24444444444447,475.40952380952376,495.0818181818182,511.28000000000003,530.6333333333333,550.25,567.530303030303,586.1,605.3764705882353,624.2565217391304,450.2634920634921,440.2625,458.03809523809525,473.38421052631577,490.69444444444446,508.6,524.7625,542.2444444444444,561.6428571428571,614.9,666.6875,713.7473684210526,449.3647058823529,496.752,539.6624999999999,592.5296296296297,640.404,688.6333333333333,734.26,788.4285714285714,827.7782608695652,520.321,502.71250000000003,547.4545454545455,598.6722222222222,651.6,703.9833333333333,748.3611111111111,795.34,844.1439024390244,540.8049382716049,503.408,557.6,603.5,644.3846153846154,696.3678571428571,747.2434782608696,791.6173913043478,840.1086956521739,587.0280373831775,523.8041666666667,569.5,617.9590909090908,660.6695652173913,709.1484848484848,759.3333333333334,812.6785714285714,863.4,691.25,530.195652173913,573.5640000000001,618.65,673.4666666666666,721.1133333333333,772.0652173913043,823.3774193548387,872.3347826086956,839.9487804878048,528.9625,575.6538461538462,629.0285714285715,675.4714285714286,730.1086956521739,780.8628571428571,821.412,869.24,904.6386363636364,532.1,581.3722222222223,631.9391304347827,681.8272727272728,723.0333333333333,773.1,823.8218181818181,825.19375,842.6333333333333,923.2625,1013.5,1107.2,1199.6363636363637,1291.7818181818182,1381.4727272727273,1462.4384401114205,1542.8284122562673,1623.2183844011142,1703.608356545961,1783.9983286908077,1864.3883008356547,1944.7782729805015,1952.5]}]};void 0!==window.echarts&&((eChartecharts6681=echarts.init(document.getElementById('echarts6681'))).setOption(optionecharts6681),eChartecharts6681ResizeHandler=function(){eChartecharts6681.resize()},window.addEventListener('resize',eChartecharts6681ResizeHandler));</script> <p>事实证明，Hexo 的内存占用确实减少了许多，但这是如何做到的？</p> <h2 id="优化字符串拼接"><a class="markdownIt-Anchor" href="#优化字符串拼接"></a> 优化字符串拼接</h2> <p>相关 PR：<a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/pull/5620">hexo#5620</a></p> <p>查看上面的图标，可以看到在整个博客生成的过程中，中间部分内存迅速增长，形成了第一个顶峰。通过一些调查，我发现这个内存快速增长的阶段实际上位于 Hexo 的 <code>lib/hexo/post.ts</code> 文件中的 <code>PostRenderEscape.escapeAllSwigTags</code> 函数中。</p> <p>那么，我们就来看看这个类中的代码：</p> <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="class_ title">PostRenderEscape</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="function_ title">escapeAllSwigTags</span>(<span class="params">str: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> idx = <span class="number">0</span>; idx &lt; length; idx++) &#123;</span><br><span class="line">      <span class="keyword">const</span> char = str[idx];</span><br><span class="line">      <span class="keyword">const</span> next_char = str[idx + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (state === <span class="constant_ variable">STATE_PLAINTEXT</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (char === <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (next_char === <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            output += char;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          output += char;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="constant_ variable">STATE_SWIG_TAG</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (char === <span class="string">&#x27;%&#x27;</span> &amp;&amp; next_char === <span class="string">&#x27;&#125;&#x27;</span>) &#123;</span><br><span class="line">          idx++;</span><br><span class="line">          <span class="keyword">if</span> (swig_tag_name !== <span class="string">&#x27;&#x27;</span> &amp;&amp; str.<span class="function_ title">includes</span>(<span class="string">`end<span class="subst">$&#123;swig_tag_name&#125;</span>`</span>)) &#123;</span><br><span class="line">            state = <span class="constant_ variable">STATE_SWIG_FULL_TAG</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            swig_tag_name = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            state = <span class="constant_ variable">STATE_PLAINTEXT</span>;</span><br><span class="line">            output += <span class="class_ title">PostRenderEscape</span>.escapeContent(<span class="language_ variable">this</span>.<span class="property">stored</span>, <span class="string">&#x27;swig&#x27;</span>, <span class="string">`&#123;%<span class="subst">$&#123;buffer&#125;</span>%&#125;`</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          buffer = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="constant_ variable">STATE_SWIG_VAR</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (char === <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; next_char === <span class="string">&#x27;&#125;&#x27;</span>) &#123;</span><br><span class="line">          idx++;</span><br><span class="line">          state = <span class="constant_ variable">STATE_PLAINTEXT</span>;</span><br><span class="line">          output += <span class="class_ title">PostRenderEscape</span>.escapeContent(<span class="language_ variable">this</span>.<span class="property">stored</span>, <span class="string">&#x27;swig&#x27;</span>, <span class="string">`&#123;&#123;<span class="subst">$&#123;buffer&#125;</span>&#125;&#125;`</span>);</span><br><span class="line">          buffer = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="constant_ variable">STATE_SWIG_COMMENT</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="constant_ variable">STATE_SWIG_FULL_TAG</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (char === <span class="string">&#x27;&#123;&#x27;</span> &amp;&amp; next_char === <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">          <span class="keyword">if</span> (swig_full_tag_end_buffer.<span class="function_ title">includes</span>(<span class="string">`end<span class="subst">$&#123;swig_tag_name&#125;</span>`</span>)) &#123;</span><br><span class="line">            state = <span class="constant_ variable">STATE_PLAINTEXT</span>;</span><br><span class="line">            output += <span class="class_ title">PostRenderEscape</span>.escapeContent(<span class="language_ variable">this</span>.<span class="property">stored</span>, <span class="string">&#x27;swig&#x27;</span>, <span class="string">`&#123;%<span class="subst">$&#123;swig_full_tag_start_buffer&#125;</span>%&#125;<span class="subst">$&#123;buffer&#125;</span>&#123;%<span class="subst">$&#123;swig_full_tag_end_buffer&#125;</span>%&#125;`</span>);</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">          &#125; </span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <p>Hexo 渲染 Markdown 的流程是这样的：</p> <ol> <li>将 Markdown 中的 code-fence 使用 highlight.js/Prism.js 进行高亮</li> <li>对 Markdown 中的 Swig 标签和高亮完成的代码块进行转义，以避免被 Markdown 渲染器渲染</li> <li>将 Markdown 使用诸如 <code>hexo-renderer-marked</code>、<code>hexo-renderer-markdown-it</code> 等渲染器渲染为 HTML 字符串</li> <li>使用 nunjucks 渲染 HTML 字符串，用于处理 Tag 标签</li> <li>将 HTML 字符串中的 Swig 标签和高亮完成的代码块进行反转义，生成最终的 HTML</li> </ol> <p>而 <code>PostRenderEscape.escapeAllSwigTags</code> 函数使用状态机对 Markdown 中的 Swig 标签进行转义。但是，这个函数的实现方式并不是很高效，你可以看到，它使用了大量的字符串拼接操作 <code>output += xxx</code>，这可能导致内存的快速增长。为了深究这个问题，我们需要了解 v8 引擎中的字符串存储方式。</p> <h3 id="v8-中的字符串"><a class="markdownIt-Anchor" href="#v8-中的字符串"></a> v8 中的字符串</h3> <p>为了保证性能，v8 中字符串的实现方式非常复杂，其使用了多种类型来存储字符串：</p> <ul> <li><code>STRING_TYPE</code>: 标准的字符串，使用 2 个字节存储</li> <li><code>ONE_BYTE_STRING_TYPE</code>: 仅包含 ASCII/Latin1 字符的字符串，使用 1 个字节存储</li> <li><code>INTERNALIZED_STRING_TYPE</code>: 内部化字符串，用于存储常量字符串</li> <li><code>EXTERNAL_STRING_TYPE</code>: 外部字符串，位于 v8 堆外</li> <li><strong><code>CONS_STRING_TYPE</code></strong>: 用于存储拼接后的字符串，其使用了 Rope 数据结构以减少内存占用</li> <li><code>SLICED_STRING_TYPE</code>: 用于存储字符串的子串，其使用了指针和 offset 来指向原始字符串，从而减少内存占用</li> <li><code>THIN_STRING_TYPE</code>: 当一个字符串需要被内部化而无法在原地进行内部化时，v8 会创建一个 ThinString 对象，其使用了指针来指向内部化后的字符串</li> </ul> <p>由此可见，v8 引擎在处理字符串时，会根据字符串的内容和长度来选择合适的存储方式，以减少内存占用。而使用 <code>+=</code> 运算符进行字符串拼接时，v8 引擎会将其转换为 <code>CONS_STRING_TYPE</code> 类型。每个 <code>ConsString</code> 实际上是一个二叉树，其中的左子树和右子树分别存储了拼接后的字符串的左半部分和右半部分。这种数据结构的好处是，可以在 O(log n) 的时间复杂度内完成字符串的拼接操作，且由于使用了指针共享相同的字符串片段，因此可以减少内存占用。</p> <p>但是，<code>ConsString</code> 也有一些缺点：每个 <code>ConsString</code> 需要额外占用 32 字节的内存。你可以通过以下方式来验证：</p> <figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">node --allow-natives-syntax</span><br><span class="line">&gt; var s = <span class="string">&quot;Hello&quot;</span> + <span class="string">&quot; Node JS !!&quot;</span>;</span><br><span class="line">undefined</span><br><span class="line">&gt; %DebugPrint(s)</span><br><span class="line">DebugPrint: 0000027B32941A81: [String]: c<span class="string">&quot;Hello Node JS !!&quot;</span></span><br><span class="line">00000368DF3C1BE9: [Map] <span class="keyword">in</span> ReadOnlySpace</span><br><span class="line"> - <span class="built_in">type</span>: CONS_ONE_BYTE_STRING_TYPE</span><br><span class="line"> - instance size: 32</span><br><span class="line"> - elements kind: HOLEY_ELEMENTS</span><br><span class="line"> - unused property fields: 0</span><br><span class="line"> - enum length: invalid</span><br><span class="line"> - back pointer: 0x0368df3c04e9 &lt;undefined&gt;</span><br><span class="line"> - prototype_validity cell: 0</span><br><span class="line"> - instance descriptors (own) <span class="comment">#0: 0x0368df3c0199 &lt;Other heap object (STRONG_DESCRIPTOR_ARRAY_TYPE)&gt;</span></span><br><span class="line"> - prototype: 0x0368df3c0269 &lt;null&gt;</span><br><span class="line"> - constructor: 0x0368df3c0269 &lt;null&gt;</span><br><span class="line"> - dependent code: 0x0368df3c0181 &lt;Other heap object (WEAK_ARRAY_LIST_TYPE)&gt;</span><br><span class="line"> - construction counter: 0</span><br></pre></td></tr></table></figure> <p>假设每篇文章有 5,000 个字符，共有 4,000 个帖子，那么 <code>ConsString</code> 将占用额外的 5,000 * 4,000 * 32B = 640MB 的内存。这就是为什么在 Hexo 渲染 Markdown 时，内存会迅速增长的原因。</p> <p><img src="https://fastly.jsdelivr.net/gh/D-Sketon/blog-img/407218397-295f45f6-26fa-4092-8277-98c233d35fcc.png" alt></p> <h3 id="优化字符串拼接-2"><a class="markdownIt-Anchor" href="#优化字符串拼接-2"></a> 优化字符串拼接</h3> <p>最简单的一个策略是在拼接完 <code>output</code> 字符串后，强制对其进行展平操作（Flatten）。展平操作会将 <code>CONS_STRING_TYPE</code> 转换为 <code>ONE_BYTE_STRING_TYPE</code>，从而减少内存占用。</p> <p>JS 中并没有直接提供展平操作的 API，但我们<strong>可能</strong>可以通过以下方式来实现：</p> <ul> <li><code>str[0]</code> 或 <code>str.charAt(0)</code> 使用索引访问字符串的字符</li> <li><code>str.length</code> 读取长度</li> <li><code>Number(str)</code>、<code>str | 0</code>、<code>parseInt(str)</code> 将字符串转换为数字</li> <li><code>reg.test(str)</code> 使用正则表达式匹配字符串</li> </ul> <p>但是，这种方式并不是很安全，因为 v8 引擎可能会对字符串进行优化，从而导致展平操作失败。经过测试，我发现这种方法非常不可靠，甚至 Node 的小版本变化都可能导致展平操作失败。</p> <p>那么，除了这个方法之外，我们还有什么办法来优化字符串拼接呢？最简单的方法就是手写一个 <code>StringBuilder</code> 类，用于存储拼接后的字符串。这个类的实现方式非常简单：</p> <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="class_ title">StringBuilder</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">buffer</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="function_ title">append</span>(<span class="params">str: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="language_ variable">this</span>.<span class="property">buffer</span>.<span class="function_ title">push</span>(str);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function_ title">toString</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language_ variable">this</span>.<span class="property">buffer</span>.<span class="function_ title">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <p>通过使用 <code>StringBuilder</code> 类，我们可以将 <code>output += xxx</code> 替换为 <code>sb.append(xxx)</code>，从而减少内存占用。这种方式的好处是，我们可以在拼接完字符串后，手动调用 <code>toString</code> 方法，从而绕过 <code>ConsString</code>。但是，这种方式会造成轻微的性能损失。不过，这种性能损失在我看来是值得的，因为它可以减少大量的内存占用。</p> <p>通过以上方法，我们成功地削减了 Hexo 的内存占用：</p> <p><img src="https://fastly.jsdelivr.net/gh/D-Sketon/blog-img/407218479-c01212ca-04ff-4080-a637-4f55878dde67.png" alt></p> <h2 id="优化文件写入"><a class="markdownIt-Anchor" href="#优化文件写入"></a> 优化文件写入</h2> <p>相关 PR：<a target="_blank" rel="noopener" href="https://github.com/hexojs/warehouse/pull/277/files">warehouse#277</a></p> <p>除了中间内存占用的问题，Hexo 在生成阶段的结束阶段内存也会飙升。这让我很快就联想到了 Hexo 会在退出之前将 warehouse 中的数据全部写进 <code>db.json</code> 中用于热启动。查看导出相关的代码：</p> <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// database.ts</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="function_ title">exportAsync</span>(<span class="params">database: Database, path: <span class="built_in">string</span></span>): <span class="class_ title">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> handle = <span class="keyword">await</span> <span class="function_ title">open</span>(path, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Start body &amp; Meta &amp; Start models</span></span><br><span class="line">    <span class="keyword">await</span> handle.<span class="function_ title">write</span>(<span class="string">`&#123;&quot;meta&quot;:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      version: database.options.version,</span></span></span><br><span class="line"><span class="subst"><span class="string">      warehouse: pkg.version</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;)&#125;</span>,&quot;models&quot;:&#123;`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> models = database.<span class="property">_models</span>;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="class_ title">Object</span>.<span class="function_ title">keys</span>(models);</span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = keys;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// models body</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = keys[i];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!models[key]) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> buffers = [];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (i) buffers.<span class="function_ title">push</span>(<span class="class_ title">Buffer</span>.<span class="function_ title">from</span>(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;ascii&#x27;</span>));</span><br><span class="line"></span><br><span class="line">      buffers.<span class="function_ title">push</span>(<span class="class_ title">Buffer</span>.<span class="function_ title">from</span>(<span class="string">`&quot;<span class="subst">$&#123;key&#125;</span>&quot;:`</span>));</span><br><span class="line"></span><br><span class="line">      buffers.<span class="function_ title">push</span>(<span class="class_ title">Buffer</span>.<span class="function_ title">from</span>(models[key].<span class="function_ title">_export</span>()));</span><br><span class="line">      <span class="keyword">await</span> <span class="function_ title">_writev</span>(handle, buffers);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// End models</span></span><br><span class="line">    <span class="keyword">await</span> handle.<span class="function_ title">write</span>(<span class="string">&#x27;&#125;&#125;&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> handle.<span class="function_ title">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// model.ts</span></span><br><span class="line"><span class="function_ title">_export</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class_ title">JSON</span>.<span class="function_ title">stringify</span>(<span class="language_ variable">this</span>.<span class="function_ title">toJSON</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function_ title">toJSON</span>(): <span class="built_in">any</span>[] &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">new</span> <span class="class_ title">Array</span>(<span class="language_ variable">this</span>.<span class="property">length</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; data, schema &#125; = <span class="language_ variable">this</span>;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="language_ variable">this</span>.<span class="property">dataKeys</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; length &#125; = keys;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, num = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> raw = data[keys[i]];</span><br><span class="line">    <span class="keyword">if</span> (raw) &#123;</span><br><span class="line">      result[num++] = schema.<span class="function_ title">_exportDatabase</span>(<span class="function_ title">cloneDeep</span>(raw) <span class="keyword">as</span> <span class="built_in">object</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <p>以上代码非常好理解：将每个 Model 中的所有数据全部深克隆，并将其转换为 JSON 字符串，然后写入文件。但是，这种方式会导致内存飙升，因为在写入文件之前，需要将所有数据全部转换为 JSON 字符串，并在多个函数之间进行传递。这种写法对逃逸分析的优化效果并不好，由此导致了内存飙升。</p> <p>想要减少内存占用，最好的策略是将字符串写入改为流式的写入。这样，我们就可以在对 Model 进行深克隆的同时，将其同时转换为 JSON 并写入文件：</p> <figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> asyncWriteToStream&lt;T&gt;(<span class="attr">stream</span>: <span class="class_ title">Writable</span>, <span class="attr">chunk</span>: T): <span class="class_ title">Promise</span>&lt;<span class="built_in">unknown</span>&gt; | <span class="literal">null</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> waitDrain = !stream.<span class="function_ title">write</span>(chunk);</span><br><span class="line">  <span class="keyword">if</span> (waitDrain) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function_ title">once</span>(stream, <span class="string">&#x27;drain&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function_ title">toJSONStream</span>(<span class="attr">writeStream</span>: <span class="class_ title">Writable</span>): <span class="class_ title">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">p</span>: <span class="class_ title">Promise</span>&lt;<span class="built_in">unknown</span>&gt; | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, schema &#125; = <span class="language_ variable">this</span>;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="language_ variable">this</span>.<span class="property">dataKeys</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; length &#125; = keys;</span><br><span class="line"></span><br><span class="line">  p = <span class="function_ title">asyncWriteToStream</span>(writeStream, <span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (p) <span class="keyword">await</span> p;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> raw = data[keys[i]];</span><br><span class="line">    <span class="keyword">if</span> (raw) &#123;</span><br><span class="line">      <span class="keyword">const</span> prefix = i === <span class="number">0</span> ? <span class="string">&#x27;&#x27;</span> : <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">      p = <span class="function_ title">asyncWriteToStream</span>(writeStream, <span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(schema._exportDatabase(cloneDeep(raw) <span class="keyword">as</span> <span class="built_in">object</span>))&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (p) <span class="keyword">await</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  p = <span class="function_ title">asyncWriteToStream</span>(writeStream, <span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (p) <span class="keyword">await</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <p>我们将 <code>toJSON</code> 方法改为了 <code>toJSONStream</code> 方法，该方法摒弃了将所有数据转换为 JSON 字符串的方式，而是在遍历数据的同时，将其转换为 JSON 字符串并写入文件。这种方式将克隆出的对象和生成的 JSON 字符串的作用于限定在了一个函数内，有利于 v8 引擎的逃逸分析，再配合上流式写入，可以有效减少内存占用。</p> </div> <footer class="article-footer"> <blockquote class="article-copyright"> <p><strong><span class="icon icon-user"></span>本文作者：</strong>D-Sketon</p> <p><strong><span class="icon icon-link"></span>本文链接：</strong><a href="https://d-sketon.github.io/20250131/hexo-source2/">https://d-sketon.github.io/20250131/hexo-source2/</a></p> <p><strong><span class="icon icon-copyright"></span>本文版权：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="nofollow noopener noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> 许可协议。转载请注明出处！</p> <span class="article-copyright-bg icon-creative-commons"></span> </blockquote> <div class="share-wrapper"> <a href="https://connect.qq.com/widget/shareqq/index.html?url=www.baidu.com&amp;title=%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A9Hexo%E5%8D%A0%E7%94%A8%E7%9A%84%E5%86%85%E5%AD%98%E5%87%8F%E5%B0%9130%25%E7%9A%84&amp;desc=%E4%BC%97%E6%89%80%E5%91%A8%E7%9F%A5%EF%BC%8CHexo%20%E8%99%BD%E7%84%B6%E6%98%AF%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E4%BC%98%E7%A7%80%E7%9A%84%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%BD%86%E6%98%AF%E7%94%B1%E4%BA%8E%20Node.js%20%E7%9A%84%E7%89%B9%E6%80%A7%EF%BC%8CHexo%20%E5%9C%A8%E7%BC%96%E8%AF%91%E7%9A%84%E6%97%B6%E5%80%99%E7%9B%B8%E6%AF%94%E4%BA%8E%20Hugo%20%E4%BC%9A%E5%8D%A0%E7%94%A8%E5%A4%A7%E9%87%8F%E7%9A%84%E5%86%85%E5%AD%98%EF%BC%8C%E8%BF%99%E5%AF%B9%E4%BA%8E%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%E8%BE%83%E4%BD%8E%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%A5%E8%AF%B4%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%88%E5%A4%A7%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82%235522%E3%80%81%232165%20%E7%AD%89%20ISSUE%20%E4%B9%9F%E5%8F%8D%E6%98%A0%E4%BA%86%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%E9%9A%BE%E9%81%93%E8%BF%99%E5%B0%B1%E6%98%AF%20Hexo%20%E7%9A%84%E6%9E%81%E9%99%90%E4%BA%86%E5%90%97%EF%BC%9F%E5%BD%93%E7%84%B6%E4%B8%8D%E6%98%AF%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%88%91%E5%B0%B1%E6%9D%A5%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%A9%20Hexo%20%E5%8D%A0%E7%94%A8%E7%9A%84%E5%86%85%E5%AD%98%E5%87%8F%E5%B0%91%2030%25%20%E7%9A%84%E3%80%82&amp;source=https%3A%2F%2Fd-sketon.github.io" target="_blank" rel="noopener noreferrer" title="我是如何让Hexo占用的内存减少30%的"> <div class="icon icon-qq share-icon"> </div> </a> <a href="javascript:;" title="我是如何让Hexo占用的内存减少30%的"> <div class="icon icon-weixin share-icon"> <div id="share-weixin"> <div class="share-weixin-dom"> <div class="share-weixin-content"> <img id="share-weixin-banner"> <div id="share-weixin-title"></div> <div id="share-weixin-desc"></div> </div> <div class="share-weixin-qrcode"> <div class="share-weixin-info"> <div id="share-weixin-author"></div> <div id="share-weixin-theme">Powered By hexo-theme-reimu</div> </div> <img id="share-weixin-qr"> </div> </div> <div class="share-weixin-canvas"></div> </div> </div> </a> </div> <a data-aos="zoom-in" href="/20250131/hexo-source2/#comments" class="article-comment-link"> <span class="post-comments-count waline-comment-count" data-path="/20250131/hexo-source2/" itemprop="commentCount"></span> 留言 </a> <span data-aos="zoom-in" class="article-visitor-link"> <span class="waline-pageview-count" data-path="/20250131/hexo-source2/">0</span> <em class="post-meta-item-text">阅读量</em> </span> <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/Hexo/" rel="tag" title="Hexo">Hexo</a></li></ul> </footer> </div> <nav id="article-nav" aria-label="Article navigation" data-aos="fade-up"> <div class="article-nav-link-wrap left"> <img data-src="https://d-sketon.top/img/_backwebp480/bg28.webp" data-sizes="auto" alt="如何为Hexo添加多语言支持" class="lazyload"> <a href="/20250223/hexo-theme-reimu-i18n/" aria-label="前一篇: 如何为Hexo添加多语言支持" title="前一篇: 如何为Hexo添加多语言支持"></a> <div class="article-nav-caption">前一篇</div> <h3 class="article-nav-title"> 如何为Hexo添加多语言支持 </h3> </div> <div class="article-nav-link-wrap right"> <img data-src="/images/Promise.webp" data-sizes="auto" alt="2024年 JavaScript Promise 性能对比" class="lazyload"> <a href="/20241221/2024-promise-performance-benchmark/" aria-label="后一篇: 2024年 JavaScript Promise 性能对比" title="后一篇: 2024年 JavaScript Promise 性能对比"></a> <div class="article-nav-caption">后一篇</div> <h3 class="article-nav-title"> 2024年 JavaScript Promise 性能对比 </h3> </div> </nav> </article> <section id="comments" data-aos="fade-up"> <div class="comment-header"> <h2 class="comment-title">说些什么吧！</h2> <div class="comment-selector"> <div class="comment-selector-wrap"> <div class="selector-item" data-selector="waline"> <span>waline</span> </div> </div> </div> </div> <div class="comment-content"> <div class="comment waline-comment" data-aos="fade-up" id="waline-comment"> </div> </div> </section> </section> </div> <footer id="footer" aria-label="Site footer"> <div style="width:100%;overflow:hidden"> <div class="footer-line"></div> </div> <div id="footer-info"> <div> <span class="icon-copyright"></span> 2020-2025 <span class="footer-info-sep rotate"></span> D-Sketon </div> <div> 基于&nbsp;<a href="https://hexo.io/" rel="nofollow noopener noreferrer" target="_blank">Hexo</a>&nbsp; Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="nofollow noopener noreferrer" target="_blank">Reimu</a> </div> <div> <span class="icon-brush"></span> 178.9k &nbsp;|&nbsp; <span class="icon-coffee"></span> 14:35 </div> <div> <span class="icon-eye"></span> <span id="busuanzi_container_site_pv">总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></span> &nbsp;|&nbsp; <span class="icon-user"></span> <span id="busuanzi_container_site_uv">总访客量&nbsp;<span id="busuanzi_value_site_uv"></span></span> </div> </div> </footer> <div class="sidebar-top"> <div class="rotate sidebar-top-taichi"></div> <div class="arrow-up"></div> </div> <div id="mask" class="hide"></div> </div> <nav id="mobile-nav" aria-label="Mobile navigation"> <div class="sidebar-wrap"> <div class="sidebar-toc-sidebar"><h3 class="toc-title">文章目录</h3> <div class="sidebar-toc-wrapper toc-div-class"> <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.</span> <span class="toc-text"> 优化字符串拼接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#v8-%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.1.</span> <span class="toc-text"> v8 中的字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5-2"><span class="toc-number">1.2.</span> <span class="toc-text"> 优化字符串拼接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text"> 优化文件写入</span></a></li></ol> </div> </div> <div class="hidden sidebar-common-sidebar"><div class="sidebar-author"> <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="D-Sketon" class="lazyload"> <div class="sidebar-author-name">D-Sketon</div> <div class="sidebar-description">D-Sketon&#39;s blog</div> </div> <div class="sidebar-state"> <div class="sidebar-state-article"> <div>文章</div> <div class="sidebar-state-number">75</div> </div> <div class="sidebar-state-category"> <div>分类</div> <div class="sidebar-state-number">10</div> </div> <div class="sidebar-state-tag"> <div>标签</div> <div class="sidebar-state-number">19</div> </div> </div> <div class="sidebar-social"> <div class="icon-github sidebar-social-icon"> <a href="https://github.com/D-Sketon" itemprop="url" target="_blank" aria-label="github" rel="nofollow noopener noreferrer"></a> </div> <div class="icon-bilibili sidebar-social-icon"> <a href="https://space.bilibili.com/20339857" itemprop="url" target="_blank" aria-label="bilibili" rel="nofollow noopener noreferrer"></a> </div> </div> <div class="sidebar-menu"> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/" aria-label="首页"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">首页</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/archives" aria-label="归档"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">归档</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/about" aria-label="关于"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">关于</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/friend" aria-label="友链"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">友链</div> </div> </div> </div> </div> <div class="sidebar-btn-wrapper"> <div class="current sidebar-toc-btn"></div> <div class="sidebar-common-btn"></div> </div> </nav> </div> <div class="site-search"> <div class="popup reimu-popup"> <div class="reimu-search"> <div class="reimu-search-input-icon"></div> <div id="reimu-search-input"></div> <div class="popup-btn-close"></div> </div> <div class="reimu-results"> <div id="reimu-stats"></div> <div id="reimu-hits"></div> <div id="reimu-pagination" class="reimu-pagination"></div> </div> <img class="reimu-bg" src="/images/reimu.png"> </div> </div> <script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin></script> <script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin></script> <script src="/js/script.js"></script> <script src="/js/aos.js"></script> <script>var aosInit=()=>{AOS.init({duration:1e3,easing:'ease',once:!0,offset:50})};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',aosInit):aosInit();</script> <script src="/js/pjax_script.js" data-pjax></script> <script>var ALGOLIA_CONFIG={logo:'/images/algolia_logo.svg',algolia:{applicationID:'AIE5T9AKYQ',apiKey:'2b855b06a058dd80bc84972874e020aa',indexName:'reimu_new_algoliasearch',hits:{per_page:parseInt('10')},labels:{input_placeholder:'搜索.....',hits_empty:'未发现与 「${query}」相关内容',hits_stats:'找到${hits}条结果（用时 ${time} ms）'}}};</script> <script src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js" integrity="sha384-xvLS0jfKuoREs7pqkRI&#x2F;OI8GcqohO5S+jQz7ZBtQXnsXmD+9jDOOY4cL6dCPzlrk" crossorigin defer></script> <script src="https://npm.webcache.cn/@reimujs/instantsearch.js@4.57.0-beta.1/dist/instantsearch.production.min.js" integrity="sha384-aagKMe8nkqaP2DYQc8kkYOL5l+M5Q2WH&#x2F;Uhr4teOh0Ybp0RZj0kUSDm45qPikMjK" crossorigin defer></script> <script src="/js/algolia_search.js" defer></script> <script src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js" integrity="sha384-8LyaidD9GPxQQgLJO&#x2F;WRw&#x2F;O2h3BoNq&#x2F;ApI&#x2F;ecpvM6RsrCz2qP2ppBXUKihP4V&#x2F;2d" crossorigin></script> <script>window.matchMedia('(max-width: 768px)').matches||window.firework&&window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["var(--red-0)"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'));</script> <script src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js" integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE&#x2F;jMSCxD+jAPU55x&#x2F;jj3wlf" crossorigin></script> <script src="/js/pjax.js"></script> <div id="lazy-script"> <div> <script data-pjax>window.REIMU_POST={author:'D-Sketon',title:'我是如何让Hexo占用的内存减少30%的',url:'https://d-sketon.github.io/20250131/hexo-source2/',excerpt:'众所周知，Hexo 虽然是一个非常优秀的静态博客框架，但是由于 Node.js 的特性，Hexo 在编译的时候相比于 Hugo 会占用大量的内存，这对于一些配置较低的服务器来说是一个很大的问题。#5522、#2165 等 ISSUE 也反映了这个问题。难道这就是 Hexo 的极限了吗？当然不是，下面我就来介绍一下我是如何让 Hexo 占用的内存减少 30% 的。',description:'',stripContent:'众所周知，Hexo 虽然是一个非常优秀的静态博客框架，但是由于 Node.js 的特性，Hexo 在编译的时候相比于 Hugo 会占用大量的内存，这对于一些配置较低的服务器来说是一个很大的问题。#5522、#2165 等 ISSUE 也反映了这个问题。难道这就是 Hexo 的极限了吗？当然不是，下面我就来介绍一下我是如何让 Hexo 占用的内存减少 30% 的。  首先，介绍一下我的环境和我是如何进行 benchmark 的。 我的环境为： 1234OS: Windows_NT 10.0.226',date:'Fri Jan 31 2025 15:32:04 GMT+0800',updated:'Fri Jan 31 2025 15:32:04 GMT+0800',cover:'/images/banner.webp'};</script> <script src="/js/insert_highlight.js" data-pjax></script> <script src="https://npm.webcache.cn/@zumer/snapdom@1.9.14/dist/snapdom.min.js" integrity="sha384-OEQ+fJp&#x2F;Mvi2uzBREXybtxryJvLytWapuHu4EE6LPwTKUwATYcc55tPPcZTzVcmx" crossorigin defer data-pjax></script> <script src="https://npm.webcache.cn/qrcode@1.5.1/build/qrcode.js" integrity="sha384-VT1EeewTCEXgndcPMQ0PzV+uVFYjxFIjmAA7s5gcMX9t4Dt5TD+OVQIn7NJWIXn7" crossorigin defer data-pjax></script> <script type="module" data-pjax>let PhotoSwipeLightbox=(await safeImport('https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js','sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/')).default,initPswp=(gallery,children)=>{0<_$$(gallery+' '+children).length&&new PhotoSwipeLightbox({gallery:gallery,children:children,pswpModule:()=>safeImport('https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js','sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s')}).init()},pswp=()=>{initPswp('.article-entry','a.article-gallery-item'),initPswp('.article-gallery','a.article-gallery-item'),window.lightboxStatus='done',window.removeEventListener('lightbox:ready',pswp)};'ready'===window.lightboxStatus?pswp():window.addEventListener('lightbox:ready',pswp);</script> <script data-pjax>var savedCommentType,configDefault,loadScript=(src,integrity)=>{var script=document.createElement('script');return script.src=src,integrity&&(script.integrity=integrity),script.crossOrigin='anonymous',script},commentConfigKeys=['waline'],commentConfig={waline:{enable:!0,load:async()=>{var container=document.querySelector('.waline-comment');container&&(container.style.display='block',container=(await safeImport('https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.mjs','sha384-9sbqJjrfGjbkI6/PI4nU/MvBfEmkkPC4YK9I4zBeMIf1CVCZdCMH/KinBEAZII/5')).init,window.walineInstance=container({el:'.waline-comment',serverURL:'https://reimu.d-sketon.top',lang:document.documentElement.lang||'en',locale:{},emoji:['https://unpkg.com/@waline/emojis@1.2.0/weibo','https://unpkg.com/@waline/emojis@1.2.0/alus','https://unpkg.com/@waline/emojis@1.2.0/bilibili','https://unpkg.com/@waline/emojis@1.2.0/qq','https://unpkg.com/@waline/emojis@1.2.0/tieba','https://unpkg.com/@waline/emojis@1.2.0/tw-emoji'],meta:['nick','mail','link'],requiredMeta:['nick','mail'],wordLimit:JSON.parse('0'),comment:!0,pageSize:JSON.parse('10'),dark:'html[data-theme="dark"]',pageview:JSON.parse('true')}))}}},defaultComment=(commentConfig.enable=commentConfigKeys.some(key=>commentConfig[key].enable),'');function loadComments(){if(commentConfig.enable){let loadedComments={valine:!1,waline:!1,twikoo:!1,gitalk:!1,giscus:!1},hideAllComments=()=>{document.querySelectorAll('.comment').forEach(container=>{container.style.display='none'})},loadCommentSystem=type=>{loadedComments[type]?document.querySelector(`.${type}-comment`).style.display='block':(commentConfig[type]?.load(),loadedComments[type]=!0)};var commentInit=()=>{var defaultSelectorItem;for(let item of document.querySelectorAll('.selector-item'))item.addEventListener('click',()=>{var commentType=item.getAttribute('data-selector');window.localStorage.setItem('commentType',commentType),(item=>{var commentItems=document.querySelectorAll('.selector-item');for(let i=0;i<commentItems.length;i++)commentItems[i].classList.remove('active');item.classList.add('active');item=item.getAttribute('data-selector');hideAllComments(),loadCommentSystem(item)})(item)});defaultComment&&(defaultSelectorItem=document.querySelector(`[data-selector="${defaultComment}"]`))&&(defaultSelectorItem.style.display='block',defaultSelectorItem.classList.add('active'),loadCommentSystem(defaultComment))};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',commentInit):commentInit()}}commentConfig.enable&&(savedCommentType=localStorage.getItem('commentType'),(defaultComment=savedCommentType&&commentConfig[savedCommentType]?.enable?savedCommentType:defaultComment)||commentConfig[configDefault='waline']?.enable&&(defaultComment=configDefault),defaultComment=defaultComment||commentConfigKeys.find(sys=>commentConfig[sys].enable)||''),loadComments();</script> </div> </div> <script>console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;'),console.log('%c Theme.Reimu v1.10.4 %c https://github.com/D-Sketon/hexo-theme-reimu ','color: white; background: #ff5252; padding:5px 0;','padding:4px;border:1px solid #ff5252;');</script> <script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin async></script> <script>'serviceWorker'in navigator&&navigator.serviceWorker.getRegistrations().then(registrations=>{for(var registration of registrations)registration.unregister()});</script> <script src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js" integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL&#x2F;aORyw+5+HZoU6e" crossorigin></script> <script>var meting_api='https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r';</script> <script>if(!window.matchMedia('(max-width: 768px)').matches){if(window.matchMedia('(max-width: 959px)').matches){let meting=_$('meting-js');if(meting){meting.setAttribute('fixed','true');let aside=meting.parentNode?.parentNode;'ASIDE'===aside?.tagName&&(meting.parentNode.removeChild(meting),document.body.appendChild(meting))}}let script=document.createElement('script');script.src='https://npm.webcache.cn/meting@2.0.1/dist/Meting.min.js',script.integrity='sha384-ASVlpKF80A22OXTK3tfEjZm1EL6uFMKIC4p8+0maanw1S/IyB+Y4JG+ZDU7GpKE8',script.crossOrigin='anonymous',document.body.appendChild(script)}</script> <script data-pjax>setTimeout(()=>{var e,echartsList=Object.keys(window).filter(e=>e.startsWith('eChartecharts')&&!e.endsWith('ResizeHandler')).map(e=>window[e]),updateEchartsDarkMode=e=>{if(echartsList?.length)for(var t of echartsList)t?.setTheme('dark'===e?'dark':'default')},_emode=(document.body.addEventListener('dark-theme-set',()=>updateEchartsDarkMode('dark')),document.body.addEventListener('light-theme-set',()=>updateEchartsDarkMode('default')),localStorage.getItem('dark_mode'));'auto'===_emode?(e=window.matchMedia('(prefers-color-scheme: dark)').matches,updateEchartsDarkMode(e?'dark':'default')):updateEchartsDarkMode('true'===_emode?'dark':'default')},2e3);</script> </body></html>