<!DOCTYPE html><html lang="en" data-theme-mode="auto"><head><meta charset="utf-8"><script async src="https://hm.baidu.com/hm.js?55ca897d064d6eb98df32d62c6984cc0"></script><script data-pjax>var _hmt=_hmt||[];_hmt.push(['_trackPageview',location.pathname]);</script><script>window.REIMU_CONFIG={},window.REIMU_CONFIG.icon_font='4552607_4k4bc36ef96',window.REIMU_CONFIG.clipboard_tips={success:{'zh-CN':'复制成功 (*^▽^*)',en:'Copy successfully (*^▽^*)'},fail:{'zh-CN':'复制失败 (ﾟ⊿ﾟ)ﾂ',en:'Copy failed (ﾟ⊿ﾟ)ﾂ'},copyright:{enable:!1,count:50,license_type:'by-nc-sa'}},window.REIMU_CONFIG.clipboard_tips.copyright.content='本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！',window.REIMU_CONFIG.code_block={expand:!0},window.REIMU_CONFIG.base='https://d-sketon.github.io',window.REIMU_CONFIG.i18n_languages=['en'];</script><title> 数据库系统概念 学习笔记 | 拔剑Sketon </title><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="preload" as="style" href="https://fontsapi.zeoseven.com/292/main/result.css" onload="this.rel&#x3D;&#39;stylesheet&#39;" crossorigin><link rel="preload" href="//at.alicdn.com/t/c/font_4552607_4k4bc36ef96.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="/css/loader.css"><meta name="description" content="本笔记整理来自于《数据库系统概念》，可能会有疏漏的部分，敬请谅解"><meta property="og:type" content="article"><meta property="og:title" content="数据库系统概念 学习笔记"><meta property="og:url" content="https://d-sketon.github.io/en/20220816/db-book-note/index.html"><meta property="og:site_name" content="拔剑Sketon"><meta property="og:description" content="本笔记整理来自于《数据库系统概念》，可能会有疏漏的部分，敬请谅解"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://d-sketon.top/img/db-book/1.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/2.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/3.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/4.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/5.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/6.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/7.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/8.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/9.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/10.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/11.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/12.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/13.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/14.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/15.png"><meta property="og:image" content="https://d-sketon.top/img/db-book/16.png"><meta property="article:published_time" content="2022-08-16T07:48:09.000Z"><meta property="article:modified_time" content="2025-02-02T03:35:48.067Z"><meta property="article:author" content="D-Sketon"><meta property="article:tag" content="数据库"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://d-sketon.top/img/db-book/1.png"><link rel="alternate" href="/atom.xml" title="拔剑Sketon" type="application/atom+xml"><link rel="icon shortcut" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" integrity="sha384-IfxC36XL&#x2F;toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx&#x2F;1oA&#x2F;0l8ysE" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l&#x2F;9On385z&#x2F;&#x2F;&#x2F;+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.css" integrity="sha384-vltfZtesCdl6NYVcFVcjEaIi5RpNvZe9t7fXvq8twVtcoy+Ub9QgnxUYJmwOhYCK" crossorigin><link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css" integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin><link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.css" integrity="sha384-tLMkTWh2pfXNWGFlUS0w1TFtRG5xZ9lPWFOooj+vDDLIL+xBGQU&#x2F;voDBY5XE2lVh" crossorigin><meta name="generator" content="Hexo 8.0.0"></head><body> <div id="loader"> <div class="loading-bg loading-left-bg"></div> <div class="loading-bg loading-right-bg"></div> <div class="spinner-box"> <div class="loading-taichi rotate"> <svg width="150" height="150" viewbox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision"> <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)"></path> <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)"></path> </svg> </div> <div class="loading-word">Loading...</div> </div> </div> <script>var time=null,loaderEl=document.getElementById('loader'),startLoading=()=>{time=Date.now(),loaderEl.classList.remove('loading')},hideLoader=()=>{document.body.style.overflow='auto',loader.classList.add('loading')},endLoading=()=>{time?500<Date.now()-time?(time=null,hideLoader()):(setTimeout(endLoading,500-(Date.now()-time)),time=null):hideLoader()};window.addEventListener('DOMContentLoaded',endLoading),loaderEl.addEventListener('click',endLoading);</script> <div id="copy-tooltip"></div> <div id="heatmap-tooltip"></div> <div id="container"> <div id="wrap"> <div id="header-nav"> <nav id="main-nav" aria-label="Primary navigation"> <span class="main-nav-link-wrap"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <a class="main-nav-link" href="/en/">Home</a> </span> <span class="main-nav-link-wrap"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <a class="main-nav-link" href="/en/archives">Archives</a> </span> <span class="main-nav-link-wrap"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <a class="main-nav-link" href="/en/about">About</a> </span> <span class="main-nav-link-wrap"> <div class="icon main-nav-icon rotate"> &#xe62b; </div> <a class="main-nav-link" href="/en/friend">Friend</a> </span> <a id="main-nav-toggle" class="nav-icon" aria-label="Toggle navigation" role="button"></a> </nav> <nav id="sub-nav" aria-label="Secondary navigation"> <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed" aria-label="RSS Feed" target="_blank"></a> <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search" aria-label="Search"></a> </nav> <nav id="i18n-nav" aria-label="Language selection"> <div class="custom-dropdown"> <div class="select-selected" id="select-selected" role="button" aria-haspopup="listbox" aria-expanded="false" aria-label="Language menu"> <span id="nav-language-btn" class="nav-icon" style="padding:0 20px 0 0"></span> <span id="selected-lang">English</span> </div> <ul class="select-items" id="select-items" role="listbox" aria-label="Languages"> <li data-value="zh-CN" role="option" aria-selected="false">简体中文</li> <li data-value="en" role="option" class="selected" aria-selected="true">English</li> </ul> </div> <script>var selectSelected=document.getElementById('select-selected'),selectedLang=document.getElementById('selected-lang'),selectItems=document.getElementById('select-items'),selectOptions=selectItems.querySelectorAll('li');selectSelected.addEventListener('click',()=>{selectItems.classList.toggle('show');var expanded='true'===selectSelected.getAttribute('aria-expanded');selectSelected.setAttribute('aria-expanded',(!expanded).toString())}),selectOptions.forEach(item=>{item.addEventListener('click',()=>{var langMap={'zh-CN':'/20220816/db-book-note/',en:'/en/20220816/db-book-note/'};selectedLang.textContent=item.textContent,selectItems.classList.remove('show'),selectOptions.forEach(option=>{option.classList.remove('selected')}),item.classList.add('selected'),window.location=langMap[item.dataset.value]})}),document.addEventListener('click',event=>{event.target.closest('.custom-dropdown')||(selectItems.classList.remove('show'),selectSelected.setAttribute('aria-expanded','false'))});</script> </nav> </div> <header id="header" aria-label="Site header"> <picture> <source media="(max-width: 479px)" srcset="/images/banner-600w.webp"> <source media="(max-width: 799px)" srcset="/images/banner-800w.webp"> <source media="(min-width: 800px)" srcset="/images/banner.webp"> <img fetchpriority="high" src="/images/banner.webp" alt="数据库系统概念 学习笔记"> </picture> <img alt="数据库系统概念 学习笔记" style="visibility:hidden"> <div id="header-outer"> <div id="header-title"> <span id="logo"> <h1 data-aos="slide-up">数据库系统概念 学习笔记</h1> </span> <h2 id="subtitle-wrap" data-aos="slide-down"> </h2> </div> </div> </header> <div id="content" aria-label="Page content" class="sidebar-left"> <aside id="sidebar" aria-label="Sidebar"> <div class="sidebar-wrapper-container sticky"> <meting-js theme="var(--color-link)" id="2265921590" server="netease" type="playlist" order="random" list-folded="true"></meting-js> <div class="sidebar-wrapper"> <div class="sidebar-wrap" data-aos="fade-up"> <div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3> <div class="sidebar-toc-wrapper toc-div-class"> <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text"> 引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-database"><span class="toc-number">1.1.</span> <span class="toc-text"> 数据库-DataBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-dbmsdatabase-management-system"><span class="toc-number">1.2.</span> <span class="toc-text"> 数据库管理系统-DBMS（DataBase Management System）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text"> 数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.4.</span> <span class="toc-text"> 数据抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8Binstance%E5%92%8C%E6%A8%A1%E5%BC%8Fschema"><span class="toc-number">1.5.</span> <span class="toc-text"> 实例（instance）和模式（schema）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E8%A8%80"><span class="toc-number">1.6.</span> <span class="toc-text"> 数据库语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80ddl"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 数据定义语言（DDL）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80dml"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 数据操纵语言（DML）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">1.7.</span> <span class="toc-text"> SQL 查询语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.8.</span> <span class="toc-text"> 数据库设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E"><span class="toc-number">1.9.</span> <span class="toc-text"> 数据库引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">1.10.</span> <span class="toc-text"> 存储管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text"> 查询处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.12.</span> <span class="toc-text"> 事务管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text"> 关系模型介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text"> 关系模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8Fdatabase-schema"><span class="toc-number">2.2.</span> <span class="toc-text"> 数据库模式（database schema）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE"><span class="toc-number">2.3.</span> <span class="toc-text"> 键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0relational-algebra"><span class="toc-number">2.4.</span> <span class="toc-text"> 关系代数（relational algebra）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97select"><span class="toc-number">2.4.1.</span> <span class="toc-text"> 选择运算（select）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1%E8%BF%90%E7%AE%97projection"><span class="toc-number">2.4.2.</span> <span class="toc-text"> 投影运算（projection）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E8%BF%90%E7%AE%97product"><span class="toc-number">2.4.3.</span> <span class="toc-text"> 笛卡尔积运算（product）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%90%E7%AE%97join"><span class="toc-number">2.4.4.</span> <span class="toc-text"> 连接运算（join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">2.4.5.</span> <span class="toc-text"> 集合运算</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A4intersection"><span class="toc-number">2.4.5.1.</span> <span class="toc-text"> 交（intersection）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B6union"><span class="toc-number">2.4.5.2.</span> <span class="toc-text"> 并（union）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%AEdifference"><span class="toc-number">2.4.5.3.</span> <span class="toc-text"> 差（difference）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E5%90%8D%E8%BF%90%E7%AE%97rename"><span class="toc-number">2.4.6.</span> <span class="toc-text"> 更名运算（rename）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97assignment"><span class="toc-number">2.4.7.</span> <span class="toc-text"> 赋值运算（assignment）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E8%BF%90%E7%AE%97aggregation"><span class="toc-number">2.4.8.</span> <span class="toc-text"> 聚合运算（aggregation）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.4.9.</span> <span class="toc-text"> 等价查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text"> SQL介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E7%BB%84%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text"> SQL组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.</span> <span class="toc-text"> 数据定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8"><span class="toc-number">3.3.</span> <span class="toc-text"> 建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8"><span class="toc-number">3.4.</span> <span class="toc-text"> 更新表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.5.</span> <span class="toc-text"> 查询语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97-2"><span class="toc-number">3.6.</span> <span class="toc-text"> 集合运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC"><span class="toc-number">3.7.</span> <span class="toc-text"> 空值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E5%92%8C%E7%A9%BA%E5%80%BC"><span class="toc-number">3.7.1.</span> <span class="toc-text"> 聚集函数和空值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.8.</span> <span class="toc-text"> 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%88%90%E5%91%98%E8%B5%84%E6%A0%BC"><span class="toc-number">3.8.1.</span> <span class="toc-text"> 集合成员资格</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%AF%94%E8%BE%83"><span class="toc-number">3.8.2.</span> <span class="toc-text"> 集合比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E5%85%B3%E7%B3%BB%E6%B5%8B%E8%AF%95"><span class="toc-number">3.8.3.</span> <span class="toc-text"> 空关系测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%85%83%E7%BB%84%E5%AD%98%E5%9C%A8%E6%80%A7%E6%B5%8B%E8%AF%95"><span class="toc-number">3.8.4.</span> <span class="toc-text"> 重复元组存在性测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#from%E5%AD%90%E5%8F%A5%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.8.5.</span> <span class="toc-text"> FROM子句的子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#with%E5%AD%90%E5%8F%A5"><span class="toc-number">3.8.6.</span> <span class="toc-text"> WITH子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2scalar-subquery"><span class="toc-number">3.8.7.</span> <span class="toc-text"> 标量子查询（scalar subquery）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.9.</span> <span class="toc-text"> 删除语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.10.</span> <span class="toc-text"> 插入语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.11.</span> <span class="toc-text"> 修改语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7sql"><span class="toc-number">4.</span> <span class="toc-text"> 中级SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text"> 连接表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5inner-join"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 内连接（inner join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5outer-join"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 外连接（outer join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 连接条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">4.2.</span> <span class="toc-text"> 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 视图更新</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">4.3.</span> <span class="toc-text"> 事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.4.</span> <span class="toc-text"> 完整性约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E5%9B%BA%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">4.5.</span> <span class="toc-text"> SQL固有属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%BC%BA%E7%9C%81%E5%80%BC"><span class="toc-number">4.6.</span> <span class="toc-text"> 类型转换&amp;缺省值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8Budt%E5%9F%9F"><span class="toc-number">4.7.</span> <span class="toc-text"> 用户自定义类型（UDT）&amp;域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">4.8.</span> <span class="toc-text"> 索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83"><span class="toc-number">4.9.</span> <span class="toc-text"> 授权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%88%E4%BA%88%E4%B8%8E%E6%94%B6%E5%9B%9E"><span class="toc-number">4.9.1.</span> <span class="toc-text"> 权限授予与收回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2"><span class="toc-number">4.9.2.</span> <span class="toc-text"> 角色</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7sql"><span class="toc-number">5.</span> <span class="toc-text"> 高级SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E8%AE%BF%E9%97%AEsql"><span class="toc-number">5.1.</span> <span class="toc-text"> 使用程序设计语言访问SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text"> 函数和过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 用于过程和函数的语言结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text"> 触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.4.</span> <span class="toc-text"> 递归查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%90%8D"><span class="toc-number">5.5.</span> <span class="toc-text"> 排名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%AA%97"><span class="toc-number">5.6.</span> <span class="toc-text"> 分窗</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8e-r%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text"> 使用E-R模型的数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93-%E8%81%94%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.1.</span> <span class="toc-text"> 实体-联系模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E9%9B%86"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 实体集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 联系集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.3.</span> <span class="toc-text"> 复杂属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%9F%BA%E6%95%B0"><span class="toc-number">6.1.4.</span> <span class="toc-text"> 映射基数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE"><span class="toc-number">6.2.</span> <span class="toc-text"> 主键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E9%9B%86-2"><span class="toc-number">6.2.1.</span> <span class="toc-text"> 实体集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86-2"><span class="toc-number">6.2.2.</span> <span class="toc-text"> 联系集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%AE%9E%E4%BD%93%E9%9B%86"><span class="toc-number">6.2.3.</span> <span class="toc-text"> 弱实体集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9A%84e-r%E7%89%B9%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text"> 扩展的E-R特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%8C%96specialization%E6%A6%82%E5%8C%96generalization"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 特化（Specialization）&#x2F;概化（Generalization）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86aggregation"><span class="toc-number">6.3.2.</span> <span class="toc-text"> 聚集（Aggregation）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86e-r%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text"> 将E-R图转换为关系模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.1.</span> <span class="toc-text"> 强实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%A4%8D%E6%9D%82%E5%B1%9E%E6%80%A7%E7%9A%84%E5%BC%BA%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.2.</span> <span class="toc-text"> 具有复杂属性的强实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.3.</span> <span class="toc-text"> 弱实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.4.</span> <span class="toc-text"> 联系集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%86%97%E4%BD%99"><span class="toc-number">6.4.5.</span> <span class="toc-text"> 模式的冗余</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%90%88%E5%B9%B6"><span class="toc-number">6.4.6.</span> <span class="toc-text"> 模式的合并</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93-%E8%81%94%E7%B3%BB%E8%AE%BE%E8%AE%A1%E9%97%AE%E9%A2%98"><span class="toc-number">6.5.</span> <span class="toc-text"> 实体-联系设计问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#e-r%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%88%9B%E5%BB%BA%E9%94%99%E8%AF%AF"><span class="toc-number">6.5.1.</span> <span class="toc-text"> E-R图中的创建错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BD%93%E9%9B%86%E8%BF%98%E6%98%AF%E5%B1%9E%E6%80%A7"><span class="toc-number">6.5.2.</span> <span class="toc-text"> 使用实体集还是属性？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BD%93%E9%9B%86%E8%BF%98%E6%98%AF%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.5.3.</span> <span class="toc-text"> 使用实体集还是联系集？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%85%83%E8%BF%98%E6%98%AFn%E5%85%83%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.5.4.</span> <span class="toc-text"> 二元还是n元联系集？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.</span> <span class="toc-text"> 关系数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A7%A3"><span class="toc-number">7.1.</span> <span class="toc-text"> 分解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3"><span class="toc-number">7.1.1.</span> <span class="toc-text"> 无损分解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E8%8C%83%E5%8C%96%E7%90%86%E8%AE%BA"><span class="toc-number">7.1.2.</span> <span class="toc-text"> 规范化理论</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E8%BF%9B%E8%A1%8C%E5%88%86%E8%A7%A3"><span class="toc-number">7.2.</span> <span class="toc-text"> 使用函数依赖进行分解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E6%83%AF%E4%BE%8B"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 符号惯例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%AE%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 键和函数依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%AE%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96-2"><span class="toc-number">7.2.2.1.</span> <span class="toc-text"> 键和函数依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B3%E5%87%A1%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.2.</span> <span class="toc-text"> 平凡函数依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%A0%E9%80%92%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.3.</span> <span class="toc-text"> 传递依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.4.</span> <span class="toc-text"> 部分依赖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E9%9B%86%E7%9A%84%E9%97%AD%E5%8C%85"><span class="toc-number">7.2.3.</span> <span class="toc-text"> 函数依赖集的闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E9%9B%86%E7%9A%84%E9%97%AD%E5%8C%85"><span class="toc-number">7.2.4.</span> <span class="toc-text"> 属性集的闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.5.</span> <span class="toc-text"> 保持依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A6%86%E7%9B%96"><span class="toc-number">7.2.6.</span> <span class="toc-text"> 正则覆盖</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-number">7.2.6.1.</span> <span class="toc-text"> 无关属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A6%86%E7%9B%96-2"><span class="toc-number">7.2.6.2.</span> <span class="toc-text"> 正则覆盖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.7.</span> <span class="toc-text"> 无损分解和函数依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.</span> <span class="toc-text"> 范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bcnf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.1.</span> <span class="toc-text"> BCNF范式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bcnf%E7%9A%84%E6%A3%80%E6%B5%8B"><span class="toc-number">7.3.1.1.</span> <span class="toc-text"> BCNF的检测</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bcnf%E5%88%86%E8%A7%A3%E7%AE%97%E6%B3%95"><span class="toc-number">7.3.1.2.</span> <span class="toc-text"> BCNF分解算法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3nf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.2.</span> <span class="toc-text"> 3NF范式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3nf%E5%88%86%E8%A7%A3"><span class="toc-number">7.3.2.1.</span> <span class="toc-text"> 3NF分解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1nf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.3.</span> <span class="toc-text"> 1NF范式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">8.</span> <span class="toc-text"> 数据存储结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.1.</span> <span class="toc-text"> 文件组织</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E9%95%BF%E8%AE%B0%E5%BD%95"><span class="toc-number">8.1.1.</span> <span class="toc-text"> 定长记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%95%BF%E8%AE%B0%E5%BD%95"><span class="toc-number">8.1.2.</span> <span class="toc-text"> 变长记录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%A7%BD%E7%9A%84%E9%A1%B5%E7%BB%93%E6%9E%84"><span class="toc-number">8.1.2.1.</span> <span class="toc-text"> 分槽的页结构</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8"><span class="toc-number">8.1.3.</span> <span class="toc-text"> 大对象存储</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AE%B0%E5%BD%95%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.</span> <span class="toc-text"> 文件中记录的组织</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 堆文件组织</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E7%94%B1%E7%A9%BA%E9%97%B4%E5%9B%BE"><span class="toc-number">8.2.1.1.</span> <span class="toc-text"> 自由空间图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.2.</span> <span class="toc-text"> 顺序文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%81%9A%E7%B0%87%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.3.</span> <span class="toc-text"> 多表聚簇文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.4.</span> <span class="toc-text"> B+树文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.5.</span> <span class="toc-text"> 哈希文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%92%E5%88%86"><span class="toc-number">8.2.6.</span> <span class="toc-text"> 划分</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%E5%AD%98%E5%82%A8"><span class="toc-number">8.3.</span> <span class="toc-text"> 数据字典存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.4.</span> <span class="toc-text"> 数据库缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">8.4.1.</span> <span class="toc-text"> 缓冲区管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A2%AB%E9%92%89%E4%BD%8F%E7%9A%84%E5%9D%97"><span class="toc-number">8.4.1.1.</span> <span class="toc-text"> 被钉住的块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E4%B8%8A%E7%9A%84%E5%85%B1%E4%BA%AB%E6%8E%92%E5%AE%83%E9%94%81"><span class="toc-number">8.4.1.2.</span> <span class="toc-text"> 缓冲区上的共享排它锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5"><span class="toc-number">8.4.2.</span> <span class="toc-text"> 缓冲区替换策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-2"><span class="toc-number">9.</span> <span class="toc-text"> 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.</span> <span class="toc-text"> 顺序索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%A0%E5%AF%86%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.1.</span> <span class="toc-text"> 稠密索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%80%E7%96%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.2.</span> <span class="toc-text"> 稀疏索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.3.</span> <span class="toc-text"> 多级索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%9B%B4%E6%96%B0"><span class="toc-number">9.1.4.</span> <span class="toc-text"> 索引更新</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%92%E5%85%A5"><span class="toc-number">9.1.4.1.</span> <span class="toc-text"> 插入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">9.1.4.2.</span> <span class="toc-text"> 删除</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.5.</span> <span class="toc-text"> 辅助索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">9.2.</span> <span class="toc-text"> B+树索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-number">9.2.1.</span> <span class="toc-text"> B+树结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B6%E8%8A%82%E7%82%B9"><span class="toc-number">9.2.1.1.</span> <span class="toc-text"> 叶节点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.2.</span> <span class="toc-text"> B+树的查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E6%8F%92%E5%85%A5"><span class="toc-number">9.2.3.</span> <span class="toc-text"> B+树的插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">9.2.4.</span> <span class="toc-text"> B+树的删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E5%94%AF%E4%B8%80%E6%80%A7%E6%90%9C%E7%B4%A2%E7%A0%81"><span class="toc-number">9.2.5.</span> <span class="toc-text"> 非唯一性搜索码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E6%A0%91%E6%89%A9%E5%B1%95"><span class="toc-number">9.3.</span> <span class="toc-text"> B+树扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87-2"><span class="toc-number">9.3.1.</span> <span class="toc-text"> B+树文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E5%92%8C%E8%AE%B0%E5%BD%95%E9%87%8D%E5%88%86%E9%85%8D"><span class="toc-number">9.3.2.</span> <span class="toc-text"> 辅助索引和记录重分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">9.3.3.</span> <span class="toc-text"> 对字符串的索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%B4%A2%E5%BC%95"><span class="toc-number">9.3.4.</span> <span class="toc-text"> B树文件索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%A3%E5%88%97%E7%B4%A2%E5%BC%95"><span class="toc-number">9.4.</span> <span class="toc-text"> 散列索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95"><span class="toc-number">9.5.</span> <span class="toc-text"> 位图索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text"> 查询处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%A3%E4%BB%B7%E7%9A%84%E5%BA%A6%E9%87%8F"><span class="toc-number">10.1.</span> <span class="toc-text"> 查询代价的度量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97"><span class="toc-number">10.2.</span> <span class="toc-text"> 选择运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">10.3.</span> <span class="toc-text"> 排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E6%8E%92%E5%BA%8F-%E5%BD%92%E5%B9%B6%E7%AE%97%E6%B3%95"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 外排序-归并算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E6%8E%92%E5%BA%8F-%E5%BD%92%E5%B9%B6%E7%9A%84%E4%BB%A3%E4%BB%B7%E8%AE%A1%E7%AE%97"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 外排序-归并的代价计算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%90%E7%AE%97"><span class="toc-number">10.4.</span> <span class="toc-text"> 连接运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.1.</span> <span class="toc-text"> 嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%97%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.2.</span> <span class="toc-text"> 块嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.3.</span> <span class="toc-text"> 索引嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%92%E5%B9%B6-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.4.</span> <span class="toc-text"> 归并-连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E5%88%86%E6%9E%90"><span class="toc-number">10.4.4.1.</span> <span class="toc-text"> 代价分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%BD%92%E5%B9%B6-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.5.</span> <span class="toc-text"> 混合归并-连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%A3%E5%88%97-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.6.</span> <span class="toc-text"> 散列-连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E5%88%86%E6%9E%90-2"><span class="toc-number">10.4.6.1.</span> <span class="toc-text"> 代价分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%BF%90%E7%AE%97"><span class="toc-number">10.5.</span> <span class="toc-text"> 其他运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D"><span class="toc-number">10.5.1.</span> <span class="toc-text"> 去重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1"><span class="toc-number">10.5.2.</span> <span class="toc-text"> 投影</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97-3"><span class="toc-number">10.5.3.</span> <span class="toc-text"> 集合运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.5.4.</span> <span class="toc-text"> 外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86"><span class="toc-number">10.5.5.</span> <span class="toc-text"> 聚集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%89%A7%E8%A1%8C"><span class="toc-number">10.6.</span> <span class="toc-text"> 表达式执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E5%8C%96"><span class="toc-number">10.6.1.</span> <span class="toc-text"> 物化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">10.6.2.</span> <span class="toc-text"> 流水线</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.6.2.1.</span> <span class="toc-text"> 流水线的实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-2"><span class="toc-number">11.</span> <span class="toc-text"> 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">11.1.</span> <span class="toc-text"> 一个简单的事务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E5%92%8C%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-number">11.2.</span> <span class="toc-text"> 事务的原子性和持久性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="toc-number">11.3.</span> <span class="toc-text"> 事务的隔离性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">11.4.</span> <span class="toc-text"> 可串行化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E5%92%8C%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">11.5.</span> <span class="toc-text"> 事务的隔离性和原子性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E6%81%A2%E5%A4%8D%E8%B0%83%E5%BA%A6"><span class="toc-number">11.5.1.</span> <span class="toc-text"> 可恢复调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%BA%A7%E8%81%94%E8%B0%83%E5%BA%A6"><span class="toc-number">11.5.2.</span> <span class="toc-text"> 无级联调度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E7%BA%A7%E5%88%AB"><span class="toc-number">11.6.</span> <span class="toc-text"> 事务的隔离性级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">12.</span> <span class="toc-text"> 并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%94%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.</span> <span class="toc-text"> 基于锁的协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">12.1.1.</span> <span class="toc-text"> 锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.2.</span> <span class="toc-text"> 两阶段封锁协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">12.1.3.</span> <span class="toc-text"> 封锁的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.3.1.</span> <span class="toc-text"> 基于图的协议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E5%A4%84%E7%90%86"><span class="toc-number">12.2.</span> <span class="toc-text"> 死锁处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E9%A2%84%E9%98%B2"><span class="toc-number">12.2.1.</span> <span class="toc-text"> 死锁预防</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E6%A3%80%E6%B5%8B"><span class="toc-number">12.2.2.</span> <span class="toc-text"> 死锁检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E6%81%A2%E5%A4%8D"><span class="toc-number">12.2.3.</span> <span class="toc-text"> 死锁恢复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%B2%92%E5%BA%A6"><span class="toc-number">12.3.</span> <span class="toc-text"> 多粒度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.4.</span> <span class="toc-text"> 基于时间戳的协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">12.4.1.</span> <span class="toc-text"> 时间戳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E6%8E%92%E5%BA%8F%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.4.2.</span> <span class="toc-text"> 时间戳排序协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#thomas%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">12.4.3.</span> <span class="toc-text"> Thomas写规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%9C%89%E6%95%88%E6%80%A7%E6%A3%80%E6%9F%A5%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.5.</span> <span class="toc-text"> 基于有效性检查的协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E6%9C%BA%E5%88%B6"><span class="toc-number">12.6.</span> <span class="toc-text"> 多版本机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E6%97%B6%E9%97%B4%E6%88%B3%E6%8E%92%E5%BA%8F"><span class="toc-number">12.6.1.</span> <span class="toc-text"> 多版本时间戳排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E4%B8%A4%E9%98%B6%E6%AE%B5%E5%B0%81%E9%94%81"><span class="toc-number">12.6.2.</span> <span class="toc-text"> 多版本两阶段封锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E9%9A%94%E7%A6%BB"><span class="toc-number">12.7.</span> <span class="toc-text"> 快照隔离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7%E6%A3%80%E6%9F%A5%E6%AD%A5%E9%AA%A4"><span class="toc-number">12.7.1.</span> <span class="toc-text"> 更新事务的有效性检查步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%B3%BB%E7%BB%9F"><span class="toc-number">13.</span> <span class="toc-text"> 恢复系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E5%88%86%E7%B1%BB"><span class="toc-number">13.1.</span> <span class="toc-text"> 故障分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">13.2.</span> <span class="toc-text"> 恢复与原子性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">13.2.1.</span> <span class="toc-text"> 日志记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9"><span class="toc-number">13.2.2.</span> <span class="toc-text"> 数据库修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%81%9A%E5%92%8C%E6%92%A4%E9%94%80"><span class="toc-number">13.2.3.</span> <span class="toc-text"> 重做和撤销</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="toc-number">13.2.4.</span> <span class="toc-text"> 检查点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95"><span class="toc-number">13.3.</span> <span class="toc-text"> 恢复算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-number">13.3.1.</span> <span class="toc-text"> 事务回滚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%B4%A9%E6%BA%83%E5%90%8E%E7%9A%84%E6%81%A2%E5%A4%8D"><span class="toc-number">13.3.2.</span> <span class="toc-text"> 系统崩溃后的恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E5%A4%84%E7%90%86%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">13.3.3.</span> <span class="toc-text"> 提交处理的优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">13.4.</span> <span class="toc-text"> 缓冲区管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aries"><span class="toc-number">13.5.</span> <span class="toc-text"> ARIES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">13.5.1.</span> <span class="toc-text"> 数据结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95-2"><span class="toc-number">13.5.2.</span> <span class="toc-text"> 恢复算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.1.</span> <span class="toc-text"> 分析阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E5%81%9A%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.2.</span> <span class="toc-text"> 重做阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.3.</span> <span class="toc-text"> 撤销阶段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%89%B9%E6%80%A7"><span class="toc-number">13.5.3.</span> <span class="toc-text"> 其他特性</span></a></li></ol></li></ol></li></ol> </div> </div> <div class="hidden sidebar-common-sidebar"><div class="sidebar-author"> <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="D-Sketon" class="lazyload"> <div class="sidebar-author-name">D-Sketon</div> <div class="sidebar-description">D-Sketon&#39;s blog</div> </div> <div class="sidebar-state"> <div class="sidebar-state-article"> <div>Post</div> <div class="sidebar-state-number">74</div> </div> <div class="sidebar-state-category"> <div>Category</div> <div class="sidebar-state-number">10</div> </div> <div class="sidebar-state-tag"> <div>Tag</div> <div class="sidebar-state-number">20</div> </div> </div> <div class="sidebar-social"> <div class="icon-github sidebar-social-icon"> <a href="https://github.com/D-Sketon" itemprop="url" target="_blank" aria-label="github" rel="nofollow noopener noreferrer"></a> </div> <div class="icon-bilibili sidebar-social-icon"> <a href="https://space.bilibili.com/20339857" itemprop="url" target="_blank" aria-label="bilibili" rel="nofollow noopener noreferrer"></a> </div> </div> <div class="sidebar-menu"> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/" aria-label="Home"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Home</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/archives" aria-label="Archives"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Archives</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/about" aria-label="About"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">About</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/friend" aria-label="Friend"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Friend</div> </div> </div> </div> <div class="sidebar-btn-wrapper" style="position:static"> <div class="current sidebar-toc-btn"></div> <div class="sidebar-common-btn"></div> </div> </div> </div> <div class="sidebar-widget"> </div> </div> </aside> <section id="main" aria-label="Main content"><article id="post-数据库系统概念 学习笔记" class="article h-entry" itemscope itemtype="https://schema.org/BlogPosting"> <div class="article-inner" data-aos="fade-up"> <div class="article-meta"> <div class="article-date"> <span class="article-date-link icon-calendar" data-aos="zoom-in"> <time datetime="2022-08-16T07:48:09.000Z" itemprop="datePublished">2022-08-16</time> <time style="display:none" id="post-update-time">2025-02-02</time> </span> </div> <div class="article-category"> <a class="article-category-link" href="/en/categories/%E8%AE%A1%E8%BD%AF%E6%9D%82%E8%B0%88/" title="计软杂谈">计软杂谈</a><a class="article-category-link" href="/en/categories/%E8%AE%A1%E8%BD%AF%E6%9D%82%E8%B0%88/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="学习笔记">学习笔记</a> </div> </div> <div class="hr-line"></div> <div class="article-entry e-content" itemprop="articleBody"> <h2 id="引言"><a class="markdownIt-Anchor" href="#引言"></a> 引言</h2> <h3 id="数据库-database"><a class="markdownIt-Anchor" href="#数据库-database"></a> 数据库-DataBase</h3> <ul> <li>一个互相关联的数据的集合</li> <li>大多数计算机应用程序的核心组件</li> </ul> <h3 id="数据库管理系统-dbmsdatabase-management-system"><a class="markdownIt-Anchor" href="#数据库管理系统-dbmsdatabase-management-system"></a> 数据库管理系统-DBMS（DataBase Management System）</h3> <ul> <li>一个互相关联的数据集合</li> <li>访问这些数据的一组程序</li> <li>提供了一种既方便又高效的存储和检索数据库信息的方法</li> <li>由多个用户和应用程序访问</li> </ul> <h3 id="数据模型"><a class="markdownIt-Anchor" href="#数据模型"></a> 数据模型</h3> <ul> <li>关系模型 <ul> <li>用表的集合来表述数据和数据间的联系</li> </ul> </li> <li>实体-联系（E-R）模型 <ul> <li>使用称作实体的基本对象的集合，以及这些对象间的关系</li> </ul> </li> <li>半结构化数据模型 <ul> <li>允许在其数据定义中某些相同类型的数据项含有不同的属性集</li> </ul> </li> <li>基于对象的数据模型 <ul> <li>对关系模型进行扩展，增加了封装、方法和对象标识符等概念</li> </ul> </li> <li>键值对模型，图模型，文件模型等等…</li> </ul> <h3 id="数据抽象"><a class="markdownIt-Anchor" href="#数据抽象"></a> 数据抽象</h3> <ul> <li>物理层 <ul> <li>描述数据是怎样<strong>存储</strong>的</li> </ul> </li> <li>逻辑层 <ul> <li>描述数据库中存储<strong>什么</strong>数据以及这些数据建存在什么联系</li> <li>通过少量相对<strong>简单</strong>的结构描述了整个数据库</li> </ul> </li> <li>视图层 <ul> <li>只描述整个数据库的<strong>某个部分</strong></li> </ul> </li> </ul> <h3 id="实例instance和模式schema"><a class="markdownIt-Anchor" href="#实例instance和模式schema"></a> 实例（instance）和模式（schema）</h3> <p>类似于编程语言中的类型和变量</p> <ul> <li>逻辑模式 <ul> <li>数据库的整体逻辑结构</li> <li>类似于程序中变量的类型信息</li> </ul> </li> <li>物理模式 <ul> <li>数据库的整体物理结构</li> </ul> </li> <li>实例 <ul> <li>数据库的实际内容</li> <li>类似于变量的值</li> </ul> </li> </ul> <h3 id="数据库语言"><a class="markdownIt-Anchor" href="#数据库语言"></a> 数据库语言</h3> <h4 id="数据定义语言ddl"><a class="markdownIt-Anchor" href="#数据定义语言ddl"></a> 数据定义语言（DDL）</h4> <p>用于定义数据库模式的实现细节</p> <ul> <li><strong>数据字典（data dictionary）</strong> 包含元数据 <ul> <li>数据库模式</li> <li>完整性约束</li> <li>授权</li> </ul> </li> </ul> <h4 id="数据操纵语言dml"><a class="markdownIt-Anchor" href="#数据操纵语言dml"></a> 数据操纵语言（DML）</h4> <p>访问和更新数据的语言（<strong>查询语言</strong>）</p> <ul> <li>过程化的 DML <ul> <li>要求用户指定需要什么数据以及<strong>如何</strong>获得这些数据 <ul> <li>关系代数（relational algebra）</li> </ul> </li> </ul> </li> <li>声明式的（非过程化的）DML <ul> <li>要求用户指定需要<strong>什么</strong>数据，而不必指明如何获得这些数据<br> 类似于编程语言中的类型和变量 <ul> <li>关系演算（relational calculus）</li> <li>SQL</li> </ul> </li> </ul> </li> </ul> <h3 id="sql-查询语言"><a class="markdownIt-Anchor" href="#sql-查询语言"></a> SQL 查询语言</h3> <ul> <li>SQL 查询语言是非过程化的</li> <li>SQL 不是图灵完备的</li> <li>通常嵌入在一些高级语言中</li> <li>应用程序通常通过以下方式访问数据库： <ul> <li>允许嵌入式 SQL 的语言扩展</li> <li>允许将 SQL 查询发送到数据库的应用程序接口（例如 ODBC/JDBC）</li> </ul> </li> </ul> <h3 id="数据库设计"><a class="markdownIt-Anchor" href="#数据库设计"></a> 数据库设计</h3> <ul> <li>逻辑设计 - 决定数据库模式 <ul> <li>找到“好”的模式</li> <li>业务决策—应该在数据库中记录哪些属性</li> <li>计算机科学决策——应该拥有哪些关系模式以及属性应该如何在各种关系模式之间分布</li> </ul> </li> <li>物理设计 - 决定数据库的物理布局</li> </ul> <h3 id="数据库引擎"><a class="markdownIt-Anchor" href="#数据库引擎"></a> 数据库引擎</h3> <ul> <li>数据库系统被划分为多个模块，每个模块完成整个系统的一个功能</li> <li>数据库系统的主要组成部分 <ul> <li>存储管理器</li> <li>查询处理器</li> <li>事务管理</li> </ul> </li> </ul> <h3 id="存储管理器"><a class="markdownIt-Anchor" href="#存储管理器"></a> 存储管理器</h3> <ul> <li>与 OS 文件管理器进行交互</li> <li>负责数据库中数据的存储、检索和更新</li> <li>存储管理器部件包括： <ul> <li>权限和完整性管理器<br> - 检测时候满足完整性约束，并检查试图访问数据的用户权限</li> <li>事务管理器 <ul> <li>保证即使系统发生了故障，数据库也保持在一致的状态</li> </ul> </li> <li>文件管理器 <ul> <li>管理磁盘存储空间的分配和用于表示磁盘上所存储信息的数据结构</li> </ul> </li> <li>缓冲区管理器 <ul> <li>负责将数据从磁盘上渠道内存中，并决定哪些数据应被缓冲在内存中</li> </ul> </li> </ul> </li> <li>存储管理器实现了几种数据结构 <ul> <li>数据文件 <ul> <li>存储数据库自身</li> </ul> </li> <li>数据字典 <ul> <li>存储关于数据库结构的元数据</li> </ul> </li> <li>索引 <ul> <li>提供对于数据项的快速访问</li> </ul> </li> </ul> </li> </ul> <h3 id="查询处理器"><a class="markdownIt-Anchor" href="#查询处理器"></a> 查询处理器</h3> <p>查询处理器组件包括：</p> <ul> <li>DDL解释器 <ul> <li>解释DDL语句并将这些定义记录在数据字典中</li> </ul> </li> <li>DML编译器 <ul> <li>将查询语言中的DML语句翻译为包括一系列查询执行引擎能理解的低级指令的执行方案</li> </ul> </li> <li>查询执行引擎 <ul> <li>执行由DML编译器产生的低级指令</li> </ul> </li> </ul> <h3 id="事务管理"><a class="markdownIt-Anchor" href="#事务管理"></a> 事务管理</h3> <ul> <li><strong>事务</strong>是数据库应用中完成单一逻辑功能的操作集合</li> </ul> <h2 id="关系模型介绍"><a class="markdownIt-Anchor" href="#关系模型介绍"></a> 关系模型介绍</h2> <h3 id="关系模型"><a class="markdownIt-Anchor" href="#关系模型"></a> 关系模型</h3> <ul> <li>关系（relation）是<strong>无序</strong>集合，包含表示实体的属性之间的关系</li> <li>域（domain）是关系的每个属性的允许取值的集合</li> <li>元组（tuple）是关系中的一组属性值 <ul> <li>值（通常）是原子/标量 <ul> <li>原子：一个域中的元素被认为是不可再分的单位</li> </ul> </li> <li>空值是每个域的成员</li> </ul> </li> </ul> <h3 id="数据库模式database-schema"><a class="markdownIt-Anchor" href="#数据库模式database-schema"></a> 数据库模式（database schema）</h3> <ul> <li>A1, A2, …, An 是属性</li> <li>R = (A1, A2, …, An ) 是一个关系模式（relation schema）</li> <li>例： <ul> <li>instructor = (ID, name, dept_name, salary)</li> <li>在模式 R 上定义的关系实例 r 用 r® 表示</li> <li>关系的当前值由表指定</li> <li>关系 r 的元素 t 称为元组，由表中的一行表示</li> </ul> </li> </ul> <h3 id="键"><a class="markdownIt-Anchor" href="#键"></a> 键</h3> <ul> <li>超键（superkey） <ul> <li>一个或多个属性的集合</li> <li>将这些属性组合在一起可以在一个关系中唯一地标识出一个元组</li> </ul> </li> <li>候选键（candidate key） <ul> <li>最小超键</li> <li>其任意真子集都不是超键</li> </ul> </li> <li>主键（primary key） <ul> <li>被数据库设计者选中来作为在一个关系中区分不同元组的主要方式的候选键</li> <li>如果表没有定义一个主键，一些 DBMS 会自动创建一个内部主键 <ul> <li>SEQUENCE (SQL:2003)</li> <li>AUTO_INCREMENT (MySQL)</li> </ul> </li> </ul> </li> <li>外键约束（foreign-key constraint） <ul> <li>一个关系中的值必须出现在另一个关系中 <ul> <li>引用关系（referencing relation）</li> <li>被引用关系（referenced relation）</li> </ul> </li> <li>被引用属性（集）必须是被引用关系的<strong>主键</strong></li> <li>是引用完整性约束的一种<strong>特例</strong></li> </ul> </li> <li>引用完整性约束（referential integrity constraint） <ul> <li>引用关系中的任意元组在指定属性上出现的取值也必然出现在被引用关系中至少一个元组的指定属性上</li> </ul> </li> </ul> <h3 id="关系代数relational-algebra"><a class="markdownIt-Anchor" href="#关系代数relational-algebra"></a> 关系代数（relational algebra）</h3> <ul> <li>检索和操作关系中的元组的基本操作 <ul> <li>基于集合代数</li> </ul> </li> <li>每个算子将一个或多个关系作为其输入并输出一个新关系 <ul> <li>可以将运算符链接在一起以创建更复杂的运算</li> </ul> </li> </ul> <h4 id="选择运算select"><a class="markdownIt-Anchor" href="#选择运算select"></a> 选择运算（select）</h4> <p>从满足选择谓词的关系中选择元组的子集<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma_{dept\_name=&quot;Physics&quot;}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">d</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">pt</span><span class="mord mtight" style="margin-right:.02778em">_</span><span class="mathnormal mord mtight">nam</span><span class="mathnormal mord mtight">e</span><span class="mrel mtight">=</span><span class="mord mtight">&quot;</span><span class="mathnormal mord mtight" style="margin-right:.13889em">P</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">ys</span><span class="mathnormal mord mtight">i</span><span class="mathnormal mord mtight">cs</span><span class="mord mtight">&quot;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span><br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi><mo>∨</mo><mi>s</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>&gt;</mo><mn>90000</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma_{dept\_name=&quot;Physics&quot; \lor salary&gt;90000}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">d</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">pt</span><span class="mord mtight" style="margin-right:.02778em">_</span><span class="mathnormal mord mtight">nam</span><span class="mathnormal mord mtight">e</span><span class="mrel mtight">=</span><span class="mord mtight">&quot;</span><span class="mathnormal mord mtight" style="margin-right:.13889em">P</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">ys</span><span class="mathnormal mord mtight">i</span><span class="mathnormal mord mtight">cs</span><span class="mord mtight">&quot;</span><span class="mbin mtight">∨</span><span class="mathnormal mord mtight">s</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.01968em">l</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.03588em">ry</span><span class="mrel mtight">&gt;</span><span class="mord mtight">90000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span></p> <h4 id="投影运算projection"><a class="markdownIt-Anchor" href="#投影运算projection"></a> 投影运算（projection）</h4> <p>使用仅包含指定属性的元组生成关系<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mrow><mi>I</mi><mi>D</mi><mo separator="true">,</mo><mi>s</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">/</mi><mn>12</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_{ID,salary/12}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.07847em">I</span><span class="mathnormal mord mtight" style="margin-right:.02778em">D</span><span class="mpunct mtight">,</span><span class="mathnormal mord mtight">s</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.01968em">l</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.03588em">ry</span><span class="mord mtight">/12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span></p> <h4 id="笛卡尔积运算product"><a class="markdownIt-Anchor" href="#笛卡尔积运算product"></a> 笛卡尔积运算（product）</h4> <p>从输入关系生成一个包含所有可能的元组组合的关系<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>×</mo><mi>t</mi><mi>e</mi><mi>a</mi><mi>r</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">instructor \times tearches</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7429em;vertical-align:-.0833em"></span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6944em"></span><span class="mathnormal mord">t</span><span class="mathnormal mord">e</span><span class="mathnormal mord">a</span><span class="mathnormal mord">rc</span><span class="mathnormal mord">h</span><span class="mathnormal mord">es</span></span></span></span></p> <h4 id="连接运算join"><a class="markdownIt-Anchor" href="#连接运算join"></a> 连接运算（join）</h4> <p>生成包含所有元组的关系，这些元组是两个元组（每个输入关系中的一个）与一个或多个属性的公共值的组合<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mo>⋈</mo><mi>θ</mi></msub><mi>s</mi><mo>=</mo><msub><mi>σ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo>×</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r\Join_{\theta} s=\sigma_{\theta}(r\times s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.655em;vertical-align:-.15em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mrel">⋈</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord">s</span><span class="mclose">)</span></span></span></span><br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><msub><mo>⋈</mo><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>I</mi><mi>D</mi><mo>=</mo><mi>t</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>I</mi><mi>D</mi></mrow></msub><mi>t</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>h</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">instructor\Join_{instructor.ID=teaches.ID}teaches</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8095em;vertical-align:-.15em"></span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mrel">⋈</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">in</span><span class="mathnormal mord mtight">s</span><span class="mathnormal mord mtight">t</span><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span><span class="mathnormal mord mtight">u</span><span class="mathnormal mord mtight">c</span><span class="mathnormal mord mtight">t</span><span class="mathnormal mord mtight" style="margin-right:.02778em">or</span><span class="mord mtight">.</span><span class="mathnormal mord mtight" style="margin-right:.07847em">I</span><span class="mathnormal mord mtight" style="margin-right:.02778em">D</span><span class="mrel mtight">=</span><span class="mathnormal mord mtight">t</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight">c</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">es</span><span class="mord mtight">.</span><span class="mathnormal mord mtight" style="margin-right:.07847em">I</span><span class="mathnormal mord mtight" style="margin-right:.02778em">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6944em"></span><span class="mathnormal mord">t</span><span class="mathnormal mord">e</span><span class="mathnormal mord">a</span><span class="mathnormal mord">c</span><span class="mathnormal mord">h</span><span class="mathnormal mord">es</span></span></span></span></p> <h4 id="集合运算"><a class="markdownIt-Anchor" href="#集合运算"></a> 集合运算</h4> <h5 id="交intersection"><a class="markdownIt-Anchor" href="#交intersection"></a> 交（intersection）</h5> <p>生成包含仅出现在一个或两个输入关系中的所有元组的关系<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>∩</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r\cap s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord">s</span></span></span></span></p> <h5 id="并union"><a class="markdownIt-Anchor" href="#并union"></a> 并（union）</h5> <p>生成一个只包含出现在两个输入关系中的元组的关系<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>∪</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r\cup s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord">s</span></span></span></span></p> <h5 id="差difference"><a class="markdownIt-Anchor" href="#差difference"></a> 差（difference）</h5> <p>生成一个只包含出现在第一个而不是第二个输入关系中的元组的关系<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>−</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">r-s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord">s</span></span></span></span></p> <h4 id="更名运算rename"><a class="markdownIt-Anchor" href="#更名运算rename"></a> 更名运算（rename）</h4> <p>为关系代数表达式的结果提供名称<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ρ</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\rho_{i}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span><br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ρ</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\rho_{i(A_1,A_2,...)}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mathnormal mord">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">i</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mathnormal mord mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mathnormal mord mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span></p> <h4 id="赋值运算assignment"><a class="markdownIt-Anchor" href="#赋值运算assignment"></a> 赋值运算（assignment）</h4> <p>将关系代数表达式分配给临时关系变量<br> 查询可以写成由一系列赋值组成的顺序程序<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mo>←</mo><msub><mi>σ</mi><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Physics \leftarrow \sigma_{dept\_name=&quot;Physics&quot;}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.13889em">P</span><span class="mathnormal mord">h</span><span class="mathnormal mord">ys</span><span class="mathnormal mord">i</span><span class="mathnormal mord">cs</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">d</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">pt</span><span class="mord mtight" style="margin-right:.02778em">_</span><span class="mathnormal mord mtight">nam</span><span class="mathnormal mord mtight">e</span><span class="mrel mtight">=</span><span class="mord mtight">&quot;</span><span class="mathnormal mord mtight" style="margin-right:.13889em">P</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">ys</span><span class="mathnormal mord mtight">i</span><span class="mathnormal mord mtight">cs</span><span class="mord mtight">&quot;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span></p> <h4 id="聚合运算aggregation"><a class="markdownIt-Anchor" href="#聚合运算aggregation"></a> 聚合运算（aggregation）</h4> <p>允许在查询返回的一组值上计算函数</p> <ul> <li>average, sum, min, max, count, …</li> </ul> <p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>d</mi><mi>γ</mi><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>b</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>d</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">(</mo><mi>b</mi><mi mathvariant="normal">_</mi><mi>i</mi><mi>d</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a\_id \gamma min(b\_id),sum(b\_id)(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-.31em"></span><span class="mathnormal mord">a</span><span class="mord" style="margin-right:.02778em">_</span><span class="mathnormal mord">i</span><span class="mathnormal mord">d</span><span class="mathnormal mord">γmin</span><span class="mopen">(</span><span class="mathnormal mord">b</span><span class="mord" style="margin-right:.02778em">_</span><span class="mathnormal mord">i</span><span class="mathnormal mord">d</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mathnormal mord">s</span><span class="mathnormal mord">u</span><span class="mathnormal mord">m</span><span class="mopen">(</span><span class="mathnormal mord">b</span><span class="mord" style="margin-right:.02778em">_</span><span class="mathnormal mord">i</span><span class="mathnormal mord">d</span><span class="mclose">)</span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span></p> <h4 id="等价查询"><a class="markdownIt-Anchor" href="#等价查询"></a> 等价查询</h4> <p>在关系代数中编写查询的方法不止一种<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi><mo>∧</mo><mi>s</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>&gt;</mo><mn>90000</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma_{dept\_name=&quot;Physics&quot;\land salary&gt;90000}(instructor)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">d</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">pt</span><span class="mord mtight" style="margin-right:.02778em">_</span><span class="mathnormal mord mtight">nam</span><span class="mathnormal mord mtight">e</span><span class="mrel mtight">=</span><span class="mord mtight">&quot;</span><span class="mathnormal mord mtight" style="margin-right:.13889em">P</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">ys</span><span class="mathnormal mord mtight">i</span><span class="mathnormal mord mtight">cs</span><span class="mord mtight">&quot;</span><span class="mbin mtight">∧</span><span class="mathnormal mord mtight">s</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.01968em">l</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.03588em">ry</span><span class="mrel mtight">&gt;</span><span class="mord mtight">90000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">)</span></span></span></span><br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>P</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>s</mi><mi mathvariant="normal">&quot;</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mrow><mi>s</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>&gt;</mo><mn>9000</mn></mrow></msub><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma_{dept\_name=&quot;Physics&quot;}(\sigma_{salary&gt;9000}(instructor))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">d</span><span class="mathnormal mord mtight">e</span><span class="mathnormal mord mtight">pt</span><span class="mord mtight" style="margin-right:.02778em">_</span><span class="mathnormal mord mtight">nam</span><span class="mathnormal mord mtight">e</span><span class="mrel mtight">=</span><span class="mord mtight">&quot;</span><span class="mathnormal mord mtight" style="margin-right:.13889em">P</span><span class="mathnormal mord mtight">h</span><span class="mathnormal mord mtight">ys</span><span class="mathnormal mord mtight">i</span><span class="mathnormal mord mtight">cs</span><span class="mord mtight">&quot;</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mathnormal mord mtight">s</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.01968em">l</span><span class="mathnormal mord mtight">a</span><span class="mathnormal mord mtight" style="margin-right:.03588em">ry</span><span class="mrel mtight">&gt;</span><span class="mord mtight">9000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord">in</span><span class="mathnormal mord">s</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">u</span><span class="mathnormal mord">c</span><span class="mathnormal mord">t</span><span class="mathnormal mord" style="margin-right:.02778em">or</span><span class="mclose">))</span></span></span></span></p> <h2 id="sql介绍"><a class="markdownIt-Anchor" href="#sql介绍"></a> SQL介绍</h2> <h3 id="sql组成"><a class="markdownIt-Anchor" href="#sql组成"></a> SQL组成</h3> <ul> <li>数据操作语言 (DML)</li> <li>数据定义语言 (DDL) <ul> <li>完整性约束</li> <li>视图定义</li> <li>授权</li> </ul> </li> <li>数据控制语言 (DCL) <ul> <li>事务控制</li> <li>嵌入式 SQL 和动态 SQL</li> </ul> </li> </ul> <h3 id="数据定义"><a class="markdownIt-Anchor" href="#数据定义"></a> 数据定义</h3> <ul> <li>char(n)：具有指定长度n的固定长度的字符串</li> <li>varchar(n)：具有最大长度n的可变长度的字符串</li> <li>int：整数</li> <li>smallint：小整数</li> <li>numeric(p,d)：具有指定精度的定点数，这个数有p位数字（加上一个符号位），且小数点右边有p位中的d位数字</li> <li>real, double precision：浮点数与双精度浮点数</li> <li>float(n)：精度至少为n为数字的浮点数</li> </ul> <h3 id="建表"><a class="markdownIt-Anchor" href="#建表"></a> 建表</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> relation_name </span><br><span class="line">    (Attribute1 Domain1, </span><br><span class="line">    Attribute2 Domain2,</span><br><span class="line">     ..., </span><br><span class="line">     Attributen Domainn,</span><br><span class="line">     (integrity<span class="operator">-</span>constraint1),</span><br><span class="line">     ...,</span><br><span class="line">     (integrity<span class="operator">-</span>constraintk)</span><br><span class="line">    );</span><br></pre></td></tr></table></figure> <p>例：</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> instructor</span><br><span class="line">    (ID        <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">     name        <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">     dept_name     <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">     salary        <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line">     <span class="keyword">primary</span> key(ID),</span><br><span class="line">     <span class="keyword">foreign</span> key(dept_name) <span class="keyword">references</span> department</span><br><span class="line">    );</span><br></pre></td></tr></table></figure> <h3 id="更新表"><a class="markdownIt-Anchor" href="#更新表"></a> 更新表</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> instructor(ID, name, dept_name, salary) <span class="keyword">VALUES</span>(<span class="string">&#x27;10211&#x27;</span>, <span class="string">&#x27;Smith&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="number">66000</span>);</span><br><span class="line"><span class="comment">-- 删除数据，但不删除表</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> ID<span class="operator">=</span> <span class="string">&#x27;10211&#x27;</span>;</span><br><span class="line"><span class="comment">-- 更新数据</span></span><br><span class="line"><span class="keyword">UPDATE</span> instructor <span class="keyword">SET</span> name<span class="operator">=</span><span class="string">&#x27;Tom&#x27;</span>, salary<span class="operator">=</span><span class="number">55000</span> <span class="keyword">WHERE</span> ID<span class="operator">=</span> <span class="string">&#x27;10211&#x27;</span>;</span><br><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> instructor;</span><br><span class="line"><span class="comment">-- 改变表结构</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> instructor <span class="keyword">ADD</span> address <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> instructor <span class="keyword">DROP</span> address;</span><br></pre></td></tr></table></figure> <h3 id="查询语句"><a class="markdownIt-Anchor" href="#查询语句"></a> 查询语句</h3> <p><strong>SELECT FROM</strong></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 星号查询所有的属性</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 使用DISTINCT关键字去重</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> name <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 使用AS关键字为属性别名</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, salary<span class="operator">*</span><span class="number">1.1</span> <span class="keyword">AS</span> new_salary <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 常量的使用</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, salary<span class="operator">*</span><span class="number">1.1</span> new_salary,<span class="string">&#x27;Good&#x27;</span> <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 函数的使用</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, now() <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 伪表的使用</span></span><br><span class="line"><span class="keyword">SELECT</span> now() <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="comment">-- 伪表的省略</span></span><br><span class="line"><span class="keyword">SELECT</span> now();</span><br><span class="line"><span class="comment">-- 多表联合查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor, section;</span><br><span class="line"><span class="comment">-- 使用AS关键字为表创建别名</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">AS</span> t1, instructor t2;</span><br><span class="line"><span class="comment">-- 为嵌套子查询表创建别名</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> (<span class="keyword">select</span> id, name <span class="keyword">from</span> instructor) t;</span><br><span class="line"><span class="comment">-- 使用NATURAL JOIN进行自然连接</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> teaches;</span><br></pre></td></tr></table></figure> <p><strong>SELECT FROM WHERE</strong></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- WHERE关键字基本使用</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary<span class="operator">&gt;</span><span class="number">50000</span>;</span><br><span class="line"><span class="comment">-- 使用逻辑连接词 使用LIKE关键字模糊查询，%表示匹配任意子串，_表示匹配任意单个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary<span class="operator">&gt;</span><span class="number">50000</span> <span class="keyword">AND</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%d_r%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 使用ESCAPE改变转义符号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary<span class="operator">&gt;</span><span class="number">50000</span> <span class="keyword">AND</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%100\%&#x27;</span></span><br><span class="line"><span class="keyword">ESCAPE</span> <span class="string">&#x27;\ &#x27;</span>;</span><br><span class="line"><span class="comment">-- 使用字符串运算函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> length(name)<span class="operator">&gt;</span><span class="number">5</span>;</span><br><span class="line"><span class="comment">-- 使用||管道符号连接字符串</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> name<span class="operator">=</span><span class="string">&#x27;Go&#x27;</span><span class="operator">||</span><span class="string">&#x27;ld&#x27;</span>;</span><br><span class="line"><span class="comment">-- 使用BETWEEN AND关键字</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary <span class="keyword">BETWEEN</span> <span class="number">90000</span> <span class="keyword">AND</span> <span class="number">100000</span>;</span><br><span class="line"><span class="comment">-- 使用元组符号进行比较</span></span><br><span class="line"><span class="keyword">SELECT</span> name, course_id <span class="keyword">FROM</span> instructor, teaches <span class="keyword">WHERE</span> (instructor.id, dept_name) <span class="operator">=</span> (teaches.id, <span class="string">&#x27;Biology&#x27;</span>);</span><br></pre></td></tr></table></figure> <p><strong>SELECT FROM GROUP BY HAVING</strong></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用聚集函数max,min,count,avg,sum</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary) <span class="keyword">FROM</span> instructor;</span><br><span class="line"><span class="comment">-- 使用聚集函数内嵌套DISTINCT关键字去重</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">DISTINCT</span> id) <span class="keyword">FROM</span> teaches;</span><br><span class="line"><span class="comment">-- 使用GROUP BY关键字分组聚集</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">FROM</span> instructor <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br><span class="line"><span class="comment">-- 错误写法！id既没出现在聚集函数中，也没出现在GROUP BY中</span></span><br><span class="line"><span class="keyword">SELECT</span> id, dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">FROM</span> instructor <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name;</span><br><span class="line"><span class="comment">-- 在HAVING关键字中可以使用聚集函数</span></span><br><span class="line"><span class="comment">-- 与SELECT关键字相同，出现在HAVING子句中的属性必须要么被聚集，要么出现在GROUP BY子句中</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, <span class="built_in">avg</span>(salary) <span class="keyword">FROM</span> instructor <span class="keyword">GROUP</span> <span class="keyword">BY</span> dept_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">avg</span>(salary)<span class="operator">&gt;</span><span class="number">42000</span>;</span><br></pre></td></tr></table></figure> <p><strong>SELECT FROM ORDER BY</strong></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用ORDER BY关键字对结果集排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">ORDER</span> <span class="keyword">BY</span> name;</span><br><span class="line"><span class="comment">-- 使用DESC,ASC关键字进行降/升排序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> instructor <span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">DESC</span>, salary <span class="keyword">ASC</span>;</span><br><span class="line"><span class="comment">-- 使用属性别名进行排序</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, salary<span class="operator">*</span><span class="number">1.1</span> <span class="keyword">AS</span> new_salary <span class="keyword">FROM</span> instructor <span class="keyword">ORDER</span> <span class="keyword">BY</span> new_salary;</span><br><span class="line"><span class="comment">-- 使用属性下标进行排序</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, salary<span class="operator">*</span><span class="number">1.1</span> <span class="keyword">AS</span> new_salary <span class="keyword">FROM</span> instructor <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure> <h3 id="集合运算-2"><a class="markdownIt-Anchor" href="#集合运算-2"></a> 集合运算</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 集合运算均自动去重，如果需要保留重复项，需要添加ALL关键字</span></span><br><span class="line"><span class="comment">-- 并运算</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id  <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;FALL&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>) </span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br><span class="line"><span class="comment">-- 交运算，使用ALL关键字</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>)</span><br><span class="line"><span class="keyword">INTERSECT</span> <span class="keyword">ALL</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br><span class="line"><span class="comment">-- 差运算</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span>)</span><br><span class="line"><span class="keyword">EXCEPT</span></span><br><span class="line">(<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> section <span class="keyword">WHERE</span> sem <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2018</span>)</span><br></pre></td></tr></table></figure> <h3 id="空值"><a class="markdownIt-Anchor" href="#空值"></a> 空值</h3> <ul> <li>任何涉及 null 的算术表达式的结果都是 null <ul> <li>5 + null returns null</li> </ul> </li> <li>任何涉及null的比较的结果都是unknown <ul> <li>5 &lt; null or null &lt;&gt; null or null = null</li> </ul> </li> <li>unknown有关的布尔运算 <ul> <li>(true AND unknown) = unknwon</li> <li>(false AND unknown) = false</li> <li>(unknown AND unknown) = unknown</li> <li>(true OR unknown) = true</li> <li>(false OR unknown) = unknown</li> <li>(unknown OR unknown) = unknown</li> <li>(NOT unknown) = unknown</li> </ul> </li> <li>如果 where 子句谓词的结果为 unknown，则它的结果被视为 false</li> <li>谓词IS NULL/IS NOT NULL可用于检查空值</li> <li>谓词IS UNKNOWN/IS NOT UNKNOWN可用于检测unknown（区别于true和false）</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure> <h4 id="聚集函数和空值"><a class="markdownIt-Anchor" href="#聚集函数和空值"></a> 聚集函数和空值</h4> <ul> <li>除了count(*)之外的所有聚集函数都忽略其输入集合的空值</li> <li>空集的count运算值为0</li> </ul> <h3 id="子查询"><a class="markdownIt-Anchor" href="#子查询"></a> 子查询</h3> <p>子查询是嵌套在另一个查询中的select-from-where表达式</p> <h4 id="集合成员资格"><a class="markdownIt-Anchor" href="#集合成员资格"></a> 集合成员资格</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN关键字测试成员资格</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> course_id <span class="keyword">FROM</span> section </span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span><span class="operator">=</span> <span class="number">2017</span> <span class="keyword">AND</span> course_id <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">select</span> course_id <span class="keyword">from</span> section <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span><span class="operator">=</span> <span class="number">2018</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- NOT IN关键字测试成员资格的缺失</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> course_id <span class="keyword">FROM</span> section </span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span><span class="operator">=</span> <span class="number">2017</span> <span class="keyword">AND</span> course_id <span class="keyword">NOT</span> <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">select</span> course_id <span class="keyword">from</span> section <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span><span class="operator">=</span> <span class="number">2018</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用于枚举集合</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> name <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> name <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;Mozart&#x27;</span>, <span class="string">&#x27;Einstein&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用于多属性测试成员资格</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span> (<span class="keyword">DISTINCT</span> ID) <span class="keyword">from</span> takes </span><br><span class="line"><span class="keyword">WHERE</span> (course_id, sec_id, semester, <span class="keyword">year</span>) <span class="keyword">IN</span> </span><br><span class="line">(<span class="keyword">SELECT</span> course_id, sec_id, semester, <span class="keyword">year</span> <span class="keyword">FROM</span> teaches <span class="keyword">where</span> teaches.ID<span class="operator">=</span> <span class="number">10101</span>);</span><br></pre></td></tr></table></figure> <h4 id="集合比较"><a class="markdownIt-Anchor" href="#集合比较"></a> 集合比较</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- &gt;,&lt;,&gt;=,&lt;=,&lt;&gt;,= SOME关键字用于表达至少比某一个大/小/相等</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">SOME</span> </span><br><span class="line">(<span class="keyword">select</span> salary <span class="keyword">from</span> instructor  <span class="keyword">where</span> dept name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- &gt;,&lt;,&gt;=,&lt;=,&lt;&gt;,= ALL关键字用于表达比所有的大/小/相等</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="keyword">ALL</span> </span><br><span class="line">(<span class="keyword">select</span> salary <span class="keyword">from</span> instructor  <span class="keyword">where</span> dept name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span>);</span><br></pre></td></tr></table></figure> <h4 id="空关系测试"><a class="markdownIt-Anchor" href="#空关系测试"></a> 空关系测试</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- EXISTS作为在参数的子查询非空时返回true值</span></span><br><span class="line"><span class="comment">-- NOT EXISTS在作为参数的子查询为空时返回true值</span></span><br><span class="line"><span class="comment">-- 来自外层查询的相关名称可以用在WHERE子句的查询中，此时该子查询被称为相关子查询（correlated subquery）</span></span><br><span class="line"><span class="comment">-- 关系A包含关系B可以写成not exists(B except A)</span></span><br><span class="line"><span class="keyword">SELECT</span> course_id </span><br><span class="line"><span class="keyword">FROM</span> section <span class="keyword">AS</span> S</span><br><span class="line"><span class="keyword">WHERE</span> semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">AND</span> <span class="keyword">year</span> <span class="operator">=</span> <span class="number">2017</span> <span class="keyword">AND</span> </span><br><span class="line"><span class="keyword">EXISTS</span> (<span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">        <span class="keyword">from</span> section <span class="keyword">as</span> T </span><br><span class="line">        <span class="keyword">where</span> semester <span class="operator">=</span> <span class="string">&#x27;Spring&#x27;</span> <span class="keyword">and</span> <span class="keyword">year</span><span class="operator">=</span> <span class="number">2018</span> <span class="keyword">and</span> S.course_id <span class="operator">=</span> T.course_id);</span><br></pre></td></tr></table></figure> <h4 id="重复元组存在性测试"><a class="markdownIt-Anchor" href="#重复元组存在性测试"></a> 重复元组存在性测试</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UNIQUE在作为参数的子查询没有重复的元组时返回true值</span></span><br><span class="line"><span class="comment">-- NOT UNIQUE在作为参数的子查询有重复的元组时返回true值</span></span><br><span class="line"><span class="keyword">SELECT</span> t.course_id <span class="keyword">FROM</span> course t </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">UNIQUE</span> (<span class="keyword">select</span> r.course_id <span class="keyword">from</span> section r </span><br><span class="line">              <span class="keyword">where</span> t.course_id<span class="operator">=</span> r.course_id <span class="keyword">and</span> r.year <span class="operator">=</span> <span class="number">2017</span>);</span><br></pre></td></tr></table></figure> <h4 id="from子句的子查询"><a class="markdownIt-Anchor" href="#from子句的子查询"></a> FROM子句的子查询</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用AS关键字为子查询结果起别名，并对属性进行重命名</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name, avg_salary <span class="keyword">FROM</span> ( </span><br><span class="line">    <span class="keyword">select</span> dept_name, <span class="built_in">avg</span> (salary) </span><br><span class="line">    <span class="keyword">from</span> instructor</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line">    ) <span class="keyword">AS</span> dept_avg (dept_name, avg_salary)</span><br><span class="line"><span class="keyword">WHERE</span> avg_salary <span class="operator">&gt;</span> <span class="number">42000</span>;</span><br><span class="line"><span class="comment">-- 使用LATERAL关键字访问同一个FROM子句中在它前面的表或子查询的属性</span></span><br><span class="line"><span class="keyword">SELECT</span> name, salary, avg_salary</span><br><span class="line"><span class="keyword">FROM</span> instructor I1, <span class="keyword">LATERAL</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(salary) <span class="keyword">as</span> avg_salary</span><br><span class="line">                             <span class="keyword">from</span> instructor I2</span><br><span class="line">                             <span class="keyword">where</span> I2.dept_name <span class="operator">=</span> I1.dept_name);</span><br></pre></td></tr></table></figure> <h4 id="with子句"><a class="markdownIt-Anchor" href="#with子句"></a> WITH子句</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用WITH关键字定义临时关系</span></span><br><span class="line"><span class="keyword">WITH</span> max_budget (<span class="keyword">value</span>) <span class="keyword">AS</span> (<span class="keyword">select</span> <span class="built_in">max</span>(budget) <span class="keyword">from</span> department)</span><br><span class="line"><span class="keyword">SELECT</span> department.name <span class="keyword">FROM</span> department, max_budget</span><br><span class="line"><span class="keyword">WHERE</span> department.budget <span class="operator">=</span> max_budget.value;</span><br></pre></td></tr></table></figure> <h4 id="标量子查询scalar-subquery"><a class="markdownIt-Anchor" href="#标量子查询scalar-subquery"></a> 标量子查询（scalar subquery）</h4> <ul> <li>SQL允许子查询出现在返回单个值的表达式能够出现的任何地方，只要该子查询<strong>只返回一个包含单个属性的元组</strong></li> <li>标量子查询可以出现在select，where和having子句中</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dept_name,</span><br><span class="line">    (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> instructor i</span><br><span class="line">    <span class="keyword">where</span> d.dept_name <span class="operator">=</span> i.dept_name)</span><br><span class="line">    <span class="keyword">AS</span> num_instructors</span><br><span class="line"><span class="keyword">from</span> department d;</span><br></pre></td></tr></table></figure> <h3 id="删除语句"><a class="markdownIt-Anchor" href="#删除语句"></a> 删除语句</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注意运行顺序，首先执行avg(salary)并查询到所有的元组后再执行删除</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> instructor <span class="keyword">WHERE</span> </span><br><span class="line"> salary <span class="operator">&lt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span> (salary) <span class="keyword">from</span> instructor);</span><br></pre></td></tr></table></figure> <h3 id="插入语句"><a class="markdownIt-Anchor" href="#插入语句"></a> 插入语句</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 可以在查询结果的基础上插入元组</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> instructor</span><br><span class="line">    <span class="keyword">select</span> ID, name, dept_name, <span class="number">18000</span> </span><br><span class="line">    <span class="keyword">from</span> student</span><br><span class="line">    <span class="keyword">where</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Music&#x27;</span> <span class="keyword">and</span> total_cred <span class="operator">&gt;</span> <span class="number">144</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">-- 另一种插入方式</span></span><br><span class="line"><span class="keyword">SELECT</span>  ID, name, dept_name, <span class="number">18000</span></span><br><span class="line"><span class="keyword">INTO</span> instructor</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Music&#x27;</span> <span class="keyword">AND</span> total_cred <span class="operator">&gt;</span> <span class="number">144</span>;    </span><br></pre></td></tr></table></figure> <h3 id="修改语句"><a class="markdownIt-Anchor" href="#修改语句"></a> 修改语句</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用CASE以避免更新次序引发问题</span></span><br><span class="line"><span class="keyword">UPDATE</span> instructor  </span><br><span class="line">    <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> salary <span class="operator">&lt;=</span> <span class="number">100000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.05</span></span><br><span class="line">        <span class="keyword">ELSE</span> salary <span class="operator">*</span> <span class="number">1.03</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line"><span class="comment">-- 使用标量子查询</span></span><br><span class="line"><span class="keyword">UPDATE</span> student</span><br><span class="line">    <span class="keyword">SET</span> tot_cred <span class="operator">=</span> (</span><br><span class="line">        <span class="keyword">select</span> <span class="built_in">sum</span>(credits)</span><br><span class="line">        <span class="keyword">from</span> takes, course</span><br><span class="line">        <span class="keyword">where</span> student.ID <span class="operator">=</span> takes.ID <span class="keyword">and</span></span><br><span class="line">            takes.course_id <span class="operator">=</span> course.course_id <span class="keyword">and</span></span><br><span class="line">            takes.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">and</span></span><br><span class="line">            takes.grade <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure> <h2 id="中级sql"><a class="markdownIt-Anchor" href="#中级sql"></a> 中级SQL</h2> <h3 id="连接表达式"><a class="markdownIt-Anchor" href="#连接表达式"></a> 连接表达式</h3> <h4 id="内连接inner-join"><a class="markdownIt-Anchor" href="#内连接inner-join"></a> 内连接（inner join）</h4> <ul> <li>不保留未匹配元组</li> </ul> <h4 id="外连接outer-join"><a class="markdownIt-Anchor" href="#外连接outer-join"></a> 外连接（outer join）</h4> <ul> <li>左外连接（left outer join） <ul> <li>只保留出现在左外连接运算之前（左边）的关系中的元组</li> </ul> </li> <li>右外连接（right outer join） <ul> <li>只保留出现在右外连接运算之后（右边）的关系中的元组</li> </ul> </li> <li>全外连接（full outer join） <ul> <li>保留出现在两个关系中的元组</li> </ul> </li> </ul> <h4 id="连接条件"><a class="markdownIt-Anchor" href="#连接条件"></a> 连接条件</h4> <ul> <li>natural <ul> <li>自然连接</li> </ul> </li> <li>on&lt;predicate&gt; <ul> <li>允许在参与连接的关系上设置通用的谓词</li> </ul> </li> <li>using(A1,A2…An) <ul> <li>设定指定属性上的取值相匹配</li> </ul> </li> </ul> <h3 id="视图"><a class="markdownIt-Anchor" href="#视图"></a> 视图</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用VIEW关键字创建视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> faculty <span class="keyword">AS</span> </span><br><span class="line">    <span class="keyword">select</span> ID, name, dept_name <span class="keyword">from</span> instructor;</span><br><span class="line"><span class="comment">-- 使用视图</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> faculty <span class="keyword">WHERE</span> dept_name <span class="operator">=</span> <span class="string">&#x27;Biology&#x27;</span>;</span><br><span class="line"><span class="comment">-- 视图嵌套视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> physics_fall_2017 <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">select</span> course.course_id, sec_id, building, room_number</span><br><span class="line">    <span class="keyword">from</span> course c, section s</span><br><span class="line">    <span class="keyword">where</span> c.course_id <span class="operator">=</span> s.course_id <span class="keyword">and</span> c.dept_name <span class="operator">=</span> <span class="string">&#x27;Physics&#x27;</span></span><br><span class="line">        <span class="keyword">and</span> s.semester <span class="operator">=</span> <span class="string">&#x27;Fall&#x27;</span> <span class="keyword">and</span> s.year <span class="operator">=</span> <span class="string">&#x27;2017&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> physics_fall_2017_watson <span class="keyword">AS</span></span><br><span class="line">    <span class="keyword">select</span> course_id, room_number  <span class="keyword">from</span> physics_fall_2017</span><br><span class="line">    <span class="keyword">where</span> building<span class="operator">=</span> <span class="string">&#x27;Watson&#x27;</span>;</span><br></pre></td></tr></table></figure> <h4 id="视图更新"><a class="markdownIt-Anchor" href="#视图更新"></a> 视图更新</h4> <p>仅允许对简单视图进行更新（update、insert、delete）</p> <ul> <li>from 子句只有一个数据库关系</li> <li>select 子句仅包含关系的属性名，不包含任何表达式、聚集或distinct声明</li> <li>任何未在 select 子句中列出的属性都可以取 null 值</li> <li>查询没有 group by 或 having 子句</li> </ul> <p>可以通过在视图定义的末尾插入with check option子句来防止更新不满足视图的定义</p> <h3 id="事务"><a class="markdownIt-Anchor" href="#事务"></a> 事务</h3> <ul> <li>提交事务（commit work）</li> <li>回滚事务（rollback work）</li> </ul> <h3 id="完整性约束"><a class="markdownIt-Anchor" href="#完整性约束"></a> 完整性约束</h3> <ul> <li>not null <ul> <li>非空约束，不允许存在空值</li> </ul> </li> <li>primary key(A1,A2,…,Am) <ul> <li>主键约束，属性A1,A2,…,Am形成主键</li> </ul> </li> <li>unique( A1, A2, …, Am) <ul> <li>唯一性约束，属性A1,A2,…,Am形成超键（可以为空）</li> </ul> </li> <li>check (P) <ul> <li>指定一个谓词P，关系中的每个元组都必须满足谓词P</li> </ul> </li> <li>foreign key (…) references t(…) <ul> <li>外键约束，被指定的属性列表必须声明为被引用关系的超键，即主键约束或唯一性约束</li> </ul> </li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOREIGN</span> KEY (dept_name) <span class="keyword">REFERENCES</span> department</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE     <span class="comment">-- 级联删除</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE    <span class="comment">-- 级联更新</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>    <span class="comment">-- 级联置空</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">DEFAULT</span>    <span class="comment">-- 级联置默认值</span></span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT    <span class="comment">-- 禁止级联</span></span><br></pre></td></tr></table></figure> <ul> <li>assertion <ul> <li>断言，即谓词</li> </ul> </li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ASSERTION credits <span class="keyword">CHECK</span></span><br><span class="line">(<span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> ID <span class="keyword">FROM</span> student))</span><br></pre></td></tr></table></figure> <h3 id="sql固有属性"><a class="markdownIt-Anchor" href="#sql固有属性"></a> SQL固有属性</h3> <ul> <li>date：日历日期，包括年（四位）、月和日</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">date</span> <span class="string">&#x27;2005-7-27&#x27;</span></span><br></pre></td></tr></table></figure> <ul> <li>time：一天中的时间，用时分秒来表示</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">time</span> <span class="string">&#x27;09:00:30&#x27;</span></span><br></pre></td></tr></table></figure> <ul> <li>timestamp：date和time的结合</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">timestamp</span>  <span class="string">&#x27;2005-7-27 09:00:30.75&#x27;</span></span><br></pre></td></tr></table></figure> <ul> <li>interval：区间，允许在日期、时间和时间区间上进行计算</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">interval</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">day</span></span><br></pre></td></tr></table></figure> <ul> <li>blob/clob：二进制/字符大对象</li> </ul> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book_review <span class="type">clob</span>(<span class="number">10</span>KB)</span><br><span class="line">image <span class="type">blob</span>(<span class="number">10</span>MB)</span><br></pre></td></tr></table></figure> <h3 id="类型转换缺省值"><a class="markdownIt-Anchor" href="#类型转换缺省值"></a> 类型转换&amp;缺省值</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用CAST函数将varchar类型的ID强制转换为numeric</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CAST</span>(ID <span class="keyword">AS</span> <span class="type">numeric</span>(<span class="number">5</span>))<span class="keyword">AS</span> inst_id</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用COALESCE函数改变空值显示方式</span></span><br><span class="line"><span class="comment">-- COALESCE函数要求所有参数必须是相同的类型</span></span><br><span class="line"><span class="keyword">SELECT</span> ID,<span class="built_in">COALESCE</span>(salary,<span class="number">0</span>)<span class="keyword">AS</span> salary</span><br><span class="line"><span class="keyword">FROM</span> instructor</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用DEFAULT定义缺省值</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student</span><br><span class="line">(tot_credit <span class="type">NUMERIC</span>(<span class="number">3</span>,<span class="number">0</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>);</span><br></pre></td></tr></table></figure> <h3 id="用户自定义类型udt域"><a class="markdownIt-Anchor" href="#用户自定义类型udt域"></a> 用户自定义类型（UDT）&amp;域</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用TYPE关键字自定义类型</span></span><br><span class="line"><span class="keyword">CREATE</span> TYPE Dollars <span class="keyword">AS</span> <span class="type">numeric</span> (<span class="number">12</span>,<span class="number">2</span>) <span class="keyword">FINAL</span>;</span><br><span class="line"><span class="comment">-- 使用自定义类型</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(name <span class="type">varchar</span> (<span class="number">20</span>),building <span class="type">varchar</span>(<span class="number">15</span>),budget Dollars);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用DOMAIN关键字自定义域，允许添加完整性约束</span></span><br><span class="line"><span class="keyword">CREATE</span> DOMAIN person_name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="comment">-- 域允许使用CONSTRAINT关键字添加约束</span></span><br><span class="line"><span class="keyword">CREATE</span> DOMAIN degree_level <span class="type">varchar</span>(<span class="number">10</span>) </span><br><span class="line">    <span class="keyword">CONSTRAINT</span> degree_level_test</span><br><span class="line">        <span class="keyword">CHECK</span> (<span class="keyword">value</span> <span class="keyword">in</span> (<span class="string">&#x27;Bachelors&#x27;</span>, <span class="string">&#x27;Masters&#x27;</span>, <span class="string">&#x27;Doctorate&#x27;</span>));</span><br></pre></td></tr></table></figure> <h3 id="索引"><a class="markdownIt-Anchor" href="#索引"></a> 索引</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 基础建表，ID为主键</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (ID <span class="type">varchar</span> (<span class="number">5</span>), </span><br><span class="line">                      name <span class="type">varchar</span> (<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">                      dept_name <span class="type">varchar</span> (<span class="number">20</span>),</span><br><span class="line">                      tot_cred <span class="type">numeric</span> (<span class="number">3</span>,<span class="number">0</span>) <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line">                      <span class="keyword">primary</span> key (ID));</span><br><span class="line"><span class="comment">-- UNIQUE INDEX使用候选键作为索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX studentName_index <span class="keyword">ON</span> student(name);</span><br><span class="line"><span class="comment">-- INDEX创建一般索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX studentDept_index <span class="keyword">ON</span> student(dept_name);</span><br><span class="line"><span class="comment">-- 显示索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">ON</span> student;</span><br><span class="line"><span class="comment">-- 删除索引</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX studentName_index;</span><br></pre></td></tr></table></figure> <h3 id="授权"><a class="markdownIt-Anchor" href="#授权"></a> 授权</h3> <h4 id="权限授予与收回"><a class="markdownIt-Anchor" href="#权限授予与收回"></a> 权限授予与收回</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 授予权限</span></span><br><span class="line"><span class="comment">-- GRANT &lt;权限列表&gt; ON &lt;关系名或视图名&gt; TO &lt;用户/角色列表&gt;;</span></span><br><span class="line"><span class="comment">-- WITH GRANT OPTION表示该用户可以将自己拥有的权限授权给别人</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">select</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">/</span><span class="keyword">delete</span><span class="operator">/</span><span class="keyword">update</span><span class="operator">/</span><span class="keyword">all</span> privilege <span class="keyword">ON</span> instructor <span class="keyword">TO</span> U1, U2, U3<span class="operator">/</span>public <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"><span class="comment">-- 表示仅可更新budget属性</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">update</span>(budget) <span class="keyword">ON</span> department <span class="keyword">TO</span> U1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 回收权限</span></span><br><span class="line"><span class="comment">-- REVOKE &lt;权限列表&gt; ON &lt;关系名或视图名&gt; FROM &lt;用户/角色列表&gt;;</span></span><br><span class="line"><span class="comment">-- CASCADE表示级联收权，RESTRICT表示禁止级联收权</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">select</span> <span class="keyword">ON</span> student <span class="keyword">FROM</span> U1, U2, U3 CASCADE<span class="operator">/</span>RESTRICT;</span><br></pre></td></tr></table></figure> <h4 id="角色"><a class="markdownIt-Anchor" href="#角色"></a> 角色</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建角色</span></span><br><span class="line"><span class="keyword">CREATE</span> ROLE teaching_assistant;</span><br><span class="line"><span class="keyword">CREATE</span> ROLE instructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 角色被授予权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">select</span> <span class="keyword">ON</span> takes <span class="keyword">TO</span> teaching_assistant;</span><br><span class="line"><span class="comment">-- 角色授予角色</span></span><br><span class="line"><span class="keyword">GRANT</span> teaching_assistant <span class="keyword">TO</span> instructor;</span><br><span class="line"><span class="comment">-- 角色授予用户</span></span><br><span class="line"><span class="keyword">GRANT</span> instructor <span class="keyword">TO</span> Satoshi;</span><br></pre></td></tr></table></figure> <h2 id="高级sql"><a class="markdownIt-Anchor" href="#高级sql"></a> 高级SQL</h2> <h3 id="使用程序设计语言访问sql"><a class="markdownIt-Anchor" href="#使用程序设计语言访问sql"></a> 使用程序设计语言访问SQL</h3> <ul> <li>使用一组函数连接到数据库服务器进行通信 <ul> <li><strong>JDBC</strong></li> <li>ODBC</li> <li>本地库</li> </ul> </li> <li>嵌入式 SQL <ul> <li>SQLJ</li> </ul> </li> </ul> <p>例：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="class_ title">jdbcSelect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="function_ title">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">c</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;org.postgresql.Driver&quot;</span>);</span><br><span class="line">            <span class="comment">//Open a connection</span></span><br><span class="line">            c = DriverManager.getConnection(<span class="string">&quot;jdbc:postgresql://d-sketon.top:15432/newdb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">            c.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Connect to database gaussdb successfully !&quot;</span>);</span><br><span class="line">            <span class="comment">//Create a statement object</span></span><br><span class="line">            stmt = c.createStatement();</span><br><span class="line">            <span class="comment">//Execute the statement</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT * FROM employee;&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="comment">//Process the result set</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;address&quot;</span>);</span><br><span class="line">                <span class="type">float</span> <span class="variable">salary</span> <span class="operator">=</span> rs.getFloat(<span class="string">&quot;salary&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;ID = &quot;</span> + id);</span><br><span class="line">                System.out.println(<span class="string">&quot;NAME = &quot;</span> + name);</span><br><span class="line">                System.out.println(<span class="string">&quot;AGE = &quot;</span> + age);</span><br><span class="line">                System.out.println(<span class="string">&quot;ADDRESS = &quot;</span> + address);</span><br><span class="line">                System.out.println(<span class="string">&quot;SALARY = &quot;</span> + salary);</span><br><span class="line">                System.out.println();</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            stmt.close();</span><br><span class="line">            c.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//Exception mechanism</span></span><br><span class="line">            System.err.println(e.getClass().getName() + <span class="string">&quot;: &quot;</span> + e.getMessage());</span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Operation done successfully !&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <h3 id="函数和过程"><a class="markdownIt-Anchor" href="#函数和过程"></a> 函数和过程</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL中定义的函数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept_count(dept_name <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line">    <span class="keyword">RETURN</span> <span class="type">INTEGER</span></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> d_count <span class="type">INTEGER</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">        <span class="keyword">FROM</span> instructor</span><br><span class="line">        <span class="keyword">WHERE</span> instructor.dept_name <span class="operator">=</span> dept_name</span><br><span class="line">    <span class="keyword">RETURN</span> d_count;</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line"><span class="comment">-- 使用函数</span></span><br><span class="line"><span class="keyword">SELECT</span> dept_name,budget</span><br><span class="line"><span class="keyword">FROM</span> department</span><br><span class="line"><span class="keyword">WHERE</span> dept_count(dept_name)<span class="operator">&gt;</span><span class="number">12</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQL中的表函数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> instructor_of(dept_name <span class="type">varchar</span>(<span class="number">20</span>))</span><br><span class="line">    <span class="keyword">RETURNS</span> <span class="keyword">TABLE</span>(</span><br><span class="line">        ID <span class="type">VARCHAR</span>(<span class="number">5</span>),</span><br><span class="line">        name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">RETURN</span> <span class="keyword">TABLE</span></span><br><span class="line">    (<span class="keyword">SELECT</span> ID,name</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">where</span> instructor.dept_name<span class="operator">=</span>dept_name);</span><br><span class="line"><span class="comment">-- 使用函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(instructor_of(<span class="string">&#x27;Finance&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SQL中的过程定义</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dept_count_proc(<span class="keyword">IN</span> dept_name <span class="type">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">out</span> d_count <span class="type">INTEGER</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> d_count</span><br><span class="line">    <span class="keyword">FROM</span> instructor</span><br><span class="line">    <span class="keyword">WHERE</span> instructor.dept_name<span class="operator">=</span>dept_name</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="comment">-- 使用过程</span></span><br><span class="line"><span class="keyword">DECLARE</span> d_count <span class="type">INTEGER</span>;</span><br><span class="line"><span class="keyword">CALL</span> dept_count_proc( <span class="string">&#x27;Physics&#x27;</span>, d_count);</span><br></pre></td></tr></table></figure> <h4 id="用于过程和函数的语言结构"><a class="markdownIt-Anchor" href="#用于过程和函数的语言结构"></a> 用于过程和函数的语言结构</h4> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 基础复合语句</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="comment">-- 其中包含的所有语句作为单个事务来执行</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- while语句</span></span><br><span class="line">WHILE 布尔表达式 DO</span><br><span class="line">    语句序列;</span><br><span class="line"><span class="keyword">END</span> WHILE</span><br><span class="line"></span><br><span class="line"><span class="comment">-- for语句</span></span><br><span class="line"><span class="keyword">FOR</span> 布尔表达式 DO</span><br><span class="line">    语句序列;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">FOR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- repeat语句</span></span><br><span class="line">REPEAT</span><br><span class="line">    语句序列;</span><br><span class="line">UNTIL 布尔表达式</span><br><span class="line"><span class="keyword">END</span> REPEAT</span><br><span class="line"></span><br><span class="line"><span class="comment">-- if-then-else语句</span></span><br><span class="line">IF 布尔表达式</span><br><span class="line">    <span class="keyword">THEN</span> 语句或复合语句</span><br><span class="line">ELSEIF 布尔表达式</span><br><span class="line">    <span class="keyword">THEN</span> 语句或复合语句</span><br><span class="line"><span class="keyword">ELSE</span> 语句或复合语句</span><br><span class="line"><span class="keyword">END</span> IF</span><br></pre></td></tr></table></figure> <h3 id="触发器"><a class="markdownIt-Anchor" href="#触发器"></a> 触发器</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 操作之后触发update/insert/delete/select</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> credits_earned AFTER <span class="keyword">UPDATE</span> grade <span class="keyword">ON</span> takes</span><br><span class="line"><span class="comment">-- 操作之前触发update/insert/delete/select</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> credits_earned BEFORE <span class="keyword">UPDATE</span> grade <span class="keyword">ON</span> takes</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 过渡行</span></span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">ROW</span> <span class="keyword">AS</span> nrow</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span> orow</span><br><span class="line"><span class="comment">-- 过渡表（不能用于before触发器）</span></span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> ntable</span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">OLD</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> otable</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 针对每个受影响的行执行一个操作</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="comment">-- 正对整条SQL语句执行单个操作</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> STATEMENT</span><br><span class="line"></span><br><span class="line"><span class="keyword">WHEN</span> nrow.grade <span class="operator">&lt;&gt;</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">AND</span> nrow.grade <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">AND</span> (orow.grade <span class="operator">=</span> <span class="string">&#x27;F&#x27;</span> <span class="keyword">OR</span> orow.grade <span class="keyword">IS</span> <span class="keyword">NULL</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">ATOMIC</span></span><br><span class="line">    <span class="keyword">UPDATE</span> student</span><br><span class="line">        <span class="keyword">SET</span> tot_cred<span class="operator">=</span>tot_cred<span class="operator">+</span></span><br><span class="line">        (<span class="keyword">SELECT</span> credits</span><br><span class="line">        <span class="keyword">FROM</span> course</span><br><span class="line">        <span class="keyword">WHEN</span> course.course_id<span class="operator">=</span>nrow.course_id)</span><br><span class="line">    <span class="keyword">WHEN</span> student.id<span class="operator">=</span>nrow.id;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure> <h3 id="递归查询"><a class="markdownIt-Anchor" href="#递归查询"></a> 递归查询</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用WITH RECURSIVE建立递归视图</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> rec_prereq(course_id, prereq_id) <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> course_id, prereq_id <span class="keyword">from</span> prereq</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span> rpr.course_id, pr.prereq_id,</span><br><span class="line">    <span class="keyword">from</span> rec_prereq rpr, prereq pr <span class="keyword">where</span> rpr.prereq_id <span class="operator">=</span> pr.course_id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> ∗ <span class="keyword">FROM</span> rec_prereq;</span><br></pre></td></tr></table></figure> <h3 id="排名"><a class="markdownIt-Anchor" href="#排名"></a> 排名</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用rank函数进行排名</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> GPA <span class="keyword">desc</span>) <span class="keyword">AS</span> s_rank <span class="keyword">FROM</span> grades;</span><br><span class="line"><span class="comment">-- dense_rank函数不会产生空档</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">dense_rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> GPA <span class="keyword">desc</span>) <span class="keyword">AS</span> s_rank </span><br><span class="line"><span class="keyword">FROM</span> grades;</span><br><span class="line"><span class="comment">-- nulls last/nulls first指定空值在排名中的位置</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, <span class="built_in">dense_rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> GPA <span class="keyword">desc</span> nulls <span class="keyword">last</span>) <span class="keyword">AS</span> s_rank </span><br><span class="line"><span class="keyword">FROM</span> grades;</span><br><span class="line"><span class="comment">-- 使用partition by关键字选择在不同的分区里进行排名</span></span><br><span class="line"><span class="keyword">SELECT</span> ID, dept_name,</span><br><span class="line">    <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> dept_name <span class="keyword">order</span> <span class="keyword">by</span> GPA <span class="keyword">desc</span>) <span class="keyword">as</span> dept_rank</span><br><span class="line"><span class="keyword">FROM</span> grades</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dept_name, dept_rank;</span><br><span class="line"></span><br></pre></td></tr></table></figure> <h3 id="分窗"><a class="markdownIt-Anchor" href="#分窗"></a> 分窗</h3> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 前一个到后一个之间分窗</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">date</span>, <span class="built_in">sum</span>(<span class="keyword">value</span>) <span class="keyword">over</span> </span><br><span class="line">    (<span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">1</span> preceding <span class="keyword">and</span> <span class="number">1</span> following)</span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"><span class="comment">-- 含当前行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">date</span>, <span class="built_in">sum</span>(<span class="keyword">value</span>) <span class="keyword">over</span> </span><br><span class="line">    (<span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">rows</span> bewtween <span class="number">1</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>)</span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"><span class="comment">-- 使用partition by关键字选择在不同的分区里分窗</span></span><br><span class="line"><span class="comment">-- unbounded preceding代表前面所有数据分窗</span></span><br><span class="line"><span class="keyword">select</span> account, <span class="type">date</span>, <span class="built_in">sum</span>(<span class="keyword">value</span>) <span class="keyword">over</span></span><br><span class="line">    (<span class="keyword">partition</span> <span class="keyword">by</span> account <span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">rows</span> unbounded preceding) <span class="keyword">as</span> bal</span><br><span class="line"><span class="keyword">FROM</span> transaction <span class="keyword">ORDER</span> <span class="keyword">BY</span> account, <span class="type">date</span></span><br></pre></td></tr></table></figure> <h2 id="使用e-r模型的数据库设计"><a class="markdownIt-Anchor" href="#使用e-r模型的数据库设计"></a> 使用E-R模型的数据库设计</h2> <h3 id="实体-联系模型"><a class="markdownIt-Anchor" href="#实体-联系模型"></a> 实体-联系模型</h3> <h4 id="实体集"><a class="markdownIt-Anchor" href="#实体集"></a> 实体集</h4> <ul> <li>是共享相同性质或属性的、具有相同类型的实体的集合</li> <li>通过一组属性（attribute）来表示</li> <li>在E-R图中用<strong>矩形</strong>来表示<br> <img src="https://d-sketon.top/img/db-book/1.png" alt="1"></li> </ul> <h4 id="联系集"><a class="markdownIt-Anchor" href="#联系集"></a> 联系集</h4> <ul> <li>是在n≥2个（可能相同的）实体集上的数学关系</li> <li>在E-R图中用<strong>菱形</strong>来表示<br> <img src="https://d-sketon.top/img/db-book/2.png" alt="2"></li> <li>联系集可以递归进行<br> <img src="https://d-sketon.top/img/db-book/3.png" alt="3"></li> <li>联系可以具有被称作<strong>描述性属性</strong>的属性</li> <li>联系集的属性在E-R图中通过<strong>未分割的矩形</strong>来表示<br> <img src="https://d-sketon.top/img/db-book/4.png" alt="4"></li> </ul> <h4 id="复杂属性"><a class="markdownIt-Anchor" href="#复杂属性"></a> 复杂属性</h4> <ul> <li>属性类型</li> <li><strong>简单</strong>和<strong>复合</strong>属性 <ul> <li>简单属性不能被划分为子部分，而复合属性可以被划分为子部分</li> </ul> </li> <li><strong>单值</strong>和<strong>多值</strong>属性 <ul> <li>单值属性对于一个特定实体都只有单独的一个值</li> </ul> </li> <li><strong>派生属性</strong> <ul> <li>这类属性的值可以从其他相关属性或实体的值派生出来</li> </ul> </li> </ul> <p><img src="https://d-sketon.top/img/db-book/5.png" alt="5"></p> <h4 id="映射基数"><a class="markdownIt-Anchor" href="#映射基数"></a> 映射基数</h4> <p>表示一个实体能通过一个联系集关联的另一些实体的数量</p> <ul> <li><strong>一对一</strong>：A中的一个实体<strong>至多</strong>与B中的一个实体相关联，并且B中的一个实体也<strong>至多</strong>与A中的一个实体相关联</li> <li><strong>一对多</strong>：A中的一个实体可以与B中<strong>任意数量</strong>的实体相关联，而B中的一个实体<strong>至多</strong>与A中的一个实体相关联</li> <li><strong>多对一</strong>：A中的一个实体<strong>至多</strong>与B中的一个实体相关联，而B中的一个实体可以与A中<strong>任意数量</strong>的实体相关联</li> <li><strong>多对多</strong>：A中的一个实体可以与B中<strong>任意数量</strong>的实体相关联，并且B中的一个实体也可以与A中<strong>任意数量</strong>的实体相关联</li> </ul> <p><img src="https://d-sketon.top/img/db-book/6.png" alt="6"></p> <p>E-R图中的表示方法：<br> <img src="https://d-sketon.top/img/db-book/7.png" alt="7"></p> <p>用双线表示一个实体在联系集中的全部参与：</p> <p><img src="https://d-sketon.top/img/db-book/8.png" alt="8"></p> <p>线段上可以有一个关联的最小和最大基数，用l…h的形式表示</p> <p><img src="https://d-sketon.top/img/db-book/9.png" alt="9"></p> <h3 id="主键"><a class="markdownIt-Anchor" href="#主键"></a> 主键</h3> <h4 id="实体集-2"><a class="markdownIt-Anchor" href="#实体集-2"></a> 实体集</h4> <ul> <li>一个实体的属性取值必须可以唯一表示该实体</li> <li>键（key）的概念直接适用于实体集</li> </ul> <h4 id="联系集-2"><a class="markdownIt-Anchor" href="#联系集-2"></a> 联系集</h4> <p>属性集合<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>−</mo><mi>k</mi><mi>e</mi><mi>y</mi><mo stretchy="false">(</mo><msub><mi>E</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>∪</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>−</mo><mi>k</mi><mi>e</mi><mi>y</mi><mo stretchy="false">(</mo><msub><mi>E</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>∪</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>∪</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>y</mi><mo>−</mo><mi>k</mi><mi>e</mi><mi>y</mi><mo stretchy="false">(</mo><msub><mi>E</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">primary-key(E_1)\cup primary-key(E_2) \cup ... \cup primary-key(E_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.854em;vertical-align:-.1944em"></span><span class="mathnormal mord">p</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">ima</span><span class="mathnormal mord" style="margin-right:.03588em">ry</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.03148em">k</span><span class="mathnormal mord" style="margin-right:.03588em">ey</span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0576em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.854em;vertical-align:-.1944em"></span><span class="mathnormal mord">p</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">ima</span><span class="mathnormal mord" style="margin-right:.03588em">ry</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.03148em">k</span><span class="mathnormal mord" style="margin-right:.03588em">ey</span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0576em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord">...</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.854em;vertical-align:-.1944em"></span><span class="mathnormal mord">p</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mathnormal mord">ima</span><span class="mathnormal mord" style="margin-right:.03588em">ry</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.03148em">k</span><span class="mathnormal mord" style="margin-right:.03588em">ey</span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord" style="margin-right:.05764em">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0576em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br> 构成了联系集的一个超键</p> <ul> <li>二元联系集主键的选择取决于联系集的映射基数 <ul> <li>对于多对多关系，前述主键的并集是最小的超键，并被选作主键</li> <li>对于多对一和一对多关系，“多”方的主键是最小的超键，并被选作主键</li> <li>对于一对一关系，任意参与实体集的主键都构成最小超键，并可被选作主键</li> </ul> </li> </ul> <h4 id="弱实体集"><a class="markdownIt-Anchor" href="#弱实体集"></a> 弱实体集</h4> <p>弱实体集的存在依赖于另一个实体集，称其为<strong>标识性实体集</strong><br> 使用标识性实体集的主键以及称为<strong>分辨符属性</strong>的额外属性来唯一地标识弱实体</p> <ul> <li>E-R图中，通过双边框的矩形描述弱实体集，其分辨符被加上需的下划线</li> <li>关联弱实体集和标识性强实体集的联系集以双边框的菱形表示</li> <li>通常，弱实体集必须全部参与其标识性联系集，并且该联系是到标识性实体集的多对一联系</li> </ul> <p><img src="https://d-sketon.top/img/db-book/10.png" alt="10"></p> <h3 id="扩展的e-r特性"><a class="markdownIt-Anchor" href="#扩展的e-r特性"></a> 扩展的E-R特性</h3> <h4 id="特化specialization概化generalization"><a class="markdownIt-Anchor" href="#特化specialization概化generalization"></a> 特化（Specialization）/概化（Generalization）</h4> <ul> <li>在一个高层实体集与一个或多个低层实体集之间存在的包含关系</li> <li>重叠特化：允许一个实体属于多个特化实体集（使用两个单独的箭头）</li> <li>不相交特化：允许一个实体至多属于一个特化实体集（使用单个箭头）</li> </ul> <p><img src="https://d-sketon.top/img/db-book/11.png" alt="11"></p> <ul> <li>全部特化/概化：每个高层实体必须属于一个低层实体集</li> <li>部分特化/概化：一些高层实体可以不属于一个低层实体集（默认）</li> </ul> <h4 id="聚集aggregation"><a class="markdownIt-Anchor" href="#聚集aggregation"></a> 聚集（Aggregation）</h4> <ul> <li>一种抽象，通过这种抽象，联系被视为高层实体</li> </ul> <p><img src="https://d-sketon.top/img/db-book/12.png" alt="12"></p> <h3 id="将e-r图转换为关系模式"><a class="markdownIt-Anchor" href="#将e-r图转换为关系模式"></a> 将E-R图转换为关系模式</h3> <h4 id="强实体集的表示"><a class="markdownIt-Anchor" href="#强实体集的表示"></a> 强实体集的表示</h4> <p>强实体集的主键就作为所得到的模式的主键</p> <h4 id="具有复杂属性的强实体集的表示"><a class="markdownIt-Anchor" href="#具有复杂属性的强实体集的表示"></a> 具有复杂属性的强实体集的表示</h4> <ul> <li>复合属性 <ul> <li>不为复合属性自身创建一个单独的属性</li> </ul> </li> <li>多值属性 <ul> <li>为多值属性构建一个新的关系模式</li> </ul> </li> <li>派生属性 <ul> <li>不在关系数据模型中显式地表示出来</li> </ul> </li> </ul> <h4 id="弱实体集的表示"><a class="markdownIt-Anchor" href="#弱实体集的表示"></a> 弱实体集的表示</h4> <p>对于从弱实体集转换而来的模式，该模式的主键由其强实体集的主键与弱实体集的分辨符组合而成。除了创建主键之外，还需要在关系上建立外键约束，以保证对于表示弱实体的每个元组，都有一个表示相应强实体的元组与之对应</p> <h4 id="联系集的表示"><a class="markdownIt-Anchor" href="#联系集的表示"></a> 联系集的表示</h4> <p>联系集的主键属性也被用作关系模式的主键属性</p> <h4 id="模式的冗余"><a class="markdownIt-Anchor" href="#模式的冗余"></a> 模式的冗余</h4> <p>连接弱实体集与之对应的强实体集的联系集的模式是冗余的</p> <h4 id="模式的合并"><a class="markdownIt-Anchor" href="#模式的合并"></a> 模式的合并</h4> <ul> <li>对于多对一联系集，联系集的关系模式可以和“多”方的模式进行合并</li> <li>对于一对一联系集，联系集的关系模式可以和参与联系的任何一个实体集的模式进行合并</li> </ul> <h3 id="实体-联系设计问题"><a class="markdownIt-Anchor" href="#实体-联系设计问题"></a> 实体-联系设计问题</h3> <h4 id="e-r图中的创建错误"><a class="markdownIt-Anchor" href="#e-r图中的创建错误"></a> E-R图中的创建错误</h4> <ul> <li>使用一个实体集的主键作为另一个实体集的属性</li> <li>将相关实体集的主键属性作为联系集的属性</li> <li>在需要多值属性的情况下使用具有单值属性的联系</li> </ul> <h4 id="使用实体集还是属性"><a class="markdownIt-Anchor" href="#使用实体集还是属性"></a> 使用实体集还是属性？</h4> <p>对于这一问题并无简单的答案。区分它们主要依赖于被建模的显示企业的结构，以及与被讨论的属性相关的语义</p> <h4 id="使用实体集还是联系集"><a class="markdownIt-Anchor" href="#使用实体集还是联系集"></a> 使用实体集还是联系集？</h4> <p>当描述发生在实体间的行为时建议采用联系集</p> <h4 id="二元还是n元联系集"><a class="markdownIt-Anchor" href="#二元还是n元联系集"></a> 二元还是n元联系集？</h4> <p>一个非二元的联系集总可以用一组不同的二元联系集来替代</p> <h2 id="关系数据库设计"><a class="markdownIt-Anchor" href="#关系数据库设计"></a> 关系数据库设计</h2> <h3 id="分解"><a class="markdownIt-Anchor" href="#分解"></a> 分解</h3> <ul> <li>避免模式中存在信息重复问题的唯一方式是将其分解为多个模式</li> <li>并非所有的模式分解都是有益的</li> <li>分解过程中存在信息丢失的称为<strong>有损分解</strong>，而没有信息丢失的称为<strong>无损分解</strong></li> </ul> <h4 id="无损分解"><a class="markdownIt-Anchor" href="#无损分解"></a> 无损分解</h4> <p>令R为关系模式，并令R1和R2构成R的分解<br> 若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><msub><mi>R</mi><mn>1</mn></msub></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>⋈</mo><msub><mi mathvariant="normal">Π</mi><msub><mi>R</mi><mn>2</mn></msub></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">\Pi_{R_1}(r) \Join \Pi_{R_2}(r) = r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-.2501em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.0077em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-.2501em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.0077em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span></span></span></span>，则说明分解是无损的<br> 若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>⊂</mo><msub><mi mathvariant="normal">Π</mi><msub><mi>R</mi><mn>1</mn></msub></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>⋈</mo><msub><mi mathvariant="normal">Π</mi><msub><mi>R</mi><mn>2</mn></msub></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r \subset \Pi_{R_1}(r) \Join \Pi_{R_2}(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊂</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-.2501em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.0077em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-.2501em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight"><span class="mathnormal mord mtight" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.0077em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span>，则说明分解是有损的</p> <h4 id="规范化理论"><a class="markdownIt-Anchor" href="#规范化理论"></a> 规范化理论</h4> <ul> <li>确定一个给定的关系模式是否为“良构的”</li> <li>如果一个给定的关系模式不是“良构的”，则需要将其分解为许多较小的关系模式，使得每个模式都满足适当的范式。且分解必须是无损分解</li> </ul> <h3 id="使用函数依赖进行分解"><a class="markdownIt-Anchor" href="#使用函数依赖进行分解"></a> 使用函数依赖进行分解</h3> <h4 id="符号惯例"><a class="markdownIt-Anchor" href="#符号惯例"></a> 符号惯例</h4> <ul> <li>使用希腊字母（例如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>）来表示属性集</li> <li>使用大写的罗马字母（例如R）来表示关系模式</li> <li>使用K来表示属性集的一个超键</li> <li>符号r®表示具有模式R的关系r</li> </ul> <h4 id="键和函数依赖"><a class="markdownIt-Anchor" href="#键和函数依赖"></a> 键和函数依赖</h4> <p>考虑一个关系模式r®，并且令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>⊆</mo><mi>R</mi><mo>∧</mo><mi>β</mi><mo>⊆</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\alpha \subseteq R \land \beta \subseteq R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7719em;vertical-align:-.136em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span></p> <ul> <li>给r®的一个实例，如果对于该实例中的所有元组对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">t_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>，使得若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>α</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi>α</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">t_1[\alpha]=t_2[\alpha]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mclose">]</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mclose">]</span></span></span></span>，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="false">[</mo><mi>β</mi><mo stretchy="false">]</mo><mo>=</mo><msub><mi>t</mi><mn>2</mn></msub><mo stretchy="false">[</mo><mi>β</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">t_1[\beta]=t_2[\beta]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">]</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">]</span></span></span></span>也成立，那么实例满足<strong>函数依赖</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span></li> <li>如果r®的每个合法实例都满足函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>，则函数依赖在模式r®上<strong>成立</strong></li> </ul> <h5 id="键和函数依赖-2"><a class="markdownIt-Anchor" href="#键和函数依赖-2"></a> 键和函数依赖</h5> <ul> <li>如果函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>→</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">K \rightarrow R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.07153em">K</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>在r®上成立，则K是r®的一个超键</li> <li>如果函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>→</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">K \rightarrow R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.07153em">K</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>在r®上成立，并且不存在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>⊂</mo><mi>K</mi><mo separator="true">,</mo><mi>α</mi><mo>→</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\alpha \subset K,\alpha \rightarrow R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊂</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.07153em">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>，则K是r®的一个候选键</li> </ul> <h5 id="平凡函数依赖"><a class="markdownIt-Anchor" href="#平凡函数依赖"></a> 平凡函数依赖</h5> <p>如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>⊆</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\beta \subseteq \alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>，则形如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>的函数依赖是平凡的（trivial）</p> <h5 id="传递依赖"><a class="markdownIt-Anchor" href="#传递依赖"></a> 传递依赖</h5> <p>令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>为属性集，使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立但<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>→</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\beta \rightarrow \alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>不成立。对于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∈</mo><mi>R</mi><mo separator="true">,</mo><mi>A</mi><mo mathvariant="normal">∉</mo><mi>α</mi><mo separator="true">,</mo><mi>A</mi><mo mathvariant="normal">∉</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">A \in R,A \notin \alpha, A \notin \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7224em;vertical-align:-.0391em"></span><span class="mathnormal mord">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mathnormal mord">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:.0556em"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mathnormal mord">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:.0556em"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>，如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>→</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">\beta \rightarrow A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord">A</span></span></span></span>，则A传递依赖于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span></p> <h5 id="部分依赖"><a class="markdownIt-Anchor" href="#部分依赖"></a> 部分依赖</h5> <p>存在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>的一个真子集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\gamma \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>部分依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span></p> <h4 id="函数依赖集的闭包"><a class="markdownIt-Anchor" href="#函数依赖集的闭包"></a> 函数依赖集的闭包</h4> <p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>：函数依赖集<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>：能够从集合<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>中推导出的所有函数依赖的集合<br> 阿姆斯特朗公理：</p> <ul> <li><strong>自反律</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>为一个属性集且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>⊆</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\beta \subseteq \alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立</li> <li><strong>增补律</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>为一个属性集，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mi>α</mi><mo>→</mo><mi>γ</mi><mi>β</mi></mrow><annotation encoding="application/x-tex">\gamma\alpha \rightarrow \gamma\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立</li> <li><strong>传递律</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>→</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\beta \rightarrow \gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立</li> </ul> <p>附加规则：</p> <ul> <li><strong>合并律</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立</li> <li><strong>分解律</strong>：若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span></span></span></span>成立</li> <li><strong>伪传递律</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>成立且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mi>β</mi><mo>→</mo><mi>δ</mi></mrow><annotation encoding="application/x-tex">\gamma\beta \rightarrow \delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05556em">γ</span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6944em"></span><span class="mathnormal mord" style="margin-right:.03785em">δ</span></span></span></span>成立，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mi>γ</mi><mo>→</mo><mi>δ</mi></mrow><annotation encoding="application/x-tex">\alpha\gamma \rightarrow \delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mathnormal mord" style="margin-right:.05556em">γ</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6944em"></span><span class="mathnormal mord" style="margin-right:.03785em">δ</span></span></span></span>成立</li> </ul> <p>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>的过程：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">F+ = F</span><br><span class="line">应用自反律生成所有的平凡依赖</span><br><span class="line">repeat</span><br><span class="line">    for each F+中的函数依赖f</span><br><span class="line">        在f上应用增补律</span><br><span class="line">        将函数依赖的结果加入F+中</span><br><span class="line">    for each F+中的一对函依赖f1和f2</span><br><span class="line">        if f1和f2可以使用传递律进行结合</span><br><span class="line">            将函数依赖的结果加入F+中</span><br><span class="line">until F+不再发生变化</span><br></pre></td></tr></table></figure> <h4 id="属性集的闭包"><a class="markdownIt-Anchor" href="#属性集的闭包"></a> 属性集的闭包</h4> <p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>：属性集<br> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\alpha^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>下<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>的闭包，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>下被<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>决定的属性集</p> <p>计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>下<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\alpha^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>的过程：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result := α;</span><br><span class="line">repeat</span><br><span class="line">    for each 函数依赖β→γ in F do</span><br><span class="line">        begin</span><br><span class="line">            if β⊆ result then result := result∪γ;</span><br><span class="line">        end</span><br><span class="line">until(result不再发生改变)</span><br></pre></td></tr></table></figure> <p>属性闭包算法的用途：</p> <ul> <li>测试<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>是否为超键，可以计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\alpha^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>，并检查<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\alpha^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>是否包含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>中的所有属性</li> <li>通过检查<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>⊆</mo><msup><mi>α</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">\beta \subseteq \alpha^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>，可以检查一个函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>是否成立</li> <li>另一种<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>的可替代方法</li> </ul> <h4 id="保持依赖"><a class="markdownIt-Anchor" href="#保持依赖"></a> 保持依赖</h4> <p>验证保持依赖的方式，该方式对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>中的每个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>都使用下面的过程：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">result = α</span><br><span class="line">repeat </span><br><span class="line">    for each 分解后的Ri</span><br><span class="line">        t = (result∩Ri)+ ∩ Ri</span><br><span class="line">        result = result ∪ t</span><br><span class="line">until(result没有变化)</span><br></pre></td></tr></table></figure> <p>如果result包含了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>的所有属性，则函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>被保持</p> <h4 id="正则覆盖"><a class="markdownIt-Anchor" href="#正则覆盖"></a> 正则覆盖</h4> <ul> <li>从一个函数依赖的左侧删除一个属性可以使其成为更强的约束</li> <li>从一个函数依赖的右侧删除一个属性可以使其成为更弱的约束</li> </ul> <h5 id="无关属性"><a class="markdownIt-Anchor" href="#无关属性"></a> 无关属性</h5> <p>考虑一个函数依赖集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>以及<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>中的函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span></p> <ul> <li><strong>从左侧移除</strong>：如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∈</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">A \in \alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7224em;vertical-align:-.0391em"></span><span class="mathnormal mord">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>并且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>逻辑蕴含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>F</mi><mo>−</mo><mo stretchy="false">{</mo><mi>α</mi><mo>→</mo><mi>β</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>α</mi><mo>−</mo><mi>A</mi><mo stretchy="false">)</mo><mo>→</mo><mi>β</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">(F-\{\alpha \rightarrow \beta\}) \cup \{(\alpha -A)\rightarrow \beta\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">})</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">}</span></span></span></span>，则属性<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord">A</span></span></span></span>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>中是无关的</li> <li><strong>从右侧移除</strong>：如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∈</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">A \in \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7224em;vertical-align:-.0391em"></span><span class="mathnormal mord">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>并且函数依赖集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>F</mi><mo>−</mo><mo stretchy="false">{</mo><mi>α</mi><mo>→</mo><mi>β</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">{</mo><mi>α</mi><mo>→</mo><mo stretchy="false">(</mo><mi>β</mi><mo>−</mo><mi>A</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">(F-\{\alpha \rightarrow \beta\}) \cup \{\alpha \rightarrow (\beta - A)\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">})</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord">A</span><span class="mclose">)}</span></span></span></span>逻辑蕴含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>，则属性<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord">A</span></span></span></span>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>中是无关的</li> </ul> <h5 id="正则覆盖-2"><a class="markdownIt-Anchor" href="#正则覆盖-2"></a> 正则覆盖</h5> <p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>的正则覆盖集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">F_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>是这样的一个依赖集：</p> <ul> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>逻辑蕴含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">F_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的所有依赖</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">F_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>逻辑蕴含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>的所有依赖</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">F_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>中任何函数依赖都不包含无关属性</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">F_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>中每个函数依赖的左侧都是唯一的</li> </ul> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Fc=F</span><br><span class="line">repeat</span><br><span class="line">    使用合并律将Fc中任何形如α1→β1和α1→β2的依赖替换为α1→β1β2</span><br><span class="line">    在Fc中寻找一个函数依赖α→β，它要么在α中要么在β中具有一个无关属性</span><br><span class="line">    /*使用Fc而非F来检验无关属性*/</span><br><span class="line">    如果找到一个无关属性，则将它从Fc中的α→β中删除</span><br><span class="line">until(Fc不再改变)</span><br></pre></td></tr></table></figure> <h4 id="无损分解和函数依赖"><a class="markdownIt-Anchor" href="#无损分解和函数依赖"></a> 无损分解和函数依赖</h4> <p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>构成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个无损分解的条件是，以下函数依赖中至少有一个在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>中：</p> <ul> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub><mo>∩</mo><msub><mi>R</mi><mn>2</mn></msub><mo>→</mo><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1 \cap R_2 \rightarrow R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub><mo>∩</mo><msub><mi>R</mi><mn>2</mn></msub><mo>→</mo><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_1 \cap R_2 \rightarrow R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></li> </ul> <p>即，如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub><mo>∩</mo><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_1 \cap R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>要么构成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的超键要么构成<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的超键，则<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的分解就是一个无损分解</p> <h3 id="范式"><a class="markdownIt-Anchor" href="#范式"></a> 范式</h3> <h4 id="bcnf范式"><a class="markdownIt-Anchor" href="#bcnf范式"></a> BCNF范式</h4> <p>对于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>中所有形如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>的函数依赖（其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>⊆</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\alpha \subseteq R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7719em;vertical-align:-.136em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>⊆</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\beta \subseteq R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>），下面至少有一项成立：</p> <ul> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>是平凡函数依赖</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>是模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个超键</li> </ul> <p>对于不属于BCNF的模式进行分解的通用规则：<br> 若存在非平凡函数依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>，使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>不是模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个超键，则使用以下两个模式取代<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span></p> <ul> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>α</mi><mo>∪</mo><mi>β</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\alpha \cup \beta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mclose">)</span></span></span></span></li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>R</mi><mo>−</mo><mo stretchy="false">(</mo><mi>β</mi><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(R-(\beta-\alpha))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mclose">))</span></span></span></span></li> </ul> <h5 id="bcnf的检测"><a class="markdownIt-Anchor" href="#bcnf的检测"></a> BCNF的检测</h5> <ul> <li>为了检查一个非平凡的依赖<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>是否违反BCNF，可以计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">a^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>，并且验证它是否包含了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>中的所有属性，即验证其是否是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个超键</li> <li>为了检查一个关系模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>是否属于BCNF，仅需检查给定集合<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.13889em">F</span></span></span></span>中的依赖是否违反BCNF就足够了，而不必检查<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>中的所有依赖</li> <li>为了检查<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>分解后的一个关系模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">R_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>是否属于BCNF，对于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">R_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>中属性的每个子集<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>，检查<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">a^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>要么 <ul> <li>不包含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">R_i-\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>的任何属性</li> <li>包含<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">R_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.0077em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>的所有属性</li> </ul> </li> </ul> <h5 id="bcnf分解算法"><a class="markdownIt-Anchor" href="#bcnf分解算法"></a> BCNF分解算法</h5> <p>该算法所产生的分解不仅满足BCNF，而且还是无损分解：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">result :=&#123;R&#125;;</span><br><span class="line">done := false;</span><br><span class="line">while (not done) do</span><br><span class="line">    if (在result中存在一个模式Ri不属于BCNF) then</span><br><span class="line">        begin</span><br><span class="line">            令α→β为在Ri上成立的一个非平凡函数依赖，使得α+并不包含Ri，且α∩β=∅</span><br><span class="line">            result :=(result-Ri)∪(Ri-β)∪(α,β);</span><br><span class="line">        end</span><br><span class="line">    else done := true; </span><br><span class="line"></span><br></pre></td></tr></table></figure> <h4 id="3nf范式"><a class="markdownIt-Anchor" href="#3nf范式"></a> 3NF范式</h4> <p>对于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7713em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7713em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>中所有形如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>的函数依赖（其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>⊆</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\alpha \subseteq R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7719em;vertical-align:-.136em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>⊆</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\beta \subseteq R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>），下面至少有一项成立：</p> <ul> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>→</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\alpha \rightarrow \beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span></span></span></span>是平凡函数依赖</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>是模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个超键</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\beta-\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mathnormal mord" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mathnormal mord" style="margin-right:.0037em">α</span></span></span></span>中的每个属性<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord">A</span></span></span></span>都被包含于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的一个候选码中（可能在不同的候选码之中）</li> </ul> <p><strong>任何满足BCNF的模式也满足3NF</strong></p> <h5 id="3nf分解"><a class="markdownIt-Anchor" href="#3nf分解"></a> 3NF分解</h5> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">令Fc为F的一个正则覆盖;</span><br><span class="line">i := 0;</span><br><span class="line">for each Fc中的函数依赖α→β</span><br><span class="line">    i := i+1;</span><br><span class="line">    Ri:=αβ;</span><br><span class="line">if 没有一个模式Rj(j=1,2,...,i)包含R的一个候选码</span><br><span class="line">    then</span><br><span class="line">        i :=i+1;</span><br><span class="line">        Ri:=R的任一候选码;</span><br><span class="line">/*可选地删除冗余关系*/</span><br><span class="line">repeat</span><br><span class="line">    if 任意模式Rj包含与另一个模式Rk中</span><br><span class="line">        then</span><br><span class="line">        /*删除Rj*/</span><br><span class="line">        Rj:=Ri;</span><br><span class="line">        i :=i-1;</span><br><span class="line">until 不再有可以被删除的Rj</span><br><span class="line">return (R1,R2,...Ri)</span><br></pre></td></tr></table></figure> <h4 id="1nf范式"><a class="markdownIt-Anchor" href="#1nf范式"></a> 1NF范式</h4> <p>关系模式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mathnormal mord" style="margin-right:.00773em">R</span></span></span></span>的所有属性的域都是原子的</p> <h2 id="数据存储结构"><a class="markdownIt-Anchor" href="#数据存储结构"></a> 数据存储结构</h2> <h3 id="文件组织"><a class="markdownIt-Anchor" href="#文件组织"></a> 文件组织</h3> <ul> <li>一个数据库被映射为多个不同的文件</li> <li>每个文件从逻辑上被分为定长的存储单元，称为<strong>块</strong></li> <li>块是存储分配和数据传输的单位</li> <li>假定： <ul> <li>没有比块更大的记录</li> <li>每条记录被完全包含在单个块中</li> </ul> </li> </ul> <h4 id="定长记录"><a class="markdownIt-Anchor" href="#定长记录"></a> 定长记录</h4> <ul> <li>在一个块中只分配它能完整容纳的最多记录的数目</li> <li>当一条记录被删除时，可以选择把紧跟其后的记录移动到被删记录先前占据的空间中，但这样需要额外的块访问</li> <li>在文件的开头分配特定数量的字节作为<strong>文件头</strong>，可以在文件头中存储内容被删除的第一条记录的地址作为链表的头结点，该链表通常被称为<strong>自由链表</strong> <ul> <li>在插入一条新纪录时，使用文件头所指向的记录，并改变文件头的指针以指向下一条可用记录</li> <li>如果没有可用的空间，就把新纪录加到文件末尾</li> </ul> </li> </ul> <h4 id="变长记录"><a class="markdownIt-Anchor" href="#变长记录"></a> 变长记录</h4> <ul> <li>具有变长属性的记录的表示通常包含两个部分： <ul> <li>带有定长信息的初始部分 <ul> <li>固定长度的属性被分配存储它们的值所需的字节数</li> <li>变长属性在初始部分中被表示为一个（偏移量，长度）对，其偏移量表示在记录中该属性的数据开始的位置，而长度表示变长属性的字节长度</li> </ul> </li> <li>变长属性的内容，连续存储</li> </ul> </li> <li>空位图表示记录的哪个属性是空值</li> </ul> <p><img src="https://d-sketon.top/img/db-book/13.png" alt="13"></p> <h5 id="分槽的页结构"><a class="markdownIt-Anchor" href="#分槽的页结构"></a> 分槽的页结构</h5> <p>每个块的开始处有一个块头，其包含以下信息：</p> <ul> <li>块头中记录项的数量</li> <li>块中自由空间的末尾处</li> <li>一个由包含每条记录的位置和大小的项组成的数组</li> </ul> <p>分配方式：</p> <ul> <li>记录从块的末尾处开始在块中连续分配空间</li> <li>块中的自由空间是连续的</li> <li>如果一条记录被删除，它所占用的空间被释放，并且它的项被置为deleted。此外，块中位于被删除记录之前的记录被移动，使得删除产生的自由空间能被重新使用</li> </ul> <p><img src="https://d-sketon.top/img/db-book/14.png" alt="14"></p> <h4 id="大对象存储"><a class="markdownIt-Anchor" href="#大对象存储"></a> 大对象存储</h4> <p>大对象可以以文件形式存储在被数据库管理的一个文件系统区域中，或者作为文件结构存储在数据库中并被数据库管理</p> <h3 id="文件中记录的组织"><a class="markdownIt-Anchor" href="#文件中记录的组织"></a> 文件中记录的组织</h3> <h4 id="堆文件组织"><a class="markdownIt-Anchor" href="#堆文件组织"></a> 堆文件组织</h4> <p>记录可存储在对应于一个关系的文件中的任何位置。记录一旦被放在特定位置，通常不会被移动</p> <h5 id="自由空间图"><a class="markdownIt-Anchor" href="#自由空间图"></a> 自由空间图</h5> <p>用于跟踪具有自由空间来存储记录的块</p> <ul> <li>通常被表示成一个数组，对关系的每个块，该数组都包含一个项</li> <li>每个项表示一个比例f，即在块中至少有比例f的空间是自由的</li> <li>为了加速定位具有自由空间的块的人物，可以创建<strong>二级自由空间图</strong></li> <li>二级自由空间图的项存储了主自由空间图中相应项的最大值</li> </ul> <h4 id="顺序文件组织"><a class="markdownIt-Anchor" href="#顺序文件组织"></a> 顺序文件组织</h4> <p>为了高效处理按某个搜索码（任意是属性或属性的集合，无需主键或超键）的顺序排序的记录而设计</p> <ul> <li>通过指针把记录链接起来，每条记录的指针指向按搜索码顺序排列的下一条记录</li> <li>按搜索码的顺序，或尽可能接近搜索码的顺序物理存储记录</li> <li>允许记录按排列的顺序读取</li> </ul> <p>插入操作：</p> <ul> <li>在文件中定位按搜索码的顺序位于待插入记录之前的那条记录</li> <li>如果在这条记录所在块中有一条自由的记录，就在这里插入新的记录。否则，将新纪录插入一个<strong>溢出块</strong>之中</li> <li>无论哪种情况都要调整指针，使其能按搜索码顺序吧记录链接在一起</li> <li>每隔一段时间后，文件应当被<strong>重组</strong>，使其再次在物理上按顺序存放</li> </ul> <h4 id="多表聚簇文件组织"><a class="markdownIt-Anchor" href="#多表聚簇文件组织"></a> 多表聚簇文件组织</h4> <p>多个不同关系的记录被存储在相同的文件之中，以便减少特定连接操作的代价</p> <ul> <li><strong>聚簇码</strong>定义了哪些记录被存储在一起</li> </ul> <h4 id="b树文件组织"><a class="markdownIt-Anchor" href="#b树文件组织"></a> B+树文件组织</h4> <p>和B+数索引结构有关，可以提供对记录的高效顺序访问、即使存在大量插入，删除或更新操作</p> <h4 id="哈希文件组织"><a class="markdownIt-Anchor" href="#哈希文件组织"></a> 哈希文件组织</h4> <p>在每条记录的某些属性上计算一个散列函数。函数的结果确定了记录存入文件的哪个块中</p> <h4 id="划分"><a class="markdownIt-Anchor" href="#划分"></a> 划分</h4> <p>许多数据库允许将一个关系中的记录划分为更小的关系，这些关系分别进行存储</p> <h3 id="数据字典存储"><a class="markdownIt-Anchor" href="#数据字典存储"></a> 数据字典存储</h3> <p>关系模式和关于关系的其他元数据存储在<strong>数据字典</strong>或<strong>系统目录</strong>中<br> 其中必须存储的信息类型有：</p> <ul> <li>关系的名称</li> <li>每个关系中属性的名称</li> <li>属性的域和长度</li> <li>在数据库上定义的视图的名称，以及视图的定义</li> <li>完整性约束</li> </ul> <p>可以为用户保存下列信息：</p> <ul> <li>用户的名称、缺省模式、密码或其他信息</li> <li>关于每个用户的授权信息</li> </ul> <p>可能记录关系的存储组织及每个关系的存储位置：</p> <ul> <li>若关系被存在操作系统文件之中，数据字典将会记录每个关系的单个文件（或多个文件）的名称</li> <li>若关系被存在单个文件中，数据字典可能将包含每个关系的记录的块记录在诸如链表那样的数据结构中</li> </ul> <p>存储每个关系的每个索引的信息：</p> <ul> <li>索引的名称</li> <li>被索引的关系的名称</li> <li>在器上定义索引的数学</li> <li>构造的索引的类型</li> </ul> <h3 id="数据库缓冲区"><a class="markdownIt-Anchor" href="#数据库缓冲区"></a> 数据库缓冲区</h3> <ul> <li><strong>缓冲区</strong>是主存中用于存储磁盘快递拷贝的那部分</li> <li>每个块总有一份拷贝存放在磁盘上，但是磁盘上的拷贝可能比缓冲区的版本旧</li> <li>负责缓冲区空间分配的子系统称为<strong>缓冲区管理器</strong></li> </ul> <h4 id="缓冲区管理器"><a class="markdownIt-Anchor" href="#缓冲区管理器"></a> 缓冲区管理器</h4> <p>缓冲区管理器和操作系统虚拟存储管理器类似</p> <h5 id="被钉住的块"><a class="markdownIt-Anchor" href="#被钉住的块"></a> 被钉住的块</h5> <ul> <li>在一个进程从缓冲块中读取数据之前，进程在该块上执行钉住操作</li> <li>缓冲区管理器不会溢出一个被钉住的块</li> </ul> <h5 id="缓冲区上的共享排它锁"><a class="markdownIt-Anchor" href="#缓冲区上的共享排它锁"></a> 缓冲区上的共享排它锁</h5> <p>数据库缓冲区管理器允许进程获取缓冲区上的共享排它锁<br> 封锁规则：</p> <ul> <li>任意数量的进程可以在一个块上同时拥有共享锁</li> <li>每次只允许一个进程获得排它锁，并且当一个进程拥有排他锁时，其他进程不能拥有此块上的共享锁。</li> <li>如果一个进程请求块上的排它锁，但此块已经以共享或者排他模式被封锁，那么在早期封锁被释放之前，该请求一直处于等待状态</li> <li>如果一个进程请求块上的共享锁，而且此块没有被封锁或者已经被共享锁封锁，则此锁可以被授予；但是，如果另一个进程持有该块的排它锁，则共享锁只有在排他锁被释放后才能授予</li> </ul> <p>获得释放封锁规则：</p> <ul> <li>在一个块上执行任何操作之前，进程必须钉住这个块。随后获得封锁，且必须在对块解除钉住之前释放封锁</li> <li>在从缓冲块读数据之前，进程必须获取此块上的共享锁。当完成数据读取时，进程必须释放此锁</li> <li>在更新缓存块内容之前，进程必须获得此块上的排它锁；该锁必须在更新完成后释放</li> </ul> <h4 id="缓冲区替换策略"><a class="markdownIt-Anchor" href="#缓冲区替换策略"></a> 缓冲区替换策略</h4> <p>绝大多数数据库都使用了LRU策略</p> <h2 id="索引-2"><a class="markdownIt-Anchor" href="#索引-2"></a> 索引</h2> <h3 id="顺序索引"><a class="markdownIt-Anchor" href="#顺序索引"></a> 顺序索引</h3> <p>顺序索引按照排好的顺序存储搜索码的值，并将每个搜索码与包含该搜索码的记录关联起来</p> <ul> <li><strong>聚集索引（主索引）</strong> <ul> <li>包含记录的文件按顺序排列</li> <li>搜索码定义了文件的排列次序</li> </ul> </li> <li><strong>非聚集索引（辅助索引）</strong> <ul> <li>搜索码指定的次序与文件的排列次序不同</li> </ul> </li> </ul> <h4 id="稠密索引"><a class="markdownIt-Anchor" href="#稠密索引"></a> 稠密索引</h4> <p>对于文件中的每个搜索码值都有一个索引项</p> <ul> <li><strong>稠密聚集索引</strong> <ul> <li>索引记录包括搜索码值以及指向具有该搜索码值的第一条数据记录的指针</li> <li>具有相同搜索码值的其余记录会顺序i存储在第一条记录之后</li> </ul> </li> <li><strong>稠密非聚集索引</strong> <ul> <li>索引必须存储指向具有相同搜索码值的所有记录的指针列表</li> </ul> </li> </ul> <h4 id="稀疏索引"><a class="markdownIt-Anchor" href="#稀疏索引"></a> 稀疏索引</h4> <p>只为某些搜索码值建立索引项</p> <ul> <li>只有当关系按搜索码排列次序存储时才能使用稀疏索引</li> <li>索引记录包括搜索码值以及指向具有该搜索码值的第一条数据记录的指针</li> </ul> <h4 id="多级索引"><a class="markdownIt-Anchor" href="#多级索引"></a> 多级索引</h4> <ul> <li>使用多级索引提升搜索效率</li> <li>在原始索引上构造一个稀疏的外层索引</li> </ul> <h4 id="索引更新"><a class="markdownIt-Anchor" href="#索引更新"></a> 索引更新</h4> <h5 id="插入"><a class="markdownIt-Anchor" href="#插入"></a> 插入</h5> <ul> <li>稠密索引 <ul> <li>如果搜索码值不在索引中，则在适当位置插入该搜索码值的索引</li> <li>如果索引项存储所有记录的指针，则在索引项中增加一条指向新记录的指针</li> <li>如果所有向存储第一条记录的指针，则将待插入的记录放到相同搜索码值的其他记录之后</li> </ul> </li> <li>稀疏索引 <ul> <li>如果插入的记录具有它所在块的最小搜索码值，则更新指向该块的索引</li> </ul> </li> </ul> <h5 id="删除"><a class="markdownIt-Anchor" href="#删除"></a> 删除</h5> <ul> <li>稠密索引 <ul> <li>如果待删除的记录是该特定搜索码值的唯一记录，则直接删除该索引项</li> <li>如果索引项存储所有记录的指针，则在索引项中删除一条指向新记录的指针</li> <li>如果所有向存储第一条记录的指针，且待删除记录是该搜索码值的第一条，则更新索引项，使其指向下一条记录</li> </ul> </li> <li>稀疏索引 <ul> <li>如果待删除的记录是该特定搜索码值的唯一记录，则系统用下一个搜索码值的索引记录代替；如果下一个搜索码值已经有了索引项，则删除该该索引项</li> <li>否则，如果该搜索码值的索引项指向待删除的记录，则更新索引项，使其指向具有相同搜索码值的下一条记录</li> </ul> </li> </ul> <h4 id="辅助索引"><a class="markdownIt-Anchor" href="#辅助索引"></a> 辅助索引</h4> <p>辅助索引必须是稠密的，对每个搜索码值都有一个索引项，并且对文件中的每条记录都有一个指针</p> <h3 id="b树索引"><a class="markdownIt-Anchor" href="#b树索引"></a> B+树索引</h3> <p>B+树索引采用平衡树结构</p> <ul> <li>从树根到树叶的每条路径的长度都是相同的</li> <li>树中每个非叶节点（除根节点）有⌈n/2⌉到n个孩子</li> <li>根节点有2到n个孩子</li> </ul> <h4 id="b树结构"><a class="markdownIt-Anchor" href="#b树结构"></a> B+树结构</h4> <ul> <li>典型的B+树节点最多包含n-1个搜索码值K1,K2,…Kn-1，以及n个指针P1,P2,…,Pn</li> <li>一个节点内的搜索码值是有序存放的</li> </ul> <h5 id="叶节点"><a class="markdownIt-Anchor" href="#叶节点"></a> 叶节点</h5> <ul> <li>对i=1,2,…,n-1，指针Pi指向具有搜索码值Ki的一条文件记录</li> <li>指针Pn指向下一个叶节点，用于高效的顺序处理</li> <li>每个叶节点最多有n-1个值，最少有⌈(n-1)/2⌉个值</li> <li>如果Li和Lj是叶节点且i&lt;j，则Li中的每个搜索码值vi均小于Lj中的每个搜索码值vj</li> <li>如果B+树索引比用作稠密索引，每个搜索码值都必须出现在某个叶节点中</li> </ul> <p><img src="https://d-sketon.top/img/db-book/15.png" alt="15"></p> <h4 id="b树的查询"><a class="markdownIt-Anchor" href="#b树的查询"></a> B+树的查询</h4> <p>B+树的查询：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function find(v)</span><br><span class="line">    C = 根节点</span><br><span class="line">    while (C不是叶节点) begin</span><br><span class="line">        令i = 满足 v &lt;=C.Ki的最小值</span><br><span class="line">        if 没有这样的i then begin</span><br><span class="line">            令Pm = 该节点中最后一个非空指针</span><br><span class="line">            置C=C.Pm</span><br><span class="line">        end</span><br><span class="line">        else if (v = C.Ki)  then 置C = C.Pi+1  </span><br><span class="line">        else 置C = C.Pi</span><br><span class="line">    end</span><br><span class="line">    if 有某个i,满足 Ki = v  </span><br><span class="line">        then return Pi</span><br><span class="line">    else </span><br><span class="line">        return null</span><br></pre></td></tr></table></figure> <h4 id="b树的插入"><a class="markdownIt-Anchor" href="#b树的插入"></a> B+树的插入</h4> <p>在B+树中插入项：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">procedure insert(value K, pointer P)</span><br><span class="line">    if (树为空) 创建一个空的叶节点L，同时它也是根节点</span><br><span class="line">    else 找到应该包含码值K的叶节点L</span><br><span class="line">    if (L 具有不到n-1个码值)</span><br><span class="line">        then insert_in_leaf (L, K, P)</span><br><span class="line">        else begin  /* 拆分L */</span><br><span class="line">        创建节点 L&#x27;</span><br><span class="line">        把 L.P1 … L.Kn-1 复制到可以容纳n个（指针，码值）对的内存块T中</span><br><span class="line">        insert_in_leaf (T, K, P)</span><br><span class="line">        令 L&#x27;.Pn = L.Pn</span><br><span class="line">        令 L.Pn = L&#x27;</span><br><span class="line">        从L中删除L.P1 到 L.Kn-1</span><br><span class="line">        把 T.P1 到 T.K⌈n∕2⌉ 从 T 复制到 L 中，L 以 L.P1 作为开始</span><br><span class="line">        把 T.P⌈n∕2⌉+1 到 T.Kn 从 T 复制到 L&#x27;中，L&#x27;以 L&#x27;.P1 作为开始</span><br><span class="line">        令 K&#x27;为 L&#x27;中的最小码值</span><br><span class="line">        insert_in_parent(L, K&#x27;, L&#x27;)</span><br><span class="line">    end</span><br></pre></td></tr></table></figure> <p>用于往B+树中插入项的辅助过程：</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">procedure insert_in_leaf (node L, value K, pointer P)</span><br><span class="line">    if (K &lt; L.K1) then 把P、K插入L中，紧接在L.P1前面</span><br><span class="line">    else begin</span><br><span class="line">            令 Ki 表示 L 中小于或等于 K 的最大值</span><br><span class="line">            把P、K插入L中，紧接在L.Ki前面</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">procedure insert_in_parent(node N, value K&#x27;, node N&#x27;)</span><br><span class="line">    if (N 是树的根结点)</span><br><span class="line">        then begin</span><br><span class="line">       创建一个新的，包含N、K&#x27;、N&#x27;的节点R</span><br><span class="line">       令R为树的根节点</span><br><span class="line">       return</span><br><span class="line">        end</span><br><span class="line">    令 P = parent (N)</span><br><span class="line">    if (P有不到n个指针) then 将 (K&#x27;, N&#x27;)插入 P 中，紧跟在 N 后面</span><br><span class="line">    else begin   /* 拆分 P */</span><br><span class="line">        将 P 复制到可以容纳 P 和 (K&#x27;, N&#x27;) 的内存块 T 中</span><br><span class="line">        将 (K&#x27;, N&#x27;) 插入 T 中，紧跟在 N 后面</span><br><span class="line">        删除 P 中所有项 </span><br><span class="line">        创建节点 P&#x27;</span><br><span class="line">        把 T.P1…T.P⌈(n+1)∕2⌉ 复制到 P</span><br><span class="line">        令 K&#x27;&#x27; = T.K⌈(n+1)∕2⌉</span><br><span class="line">        把 T.P⌈(n+1)∕2⌉+1…T.Pn+1 复制到 P&#x27;</span><br><span class="line">        Insert_in_parent(P, K&#x27;&#x27;, P&#x27;)</span><br><span class="line">    end</span><br></pre></td></tr></table></figure> <h4 id="b树的删除"><a class="markdownIt-Anchor" href="#b树的删除"></a> B+树的删除</h4> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">procedure delete(value K, pointer P)</span><br><span class="line">    找到包含(K, P)的叶节点 L</span><br><span class="line">    delete_entry(L, K, P)</span><br><span class="line">    </span><br><span class="line">procedure delete_entry(node N, value K, pointer P)</span><br><span class="line">    从 N 中删除 (K, P)</span><br><span class="line">    if (N 是根节点 and N 只剩下一个子节点)</span><br><span class="line">    then 使 N 的子节点成为该树的新的根节点并删除 N</span><br><span class="line">    else if (N 有太少的值/指针) then begin</span><br><span class="line">        令 N&#x27; 为 parent(N) 的前一个或后一个孩子节点</span><br><span class="line">        令 K&#x27; 为 parent(N) 中指针 N 和 N&#x27; 之间的值</span><br><span class="line">        if (N 和 N&#x27; 中的项能放入单个节点中)</span><br><span class="line">            then begin /*合并节点*/</span><br><span class="line">                if (N 是 N&#x27;的前一个节点) then swap_variables(N, N&#x27;)</span><br><span class="line">                if (N 不是叶节点)</span><br><span class="line">                    then 将 K&#x27;以及 N 中所有的指针和值附加到 N&#x27;中</span><br><span class="line">                    else 将 N 中所有 (Ki, Pi) 对附加到 N&#x27; 中</span><br><span class="line">                    令 N&#x27;.Pn = N.Pn</span><br><span class="line">                    delete_entry(parent(N), K&#x27;, N);删除节点 N</span><br><span class="line">                end</span><br><span class="line">        else begin/*重新分配，从 N&#x27; 借来一个项*/</span><br><span class="line">            if (N&#x27; 是 N 的前一个节点) then begin</span><br><span class="line">                if (N 是非叶节点) then begin</span><br><span class="line">                    令 m 满足：N&#x27;.Pm 是 N&#x27; 中的最后一个指针</span><br><span class="line">                    从 N&#x27; 中去除 (N&#x27;.Km-1, N&#x27;.Pm)</span><br><span class="line">                    插入 (N&#x27;.Pm, K&#x27;) 并通过将其它指针和值右移使之成为 N 中的第一个指针和值</span><br><span class="line">                    用 N&#x27;.Km-1 替换 parent(N) 中的 K&#x27;</span><br><span class="line">                end</span><br><span class="line">                else begin</span><br><span class="line">                    令 m 满足 (N&#x27;.Pm, N&#x27;.Km) 是 N&#x27; 中的最后一个指针/值对</span><br><span class="line">                    从 N&#x27; 中去除 (N&#x27;.Pm, N&#x27;.Km)</span><br><span class="line">                    插入 (N&#x27;.Pm, N&#x27;.Km) 并通过将其它指针和值右移使之成为 N 中的第一个指针和值</span><br><span class="line">                    用 N&#x27;.Km 替换 parent(N) 中的 K&#x27;</span><br><span class="line">                end</span><br><span class="line">            end</span><br><span class="line">            else ...与then的情况对称...</span><br><span class="line">        end</span><br><span class="line">    end</span><br></pre></td></tr></table></figure> <h4 id="非唯一性搜索码"><a class="markdownIt-Anchor" href="#非唯一性搜索码"></a> 非唯一性搜索码</h4> <ul> <li>每个码只在树中存储一次，并维护一个带有搜索码值的记录指针的桶，但会产生复杂问题</li> <li>每条记录存储一次搜索码的值，但也会产生复杂问题</li> <li>由于以上两个方法删除效率底下，所以大多数数据库系统中的B+树都只处理唯一性搜索码，并自动添加记录ID或其他属性以使非唯一性搜索码变得唯一</li> </ul> <h3 id="b树扩展"><a class="markdownIt-Anchor" href="#b树扩展"></a> B+树扩展</h3> <h4 id="b树文件组织-2"><a class="markdownIt-Anchor" href="#b树文件组织-2"></a> B+树文件组织</h4> <ul> <li>不仅把B+树结构作为索引来使用，而且把它作为一种文件中记录的组织方式来使用</li> <li>树的叶节点存储的是记录而不是指向记录的指针</li> <li>B+树文件组织可用于存储大型对象，可将大型对象拆分成更小的记录序列并组织成B+树文件组织的形式进行存储</li> </ul> <h4 id="辅助索引和记录重分配"><a class="markdownIt-Anchor" href="#辅助索引和记录重分配"></a> 辅助索引和记录重分配</h4> <ul> <li>如果记录的位置发生了改变，存储了指向被重新分配过的记录的指针的所有赋值索引都必须被更新</li> <li>B+树文件组织中节点拆分的代价及其高昂</li> <li>解决方法：在辅助索引中存储主索引搜索码属性的值</li> <li>该方法大大降低了由文件重组导致的索引更新的代价，但也增加了使用辅助索引访问数据的代价</li> </ul> <h4 id="对字符串的索引"><a class="markdownIt-Anchor" href="#对字符串的索引"></a> 对字符串的索引</h4> <ul> <li>可变字符串会导致不同的扇出</li> <li>节点的合并或者项的重新分配取决于节点中所使用空间的比例，而不是根据节点所能容纳的最大项数</li> <li>使用<strong>前缀压缩</strong>的技术可以增加节点的扇出 <ul> <li>在非叶节点上存储每个搜索码值的一个前缀</li> </ul> </li> </ul> <h4 id="b树文件索引"><a class="markdownIt-Anchor" href="#b树文件索引"></a> B树文件索引</h4> <ul> <li>B树只允许搜索码值出现一次（如果它们是唯一的）</li> <li>可以比相应的B+树索引使用更少的节点</li> <li>需要在非叶节点中为每个搜索码包含一个额外的指针域</li> </ul> <h3 id="散列索引"><a class="markdownIt-Anchor" href="#散列索引"></a> 散列索引</h3> <ul> <li><strong>桶</strong>：可以存储一条或多条记录的存储单元 <ul> <li>对于内存中的散列索引，桶可以是索引项或记录的链表</li> <li>对于基于磁盘的索引，桶可以是磁盘块的链表</li> <li>在散列文件组织中，桶存储实际的记录</li> </ul> </li> <li><strong>散列函数</strong>：从所有搜索码值的集合K到所有桶地址的集合B的函数 <ul> <li>使用<strong>溢出链</strong>的散列索引也称为<strong>闭寻址</strong></li> </ul> </li> </ul> <p>散列索引能高效地支持搜索码上的相等查询，但不支持范围查询</p> <h3 id="位图索引"><a class="markdownIt-Anchor" href="#位图索引"></a> 位图索引</h3> <ul> <li>为多码上的简单查询设计的一种特殊类型的索引</li> <li>r关系在A属性上的位图索引是由A能取的每个值所对应的位图构成</li> <li>每个位图都有和关系中的记录数相等数量的位</li> <li>如果编号为i的记录在A的属性为vj，则值为vj的位图中第i位为1，其他所有位为0</li> </ul> <h2 id="查询处理"><a class="markdownIt-Anchor" href="#查询处理"></a> 查询处理</h2> <p>查询处理的基本步骤：</p> <ul> <li>语法分析与翻译</li> <li>优化</li> <li>执行</li> </ul> <p>基本概念：</p> <ul> <li>带有“如何执行”注释的关系代数运算称为<strong>执行原语</strong></li> <li>用于执行一个查询的原语操作序列称为<strong>查询执行计划</strong></li> <li><strong>查询执行引擎</strong>接收一个查询执行计划，执行该计划并把结果返回给查询</li> </ul> <h3 id="查询代价的度量"><a class="markdownIt-Anchor" href="#查询代价的度量"></a> 查询代价的度量</h3> <ul> <li>对于驻留在磁盘上的大型数据库，从磁盘访问数据I/O代价通常是最主要的的代价</li> <li>当数据驻留在内存或SSD上时，I/O并不是主要代价，CPU代价也必须考虑</li> <li>我们使用从存储中<strong>传输的块数</strong>以及<strong>随机I/O访问数</strong>作为估计查询执行计划的代价的两个重要因素</li> </ul> <h3 id="选择运算"><a class="markdownIt-Anchor" href="#选择运算"></a> 选择运算</h3> <table> <thead> <tr> <th></th> <th>算法</th> <th>代价</th> <th>原因</th> </tr> </thead> <tbody> <tr> <td>A1</td> <td>线性搜索</td> <td>ts+br*tT</td> <td>一次初始搜索加上br次块传输，其中br表示文件中的块数量</td> </tr> <tr> <td>A1</td> <td>线性搜索，码上的等值比较</td> <td>平均情况ts+(br/2)*tT</td> <td>因为最多有一条记录满足条件，所以一旦找到所需的记录，扫描就可以终止</td> </tr> <tr> <td>A2</td> <td>B+树聚集索引，码上的等值比较</td> <td>(hi+1)*(tT+ts)</td> <td>（hi表示索引的高度）索引搜索遍历树的高度，再加上一次I/O来获取记录；每个这样的I/O操作需要一次寻道和一次块传输</td> </tr> <tr> <td>A3</td> <td>B+树聚集索引，非码上的等值比较</td> <td>hi*(tT+ts)+ts+b*tT</td> <td>树的每一层有一次寻道，第一个块有一次寻道。这里b是包含具有指定搜索码记录的块数，所有这些记录都是要读取的。假定这些块是顺序存储（因为是聚集索引）的叶子块并且不需要额外的寻道</td> </tr> <tr> <td>A4</td> <td>B+树辅助索引，码上的等值比较</td> <td>(hi+1)*(tT+ts)</td> <td>和聚集索引类似</td> </tr> <tr> <td>A4</td> <td>B+树辅助索引，非码上的等值比较</td> <td>(hi+n)*(ts+tT)</td> <td>（其中n是所获取记录的数量）在这里，索引遍历的代价和A3一样，但是每条记录存储在不同的块上，需要对每条记录进行一次寻道。如果n值比较大，代价可能非常昂贵</td> </tr> <tr> <td>A5</td> <td>B+树聚集索引，比较</td> <td>hi*(tT+ts)+ts+b*tT</td> <td>和A3、非码上的等值比较的情况一样</td> </tr> <tr> <td>A6</td> <td>B+树辅助索引，比较</td> <td>(hi+n)*(ts+tT)</td> <td>和A4、非码上的等值比较的情况一样</td> </tr> </tbody> </table> <ul> <li>A7（使用一个索引的合取选择） <ul> <li>用A2-A6的一种算法检索满足其中一个简单条件的记录。然后在内存缓冲区中测试是否满足其余简单条件</li> </ul> </li> <li>A8（使用组合索引的合取选择） <ul> <li>如果选择指定的是两个或多个属性上的等值条件，并且在这些属性字段的组合上存在组合索引，则可以直接搜索该索引</li> </ul> </li> <li>A9（使用标识交集的合取选择） <ul> <li>要求在各个条件所涉及的字段上都有带记录指针的索引</li> <li>对每个索引进行扫描，以获取那些指向满足单个条件的元组的指针</li> <li>所有检索到的指针的交集就是满足合取条件的元组的指针集合</li> </ul> </li> <li>A10（使用标识并集的析取选择） <ul> <li>扫描每个索引以获取满足单个条件的元组的指针</li> <li>检索到的所有指针的并集就产生出指向满足析取条件的所有元组的指针的集合</li> </ul> </li> </ul> <h3 id="排序"><a class="markdownIt-Anchor" href="#排序"></a> 排序</h3> <p>特指在物理上对记录进行排序</p> <h4 id="外排序-归并算法"><a class="markdownIt-Anchor" href="#外排序-归并算法"></a> 外排序-归并算法</h4> <ul> <li>对不能全部放入内存中的关系进行的排序称为<strong>外排序</strong></li> <li>对于外排序最常用的技术是<strong>外排序-归并</strong>算法</li> <li>第一阶段，创建多个排好序的归并段</li> </ul> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = 0;</span><br><span class="line">repeat</span><br><span class="line">    读入关系的M个块或者关系的剩余部分，以较小者为准</span><br><span class="line">    对关系在内存中的部分进行排序</span><br><span class="line">    将排好序的数据写到归并段文件Ri中</span><br><span class="line">    i= i+1</span><br><span class="line">until 到达关系末尾</span><br></pre></td></tr></table></figure> <ul> <li>第二阶段，对归并段进行归并</li> </ul> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">为N个归并段文件Ri各读入一个块到内存缓冲块中</span><br><span class="line">repeat</span><br><span class="line">    从所有缓冲块中（按序）挑选第一个元组</span><br><span class="line">    把该院足协倒数初中，并将其从缓冲块中删除</span><br><span class="line">    if 任何一个归并段Ri的缓冲块为空 and not 到达 Ri 的末尾</span><br><span class="line">        then 将 Ri 的下一块读入缓冲块</span><br><span class="line">until 所有的输入缓冲块均为空</span><br></pre></td></tr></table></figure> <h4 id="外排序-归并的代价计算"><a class="markdownIt-Anchor" href="#外排序-归并的代价计算"></a> 外排序-归并的代价计算</h4> <p>总共需要的归并趟数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌈</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mrow><mo stretchy="false">⌊</mo><mi>M</mi><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌋</mo><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo stretchy="false">⌉</mo></mrow><annotation encoding="application/x-tex">\lceil log_{\lfloor M/b_b\rfloor-1}(b_r / M) \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mopen">⌈</span><span class="mathnormal mord" style="margin-right:.01968em">l</span><span class="mathnormal mord">o</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mopen mtight">⌊</span><span class="mathnormal mord mtight" style="margin-right:.10903em">M</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mathnormal mord mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span><span class="mclose mtight">⌋</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">)⌉</span></span></span></span><br> 关系外排序的块传输的总数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>r</mi></msub><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">⌈</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mrow><mo stretchy="false">⌊</mo><mi>M</mi><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌋</mo><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo stretchy="false">⌉</mo><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b_r (2 \lceil log_{\lfloor M/b_b\rfloor-1}(b_r / M) \rceil + 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">2</span><span class="mopen">⌈</span><span class="mathnormal mord" style="margin-right:.01968em">l</span><span class="mathnormal mord">o</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mopen mtight">⌊</span><span class="mathnormal mord mtight" style="margin-right:.10903em">M</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mathnormal mord mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span><span class="mclose mtight">⌋</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">)⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><br> 寻道磁盘的代价为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">⌉</mo><mo>+</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">⌈</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mrow><mo stretchy="false">⌊</mo><mi>M</mi><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌋</mo><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo stretchy="false">⌉</mo><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">2\lceil b_r / M \rceil + \lceil b_r / b_b \rceil (2 \lceil log_{\lfloor M/b_b\rfloor-1}(b_r / M) \rceil - 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉</span><span class="mopen">(</span><span class="mord">2</span><span class="mopen">⌈</span><span class="mathnormal mord" style="margin-right:.01968em">l</span><span class="mathnormal mord">o</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mopen mtight">⌊</span><span class="mathnormal mord mtight" style="margin-right:.10903em">M</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mathnormal mord mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span><span class="mclose mtight">⌋</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">)⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p> <h3 id="连接运算"><a class="markdownIt-Anchor" href="#连接运算"></a> 连接运算</h3> <h4 id="嵌套-循环连接"><a class="markdownIt-Anchor" href="#嵌套-循环连接"></a> 嵌套-循环连接</h4> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for each 元组 tr in r do begin</span><br><span class="line">    for each 元组 ts in s do begin</span><br><span class="line">        测试元组对(tr, ts) 是否满足连接条件</span><br><span class="line">        如果满足，把tr·ts加到结果中</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure> <ul> <li>嵌套-循环连接算法的代价昂贵</li> <li>如果其中一个关系能完全放入主存中，则应该把这个关系作为内层关系</li> </ul> <h4 id="块嵌套-循环连接"><a class="markdownIt-Anchor" href="#块嵌套-循环连接"></a> 块嵌套-循环连接</h4> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for each 块Br of r do begin</span><br><span class="line">    for each 块Bs of s do begin</span><br><span class="line">        for each 元组 tr in Br do begin</span><br><span class="line">            for each 元组 ts in Bs do begin</span><br><span class="line">                测试元组对(tr, ts) 是否满足连接条件</span><br><span class="line">                如果满足，把tr·ts加到结果中</span><br><span class="line">            end</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure> <ul> <li>在最坏的情况下，对于外层关系中的每个块，内层关系s的每个块只需读一次</li> </ul> <h4 id="索引嵌套-循环连接"><a class="markdownIt-Anchor" href="#索引嵌套-循环连接"></a> 索引嵌套-循环连接</h4> <ul> <li>若在内层循环的连接属性上有索引可用，则可以用索引查找来代替文件扫描</li> <li>代价公式表明：如果两个关系上均有索引可用，通常使用元组较少的关系作为外层关系最为高效</li> </ul> <h4 id="归并-连接"><a class="markdownIt-Anchor" href="#归并-连接"></a> 归并-连接</h4> <ul> <li>用于计算自然连接和等值连接</li> <li>两个关系必须均按公共属性排序</li> <li>排序后连接通过与排序-归并算法中的归并阶段非常相似的处理过程来计算</li> </ul> <h5 id="代价分析"><a class="markdownIt-Anchor" href="#代价分析"></a> 代价分析</h5> <ul> <li>所需的块传输次数等于两个文件的块数之和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>r</mi></msub><mo>+</mo><msub><mi>b</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">b_r+b_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>（假设所有Ss集合均可装入内存）</li> <li>假设每个关系分配<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">b_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>个缓冲块，则所需的磁盘寻道次数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo>+</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>s</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo></mrow><annotation encoding="application/x-tex">\lceil b_r / b_b \rceil + \lceil b_s / b_b \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉</span></span></span></span></li> </ul> <h4 id="混合归并-连接"><a class="markdownIt-Anchor" href="#混合归并-连接"></a> 混合归并-连接</h4> <ul> <li>把已排序关系与B+树辅助索引的叶子项进行归并</li> <li>所得到的结果文件包含已排序关系的元组和未排序关系的元组地址</li> <li>将结果文件按未排序关系的元组地址进行排序，从而能对相关元组按物理存储顺序进行高效的检索</li> </ul> <h4 id="散列-连接"><a class="markdownIt-Anchor" href="#散列-连接"></a> 散列-连接</h4> <ul> <li>用于计算自然连接和等值连接</li> <li>相比于归并-连接算法，将排序改为了使用散列函数 <ul> <li>使用散列函数，获得两个关系对应的散列分区</li> <li>在其中一个分区上构造内存散列索引，并使用索引嵌套-循环连接定位出所有需要连接的元组</li> <li>进行连接</li> </ul> </li> </ul> <h5 id="代价分析-2"><a class="markdownIt-Anchor" href="#代价分析-2"></a> 代价分析</h5> <ul> <li>不考虑递归分区 <ul> <li>所需块传输次数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo stretchy="false">(</mo><msub><mi>b</mi><mi>r</mi></msub><mo>+</mo><msub><mi>b</mi><mi>s</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mn>4</mn><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">3(b_r+b_s)+4n_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">3</span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.7944em;vertical-align:-.15em"></span><span class="mord">4</span><span class="mord"><span class="mathnormal mord">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>，通常<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">4n_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7944em;vertical-align:-.15em"></span><span class="mord">4</span><span class="mord"><span class="mathnormal mord">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>可以被忽略</li> <li>所需的磁盘寻道次数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo stretchy="false">(</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo>+</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>s</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">2(\lceil b_r / b_b \rceil + \lceil b_s / b_b \rceil)+2n_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mopen">(⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.7944em;vertical-align:-.15em"></span><span class="mord">2</span><span class="mord"><span class="mathnormal mord">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>次寻道</li> </ul> </li> <li>考虑递归分区 <ul> <li>所需块传输次数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo stretchy="false">(</mo><msub><mi>b</mi><mi>r</mi></msub><mo>+</mo><msub><mi>b</mi><mi>s</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">⌈</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mrow><mo stretchy="false">⌊</mo><mi>M</mi><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌋</mo><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>b</mi><mi>s</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo stretchy="false">⌉</mo><mo>+</mo><msub><mi>b</mi><mi>r</mi></msub><mo>+</mo><msub><mi>b</mi><mi>s</mi></msub></mrow><annotation encoding="application/x-tex">2(b_r+b_s)\lceil log_{\lfloor M/b_b \rfloor -1}(b_s /M) \rceil +b_r + b_s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">⌈</span><span class="mathnormal mord" style="margin-right:.01968em">l</span><span class="mathnormal mord">o</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mopen mtight">⌊</span><span class="mathnormal mord mtight" style="margin-right:.10903em">M</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mathnormal mord mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span><span class="mclose mtight">⌋</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">)⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8444em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></li> <li>所需的磁盘寻道次数为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo stretchy="false">(</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>r</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo>+</mo><mo stretchy="false">⌈</mo><msub><mi>b</mi><mi>s</mi></msub><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌉</mo><mo stretchy="false">)</mo><mo stretchy="false">⌈</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mrow><mo stretchy="false">⌊</mo><mi>M</mi><mi mathvariant="normal">/</mi><msub><mi>b</mi><mi>b</mi></msub><mo stretchy="false">⌋</mo><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>b</mi><mi>s</mi></msub><mi mathvariant="normal">/</mi><mi>M</mi><mo stretchy="false">)</mo><mo stretchy="false">⌉</mo></mrow><annotation encoding="application/x-tex">2(\lceil b_r / b_b \rceil + \lceil b_s / b_b \rceil) \lceil log_{\lfloor M/b_b \rfloor -1}(b_s /M) \rceil</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">2</span><span class="mopen">(⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.02778em">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mopen">⌈</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">⌉)</span><span class="mopen">⌈</span><span class="mathnormal mord" style="margin-right:.01968em">l</span><span class="mathnormal mord">o</span><span class="mord"><span class="mathnormal mord" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mopen mtight">⌊</span><span class="mathnormal mord mtight" style="margin-right:.10903em">M</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mathnormal mord mtight">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="mtight reset-size3 size1 sizing"><span class="mathnormal mord mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span><span class="mclose mtight">⌋</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mathnormal mord">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mathnormal mord" style="margin-right:.10903em">M</span><span class="mclose">)⌉</span></span></span></span>次寻道</li> </ul> </li> </ul> <h3 id="其他运算"><a class="markdownIt-Anchor" href="#其他运算"></a> 其他运算</h3> <h4 id="去重"><a class="markdownIt-Anchor" href="#去重"></a> 去重</h4> <p>可以通过排序和散列来实现去重</p> <h4 id="投影"><a class="markdownIt-Anchor" href="#投影"></a> 投影</h4> <p>首先对每个元组执行投影，然后去除重复记录</p> <h4 id="集合运算-3"><a class="markdownIt-Anchor" href="#集合运算-3"></a> 集合运算</h4> <ul> <li>首先对两个关系进行排序，然后对每个已排序的关系扫描一次以产生结果</li> <li>也可以选择使用散列，然后对每个分区扫描一次以产生结果</li> </ul> <h4 id="外连接"><a class="markdownIt-Anchor" href="#外连接"></a> 外连接</h4> <ul> <li> <ol> <li>计算相应的连接，然后将适当的元组加入连接结果中以得到外连接结果</li> </ol> </li> <li> <ol start="2"> <li>对连接算法加以修改</li> </ol> </li> </ul> <h4 id="聚集"><a class="markdownIt-Anchor" href="#聚集"></a> 聚集</h4> <p>使用与去重相同的方法来实现</p> <h3 id="表达式执行"><a class="markdownIt-Anchor" href="#表达式执行"></a> 表达式执行</h3> <h4 id="物化"><a class="markdownIt-Anchor" href="#物化"></a> 物化</h4> <ul> <li>每次将执行的结果物化到一个临时关系中</li> <li><strong>双缓冲</strong>通过并行执行CPU活动与I/O活动，允许算法执行得更快</li> </ul> <h4 id="流水线"><a class="markdownIt-Anchor" href="#流水线"></a> 流水线</h4> <p>通过将多个关系运算组成一个运算的流水线来减少临时文件数，其中一个运算的结果将传送到流水线中的下一个运算<br> 流水线带来的好处：</p> <ul> <li>消除了读和写临时关系的代价，从而减少了查询执行代价</li> <li>如果一个查询执行计划的根算子及其输入被合并在流水线中，那么就可以迅速开始产生查询结果</li> </ul> <h5 id="流水线的实现"><a class="markdownIt-Anchor" href="#流水线的实现"></a> 流水线的实现</h5> <ul> <li>需求驱动流水线 <ul> <li>系统不停地向位于流水线顶端的运算发出需要元组的请求</li> <li>每当一个运算收到需要元组的请求时，它就计算待返回的下一个元组并返回这些元组</li> <li>需求驱动流水线中的每个运算都可以作为迭代算子来实现，该迭代算子提供以下函数 <ul> <li>open()</li> <li>next()：每次调用返回运算的下一个输出元组</li> <li>close()：告知迭代算子不需要元组了</li> </ul> </li> </ul> </li> <li>生产者驱动流水线 <ul> <li>各运算并不等待产生元组的请求，而是积极地生产元组</li> <li>对于生产者驱动流水线中的每一对相邻的运算，系统会创建一个缓冲区来保存从一个运算传递给下一个运算的元组</li> </ul> </li> </ul> <h2 id="事务-2"><a class="markdownIt-Anchor" href="#事务-2"></a> 事务</h2> <p>事务是访问并可能更新各种数据项的一个程序执行单元<br> 数据库系统需要维护以下特性：</p> <ul> <li>原子性：事务的所有操作在数据库中要么全部正确反映出来，要么完全不反映</li> <li>一致性：以隔离的方式执行事务（没有其他事务的并发执行）以保持数据库的一致性</li> <li>隔离性：尽管多个事务可能并发执行，但系统保证每个事务都感觉不到系统中有其他事务正在并发执行</li> <li>持久性：在一个事务成功完成后，它对数据库的改变必须是永久的，即使出现系统故障</li> </ul> <h3 id="一个简单的事务模型"><a class="markdownIt-Anchor" href="#一个简单的事务模型"></a> 一个简单的事务模型</h3> <p>忽略插入和删除操作，采用以下两种操作来访问数据：</p> <ul> <li>read(X)：从数据库把数据项X传送给一个也称为X的变量，X位于属于执行read操作的事务的主缓冲区中</li> <li>write(X)：从执行write的事务的主缓冲区中把变量X的值传送给数据库中的数据项X</li> </ul> <h3 id="事务的原子性和持久性"><a class="markdownIt-Anchor" href="#事务的原子性和持久性"></a> 事务的原子性和持久性</h3> <p>事务必须处于以下状态之一：</p> <ul> <li><strong>活跃</strong>状态：为初始状态，当事务执行时就处于这种状态</li> <li><strong>部分提交</strong>状态：在最后一条语句被执行之后</li> <li><strong>失效</strong>状态：在发现正常执行不能再继续之后</li> <li><strong>中止</strong>状态：在事务已回滚并且数据库已被恢复到它在事务开始前的状态之后</li> <li><strong>提交</strong>状态：在成功完成之后</li> </ul> <p>事务相应的状态图：<br> <img src="https://d-sketon.top/img/db-book/16.png" alt="16"></p> <ul> <li>成功完成其执行的事务被称为<strong>已提交</strong></li> <li>一旦事务已经提交，撤销已提交事务所造成的影响的唯一方式是执行一个<strong>补偿事务</strong></li> <li>如果一个事务要么是提交的要么是中止的，它就被称为是已经<strong>终止</strong>的</li> <li>一旦事务进入了中止状态，系统可以<strong>重启</strong>事务或<strong>杀死</strong>事务</li> </ul> <h3 id="事务的隔离性"><a class="markdownIt-Anchor" href="#事务的隔离性"></a> 事务的隔离性</h3> <p>允许并发的优点：</p> <ul> <li>提高吞吐量和资源利用率</li> <li>减少等待时间</li> </ul> <p>在并发执行的情况下，调度应该在某种意义上等价于一个串行调度，这种调度被称为<strong>可串行化</strong>的调度</p> <h3 id="可串行化"><a class="markdownIt-Anchor" href="#可串行化"></a> 可串行化</h3> <ul> <li>如果I与J是由不同事务在相同数据项上执行的操作，并且其中至少有一条指令是write操作，那么I与J是<strong>冲突</strong>的</li> <li>如果调度S可以经过一系列非冲突指令的交换而转换成调度S’，则称S’和S是<strong>冲突等价</strong>的</li> <li>若一个调度S与一个串行调度是冲突等价的，则称调度S是<strong>冲突可串行化</strong>的</li> <li>如果关于S的优先图中<strong>有环</strong>，则调度S是非冲突可串行化的；反之则是可冲突串行化的</li> </ul> <h3 id="事务的隔离性和原子性"><a class="markdownIt-Anchor" href="#事务的隔离性和原子性"></a> 事务的隔离性和原子性</h3> <h4 id="可恢复调度"><a class="markdownIt-Anchor" href="#可恢复调度"></a> 可恢复调度</h4> <p>对于每对事务Ti和Tj，如果Tj读取了由Ti之前所写过的数据项，则Ti的提交操作应出现在Tj的提交操作之前</p> <h4 id="无级联调度"><a class="markdownIt-Anchor" href="#无级联调度"></a> 无级联调度</h4> <ul> <li><strong>级联回滚</strong> <ul> <li>因单个事务失效而导致一系列事务回滚的现象称为</li> </ul> </li> <li><strong>无级联调度</strong> <ul> <li>对于每对事务Ti和Tj都满足如果Tj读取了先前由Ti所写的一个数据项，则Ti的提交操作必须出现在Tj的这一读操作之前</li> </ul> </li> </ul> <h3 id="事务的隔离性级别"><a class="markdownIt-Anchor" href="#事务的隔离性级别"></a> 事务的隔离性级别</h3> <ul> <li><strong>可串行化</strong>：通常保证可串行化的执行</li> <li><strong>可重复读</strong>：只允许读取已提交的数据，并进一步要求在一个事务两次读取一个数据项期间，其他事务不得更新该数据项</li> <li><strong>已提交读</strong>：只允许读取已提交的数据，但并不要求可重复读</li> <li><strong>未提交读</strong>：允许读取未提交数据，最低隔离性级别</li> </ul> <p>以上所有的隔离性级别均不允许<strong>脏写</strong>，即如果一个数据项已被另外尚未提交或中止的事务写过，则不允许再执行写操作</p> <h2 id="并发控制"><a class="markdownIt-Anchor" href="#并发控制"></a> 并发控制</h2> <h3 id="基于锁的协议"><a class="markdownIt-Anchor" href="#基于锁的协议"></a> 基于锁的协议</h3> <h4 id="锁"><a class="markdownIt-Anchor" href="#锁"></a> 锁</h4> <ul> <li>共享模式锁（S）：可以读但不能写</li> <li>排他模式锁（X）：既可以读又能写</li> </ul> <p>相容函数：</p> <table> <thead> <tr> <th></th> <th>S</th> <th>X</th> </tr> </thead> <tbody> <tr> <td>S</td> <td>true</td> <td>false</td> </tr> <tr> <td>X</td> <td>false</td> <td>false</td> </tr> </tbody> </table> <ul> <li>事务通过lock-S(Q)指令来申请数据项Q上的共享锁</li> <li>事务通过lock-X(Q)指令来申请数据项Q上的排它锁</li> <li>事务通过unlock(Q)指令来对数据项Q解锁</li> </ul> <h4 id="两阶段封锁协议"><a class="markdownIt-Anchor" href="#两阶段封锁协议"></a> 两阶段封锁协议</h4> <p>该协议要求每个事务分两个阶段提出加锁和解锁请求：</p> <ul> <li><strong>增长阶段</strong>：一个事务可以获得锁，但不能释放任何锁</li> <li><strong>缩减阶段</strong>：一个事务可以释放锁，但不能获得任何新锁</li> </ul> <p>两阶段封锁并不保证不会发生死锁，且级联回滚是可能发生的</p> <ul> <li><strong>严格两阶段封锁协议</strong>：要求事务所持有的所有排他模式锁必须在事务提交后方可释放（可防止级联回滚）</li> <li><strong>强两阶段封锁协议</strong>：要求在事务提交之前保留所有的项</li> <li><strong>锁转换</strong> <ul> <li>升级：从共享锁到排它锁</li> <li>降级：从排它锁到共享锁</li> </ul> </li> </ul> <h4 id="封锁的实现"><a class="markdownIt-Anchor" href="#封锁的实现"></a> 封锁的实现</h4> <ul> <li><strong>锁管理器</strong>维护一个称为<strong>锁表</strong>的内存数据结构，用于记录已授予的锁和等待的请求 <ul> <li>事务可以向锁管理器发出锁请求和解锁的请求</li> <li>锁管理器针对封锁请求消息采用锁授予的消息，或采用要求事务回滚的消息来进行应答</li> </ul> </li> </ul> <h5 id="基于图的协议"><a class="markdownIt-Anchor" href="#基于图的协议"></a> 基于图的协议</h5> <ul> <li>两阶段封锁的替代方案</li> <li>在数据项的集合上实施一种偏序<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.3669em"></span><span class="mrel">→</span></span></span></span></li> <li>树型协议是一种简单的图协议 <ul> <li>确保冲突可串行化以及无死锁</li> <li>可以在较早的时候释放锁</li> <li>不保证可恢复性和无级联性 <ul> <li>需要引入提交依赖</li> </ul> </li> <li>一个事务可能必须给它更新不访问的数据项加锁</li> </ul> </li> </ul> <h3 id="死锁处理"><a class="markdownIt-Anchor" href="#死锁处理"></a> 死锁处理</h3> <h4 id="死锁预防"><a class="markdownIt-Anchor" href="#死锁预防"></a> 死锁预防</h4> <ul> <li>#1.每个事务在开始执行之前封锁它的所有数据项</li> <li>#2.对所有数据项施加一种次序，同时要求事务只能按照次序规定的顺序封锁数据项</li> <li>#3.使用抢占与事务回滚 <ul> <li>等待-死亡机制：非抢占技术，当Ti申请的数据项被Tj持有，仅当Ti时间戳小于Tj的时间戳，才允许Ti等待</li> <li>伤害-等待机制：抢占技术，当Ti申请的数据项被Tj持有，仅当Ti时间戳大于Tj的时间戳，才允许Ti等待</li> </ul> </li> <li>#4.基于锁超时，申请锁的事务至多等待一段指定时间，否则超时并回滚</li> </ul> <h4 id="死锁检测"><a class="markdownIt-Anchor" href="#死锁检测"></a> 死锁检测</h4> <p>使用一种称为<strong>等待图</strong>的有向图来描述</p> <ul> <li>顶点集由系统中的所有事务组成</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub><mo>→</mo><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">T_i \rightarrow T_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.9694em;vertical-align:-.2861em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span></span></span></span>的有向边表示事务<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>正等待事务<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">T_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.9694em;vertical-align:-.2861em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight" style="margin-right:.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span></span></span></span>释放一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">T_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mathnormal mord" style="margin-right:.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="mtight reset-size6 size3 sizing"><span class="mathnormal mord mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>所需的数据项</li> <li>当且仅当等待图中包含环路时，系统中存在死锁</li> </ul> <h4 id="死锁恢复"><a class="markdownIt-Anchor" href="#死锁恢复"></a> 死锁恢复</h4> <p>解除死锁最常用的方法是回滚一个或多个事务</p> <ul> <li>选择牺牲者 <ul> <li>回滚产生最低代价的事务</li> </ul> </li> <li>回滚 <ul> <li>完全回滚：中止事务并重新启动</li> <li>部分回滚：将事务回滚到可以接触死锁的地方</li> </ul> </li> <li>饿死 <ul> <li>必须保证一个事务被选为牺牲者的次数有限</li> </ul> </li> </ul> <h3 id="多粒度"><a class="markdownIt-Anchor" href="#多粒度"></a> 多粒度</h3> <ul> <li>如果一个节点加上了意向模式锁，则意味着在树的较低层进行显式加锁</li> <li>在一个节点被显式加锁之前，该节点的全部祖先节点均要加上意向锁</li> <li>封锁按自顶向下的次序，而锁的释放按自底向上的次序</li> </ul> <table> <thead> <tr> <th></th> <th>IS</th> <th>IX</th> <th>S</th> <th>SIX</th> <th>X</th> </tr> </thead> <tbody> <tr> <td>IS</td> <td>true</td> <td>true</td> <td>true</td> <td>true</td> <td>false</td> </tr> <tr> <td>IX</td> <td>true</td> <td>true</td> <td>false</td> <td>false</td> <td>false</td> </tr> <tr> <td>S</td> <td>true</td> <td>false</td> <td>true</td> <td>false</td> <td>false</td> </tr> <tr> <td>SIX</td> <td>true</td> <td>false</td> <td>false</td> <td>false</td> <td>false</td> </tr> <tr> <td>X</td> <td>false</td> <td>false</td> <td>false</td> <td>false</td> <td>false</td> </tr> </tbody> </table> <ul> <li>如果一个节点被加上了意向共享模式锁（IS），那么只能在树的较低层显式加共享模式锁</li> <li>如果一个节点被加上了意向排他模式锁（IX），那么只能在树的较低层显式加共享或排他模式锁</li> <li>如果一个节点被加上了共享意向排他模式锁（SIX），则以该节点为更的子树以共享模式被显式封锁，并且在树的更低层显式加排他模式锁</li> </ul> <h3 id="基于时间戳的协议"><a class="markdownIt-Anchor" href="#基于时间戳的协议"></a> 基于时间戳的协议</h3> <h4 id="时间戳"><a class="markdownIt-Anchor" href="#时间戳"></a> 时间戳</h4> <ul> <li>对系统中的每个事务，使用一个唯一的、固定的时间戳和它关联起来</li> <li>时间戳在事务开始执行之前由数据库系统所赋予，其决定了可串行化的次序 <ul> <li>系统时钟</li> <li>逻辑计数器</li> </ul> </li> </ul> <h4 id="时间戳排序协议"><a class="markdownIt-Anchor" href="#时间戳排序协议"></a> 时间戳排序协议</h4> <p>其保证任何有冲突的read和write操作按时间戳的次序执行</p> <blockquote> <p>每个数据项Q与两个时间戳相关联<br> W-timestamp(Q)表示成功执行write(Q)的任意事务的最大时间戳<br> R-timestamp(Q)表示成功执行read(Q)的任意事务的最大时间戳</p> </blockquote> <ul> <li> <p>假设事务T发出read(Q)</p> <ul> <li>若TS(T) &lt; W-timestamp(Q)，则T需要读取的Q值已被覆盖。T回滚</li> <li>若TS(T) &gt;= W-timestamp(Q)，则执行read操作，且R-timestamp(Q)=max(R-timestamp(Q),TS(T))</li> </ul> </li> <li> <p>假设事务T发出write(Q)</p> <ul> <li>若TS(T) &lt; R-timestamp(Q)，则T产生的Q值是先前所需要的，且假定该值永远不会产生了。T回滚</li> <li>若TS(T) &lt; W-timestamp(Q)，则T试图写入的Q值是过时的。T回滚</li> <li>其他情况，执行write操作，且W-timestamp(Q)=TS(T)</li> </ul> </li> <li> <p>事务如果触发了回滚，系统会赋予它一个新的时间戳并重新启动它</p> </li> <li> <p>该协议保证冲突可串行化和无死锁</p> </li> <li> <p>可能存在长事务饿死的现象</p> </li> <li> <p>可能产生不可恢复的调度</p> <ul> <li>通过在事务末尾一起执行所有写操作可以保证可恢复性和无级联性</li> </ul> </li> </ul> <h4 id="thomas写规则"><a class="markdownIt-Anchor" href="#thomas写规则"></a> Thomas写规则</h4> <ul> <li>假设事务T发出write(Q) <ul> <li>若TS(T) &lt; R-timestamp(Q)，则T产生的Q值是先前所需要的，且假定该值永远不会产生了。T回滚</li> <li>若TS(T) &lt; W-timestamp(Q)，则T试图写入的Q值是过时的。<strong>write操作被忽略</strong></li> <li>其他情况，执行write操作，且W-timestamp(Q)=TS(T)</li> </ul> </li> </ul> <h3 id="基于有效性检查的协议"><a class="markdownIt-Anchor" href="#基于有效性检查的协议"></a> 基于有效性检查的协议</h3> <p>有效性检查协议要求每个事务在生命周期中按两个或三个不同的阶段执行</p> <ul> <li>读阶段：系统执行事务T，T的所有write操作是对局部的临时变量进行的，但并不对数据库进行真正的更新</li> <li>有效性检查阶段：对事物T进行有效性检查的测试，如果测试失败则终止该事务</li> <li>写阶段：如果通过了有效性检查，则保存T所执行的任何write操作结果的临时局部变量被拷贝入数据库</li> </ul> <blockquote> <p>StartTS(Ti)：事务Ti开始执行的时间<br> ValidationTS(Ti)：事务Ti完成其读阶段并开始其有效性检查阶段的时间<br> FinishTS(Ti)：事务Ti完成其写阶段的时间</p> </blockquote> <p>事务T的有效性检查测试要求满足TS(Tk)&lt;TS(Ti)的所有事务Tk必须满足下面两个条件之一：</p> <ul> <li>FinishTS(Tk)&lt;StartTS(Ti)</li> <li>Tk所写的数据项集合和Ti所读的数据项集合不相交，且Ti开始其有效性检查阶段之前，Tk就完成了其写阶段(StartTS(Ti)&lt;FinishTS(Tk)&lt;ValidationTS(Ti))</li> </ul> <h3 id="多版本机制"><a class="markdownIt-Anchor" href="#多版本机制"></a> 多版本机制</h3> <h4 id="多版本时间戳排序"><a class="markdownIt-Anchor" href="#多版本时间戳排序"></a> 多版本时间戳排序</h4> <p>对于每个数据项Q，存在一个版本序列&lt;Q1,Q2,…,Qm&gt;与之关联，每个Qk包含三个数据字段</p> <ul> <li>Content：Qk版本的值</li> <li>W-timeStamp(Q)：创建Qk版本的事务的时间戳</li> <li>R-timeStamp(Q)：所有成功读取过Qk版本的任意事务的最大时间戳</li> </ul> <p>多版本时间戳排序机制：（Qk是Q的如下版本：写时间戳是小于或等于TS(Ti)的最大写时间戳）</p> <ul> <li>read(Q)：返回Qk版本的值</li> <li>write(Q)： <ul> <li>若TS(Ti)&lt;R-timeStamp(Qk)，系统回滚事务</li> <li>若TS(Ti)=R-timeStamp(Qk)，系统覆盖Qk的内容</li> <li>若TS(Ti)&gt;R-timeStamp(Qk)，创建Q的一个新版本</li> </ul> </li> </ul> <p>不保证可恢复性和无级联性</p> <h4 id="多版本两阶段封锁"><a class="markdownIt-Anchor" href="#多版本两阶段封锁"></a> 多版本两阶段封锁</h4> <ul> <li>结合多版本并发控制和两阶段封锁</li> <li>只在只读事务与更新事务之间进行区分</li> <li>更新事务执行强两阶段封锁</li> </ul> <h3 id="快照隔离"><a class="markdownIt-Anchor" href="#快照隔离"></a> 快照隔离</h3> <ul> <li>事务被给予两个时间戳 <ul> <li>StartTS(Ti)：事务Ti开始的时间</li> <li>CommitTS(Ti)：事务Ti请求有效性检查的时间</li> </ul> </li> </ul> <h4 id="更新事务的有效性检查步骤"><a class="markdownIt-Anchor" href="#更新事务的有效性检查步骤"></a> 更新事务的有效性检查步骤</h4> <p>为了防止更新丢失，快照隔离有两个变种</p> <ul> <li>先提交者胜：第一个进行检查的事务能成功写出更新</li> <li>先更新者胜：第一个获得锁的事务被运行提交并执行更新</li> </ul> <h2 id="恢复系统"><a class="markdownIt-Anchor" href="#恢复系统"></a> 恢复系统</h2> <h3 id="故障分类"><a class="markdownIt-Anchor" href="#故障分类"></a> 故障分类</h3> <ul> <li>事务故障 <ul> <li>逻辑错误：事务由于某些内部情况而无法继续正常执行</li> <li>系统错误：系统进入一种不良状态</li> </ul> </li> <li>系统崩溃：硬件故障，或数据库或操作系统存在漏洞</li> <li>磁盘故障：由于磁头损坏或故障造成磁盘块上内容丢失</li> </ul> <h3 id="恢复与原子性"><a class="markdownIt-Anchor" href="#恢复与原子性"></a> 恢复与原子性</h3> <h4 id="日志记录"><a class="markdownIt-Anchor" href="#日志记录"></a> 日志记录</h4> <ul> <li>更新日志记录&lt;Ti,Xj,V1,V2&gt; <ul> <li>事务标识</li> <li>数据项标识</li> <li>旧值</li> <li>新值</li> </ul> </li> <li>事务开始&lt;Ti start&gt;</li> <li>事务提交&lt;Ti commit&gt;</li> <li>事务中止&lt;Ti abort&gt;</li> </ul> <h4 id="数据库修改"><a class="markdownIt-Anchor" href="#数据库修改"></a> 数据库修改</h4> <ul> <li>延迟修改：一个事务直至提交时都没有修改数据库</li> <li>立即修改：事务仍然活跃时就发生数据库修改</li> <li>撤销操作：使用一条日志记录，将该日志中指定数据项置为日志记录中包含的<strong>旧值</strong></li> <li>重做操作：使用一条日志记录，将该日志中指定数据项置为日志记录中包含的<strong>新值</strong></li> </ul> <h4 id="重做和撤销"><a class="markdownIt-Anchor" href="#重做和撤销"></a> 重做和撤销</h4> <ul> <li> <p>redo(Ti)</p> <ul> <li>将事务Ti更新过所有数据项的值都置为新值</li> <li>重做的执行顺序很重要</li> </ul> </li> <li> <p>undo(Ti)</p> <ul> <li>将事务Ti更新过的所有数据项的值都置为旧值</li> <li>需要写日志记录来记下所执行的更新（read-only日志记录）</li> <li>撤销的执行顺序很重要</li> <li>撤销操作完成后，需要写一条&lt;Ti abort&gt;日志</li> </ul> </li> <li> <p>如果日志中包括&lt;Ti start&gt;，但既不包括&lt;Ti commit&gt;，也不包括&lt;Ti abort&gt;，需要撤销</p> </li> <li> <p>如果日志中包括&lt;Ti start&gt;，同时包括&lt;Ti commit&gt;或&lt;Ti abort&gt;，需要重做</p> </li> </ul> <h4 id="检查点"><a class="markdownIt-Anchor" href="#检查点"></a> 检查点</h4> <ul> <li>检查点的执行过程： <ul> <li>将当前位于主存的所有日志记录输出到稳定存储器</li> <li>将所有修改过的缓冲块输出到磁盘</li> <li>将一条形如&lt;checkpoint L&gt;的日志记录输出到稳定存储器，其中L是执行检查点时正活跃的事务的列表</li> </ul> </li> <li>在系统崩溃后，系统检查日志以找到最后一条&lt;checkpoint L&gt;记录</li> <li>只需对L中的事务，以及&lt;checkpoint L&gt;记录写到日志中之后才开始执行的所有事务进行redo和undo</li> </ul> <h3 id="恢复算法"><a class="markdownIt-Anchor" href="#恢复算法"></a> 恢复算法</h3> <h4 id="事务回滚"><a class="markdownIt-Anchor" href="#事务回滚"></a> 事务回滚</h4> <ul> <li>从后往前扫描日志，对于所发现的Ti的每条形如&lt;Ti,Xj,V1,V2&gt;的日志记录 <ul> <li>将值V1写到数据项Xj</li> <li>往日志中写一条特殊的read-only日志记录&lt;Ti,Xj,V1&gt;，其中V1是在本次回滚中数据项被恢复的值</li> </ul> </li> <li>一旦发现了&lt;Ti start&gt;日志记录，就停止反向扫描，并往日志中写一条&lt;Ti abort&gt;日志记录</li> </ul> <h4 id="系统崩溃后的恢复"><a class="markdownIt-Anchor" href="#系统崩溃后的恢复"></a> 系统崩溃后的恢复</h4> <ul> <li>重做阶段 <ul> <li>将待回滚事务的列表undo-list初始化设定为&lt;checkpoint L&gt;日志记录中的L</li> <li>一旦发现形如&lt;Ti,Xj,V1,V2&gt;或&lt;Ti,Xj,V2&gt;的日志记录，就执行重做</li> <li>一旦发现形如&lt;Ti start&gt;的日志记录，就把Ti加到undo-list中</li> <li>一旦发现形如&lt;Ti abort&gt;或&lt;Ti commit&gt;的日志记录，就把Ti从undo-list中去除</li> <li>在重做阶段的末尾，undo-list中包括了在系统崩溃之前尚未完成的所有事务</li> </ul> </li> <li>撤销阶段 <ul> <li>一旦发现属于undo-list中事务的记录，就执行撤销</li> <li>当系统发现undo-list中事务Ti的&lt;Ti start&gt;日志记录，就往日志中写一条&lt;Ti abort&gt;日志记录，并把Ti从undo-list中去除</li> <li>一旦发现undo-list变为空，则撤销阶段结束</li> </ul> </li> </ul> <h4 id="提交处理的优化"><a class="markdownIt-Anchor" href="#提交处理的优化"></a> 提交处理的优化</h4> <p>使用<strong>组提交</strong>技术可以提高事务提交的速率</p> <h3 id="缓冲区管理"><a class="markdownIt-Anchor" href="#缓冲区管理"></a> 缓冲区管理</h3> <ul> <li>将日志记录写到主存的日志缓冲区中</li> <li>对恢复技术增加 一些额外的要求以保持事务的原子性： <ul> <li>在日志记录&lt;Ti commit&gt;输出到稳定存储器后，事务Ti进入提交状态</li> <li>在日志记录&lt;Ti commit&gt;输出到稳定存储器前，与事务Ti有关的所有日志记录必须已经输出到稳定存储器</li> <li>在主存中的数据块输出到数据库（非易失性存储器）前，与该块中数据有关的所有日志记录必须已经输出到稳定存储器 <ul> <li>这一条规则被称为<strong>先写日志</strong>（WAL）</li> </ul> </li> </ul> </li> <li>将缓冲的日志写到磁盘有时被称为<strong>强制日志</strong></li> </ul> <h3 id="aries"><a class="markdownIt-Anchor" href="#aries"></a> ARIES</h3> <ul> <li>使用<strong>日志序列号</strong>(LSN)来便是日志记录，并将LSN存储在数据库页中</li> <li>支持<strong>物理逻辑重做</strong></li> <li>使用<strong>脏页表</strong>来减少恢复时不必要的重做</li> <li>视同模糊检查点机制</li> </ul> <h4 id="数据结构"><a class="markdownIt-Anchor" href="#数据结构"></a> 数据结构</h4> <ul> <li>日志序列号(LSN) <ul> <li>唯一标识该记录</li> <li>日志记录产生约晚，标号的值越大</li> </ul> </li> <li>日志页序列号(PageLSN) <ul> <li>每当在页面上执行更新操作时，该操作将其日志记录的LSN存储在该页的PageLSN字段中</li> <li>在恢复的重做阶段，LSN值小于等于该页的PageLSN值的任何日志记录将不在该页上执行</li> </ul> </li> <li>PrevLSN <ul> <li>每条日志记录也包含同一事务的前一条日志记录的LSN</li> </ul> </li> <li>补偿日志记录(CLR) <ul> <li>与read-only日志记录的作用相同</li> <li>同时起到operation-abort日志记录的作用</li> </ul> </li> <li>脏页表 <ul> <li>包含一个在数据库缓冲区中已更新过的页面的列表</li> <li>为每一页保存其PageLSN和RecLSN（有助于标识已经实施于该页在磁盘上的版本的日志记录）</li> <li>RecLSN反应出当前页面被加到脏页表中时日志末端的LSN，其应该大于或等于稳定存储器上该页的PageLSN</li> </ul> </li> <li>检查点日志记录 <ul> <li>包含脏页表和活跃事务的列表</li> <li>为每个事务记录其LastLSN（该事务所写的最后一条日志记录的LSN）</li> </ul> </li> </ul> <h4 id="恢复算法-2"><a class="markdownIt-Anchor" href="#恢复算法-2"></a> 恢复算法</h4> <h5 id="分析阶段"><a class="markdownIt-Anchor" href="#分析阶段"></a> 分析阶段</h5> <ul> <li>分析阶段找到最后、已完成的检查点日志记录，并将该记录读入脏页表</li> <li>将RedoLSN设置为脏页表中那些页的RecLSN的最小值 <ul> <li>如果没有脏页，就将RedoLSN设置为检查点日志记录的LSN</li> </ul> </li> <li>从RedoLSN开始扫描日志，将undo-list初始设置为检查点日志记录中的事务列表 <ul> <li>只要找到一条不在undo-list中的事务的日志记录，就把该事务添加到undo-list</li> <li>只要找到一个事务的end记录，就把该事务从undo-list中删除</li> </ul> </li> </ul> <h5 id="重做阶段"><a class="markdownIt-Anchor" href="#重做阶段"></a> 重做阶段</h5> <p>从RedoLSN开始正向扫描日志，只要找到一条更新记录，就：</p> <ul> <li>如果该页不在脏页表中，或该更新日志的LSN小于脏页表中该页的RecLSN，则跳过该记录</li> <li>否则，从磁盘调出该页，如果其PageLSN小于该日志记录的LSN，就重做该记录</li> </ul> <h5 id="撤销阶段"><a class="markdownIt-Anchor" href="#撤销阶段"></a> 撤销阶段</h5> <p>对日志进行反向扫描，对undo-list中的所有事务进行撤销</p> <ul> <li>撤销阶段产生一个包含撤销执行动作的CLR，并将该CLR的UndoNextLSN设定为该更新日志记录的PrevLSN</li> </ul> <h4 id="其他特性"><a class="markdownIt-Anchor" href="#其他特性"></a> 其他特性</h4> <ul> <li>嵌套的顶层动作</li> <li>恢复独立性</li> <li>保存点</li> <li>细粒度封锁</li> <li>恢复最优化</li> </ul> </div> <footer class="article-footer"> <blockquote class="article-copyright"> <p><strong><span class="icon icon-user"></span>Author: </strong>D-Sketon @ 拔剑Sketon</p> <p><strong><span class="icon icon-link"></span>Permalink: </strong><a href="https://d-sketon.github.io/en/20220816/db-book-note/">https://d-sketon.github.io/en/20220816/db-book-note/</a></p> <p><strong><span class="icon icon-copyright"></span>License: </strong>All articles on this blog are licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="nofollow noopener noreferrer" target="_blank"><span class="icon-creative-commons"></span>BY-NC-SA</a> license agreement unless otherwise stated. Please indicate the source when reprinting!</p> <span class="article-copyright-bg icon-creative-commons"></span> </blockquote> <div class="share-wrapper"> <a href="https://connect.qq.com/widget/shareqq/index.html?url=www.baidu.com&amp;title=%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0&amp;desc=%E6%9C%AC%E7%AC%94%E8%AE%B0%E6%95%B4%E7%90%86%E6%9D%A5%E8%87%AA%E4%BA%8E%E3%80%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5%E3%80%8B%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%BC%9A%E6%9C%89%E7%96%8F%E6%BC%8F%E7%9A%84%E9%83%A8%E5%88%86%EF%BC%8C%E6%95%AC%E8%AF%B7%E8%B0%85%E8%A7%A3&amp;source=https%3A%2F%2Fd-sketon.github.io" target="_blank" rel="noopener noreferrer" title="数据库系统概念 学习笔记"> <div class="icon icon-qq share-icon"> </div> </a> <a href="javascript:;" title="数据库系统概念 学习笔记"> <div class="icon icon-weixin share-icon"> <div id="share-weixin"> <div class="share-weixin-dom"> <div class="share-weixin-content"> <img id="share-weixin-banner"> <div id="share-weixin-title"></div> <div id="share-weixin-desc"></div> </div> <div class="share-weixin-qrcode"> <div class="share-weixin-info"> <div id="share-weixin-author"></div> <div id="share-weixin-theme">Powered By hexo-theme-reimu</div> </div> <img id="share-weixin-qr"> </div> </div> <div class="share-weixin-canvas"></div> </div> </div> </a> </div> <a data-aos="zoom-in" href="/en/20220816/db-book-note/#comments" class="article-comment-link"> <span class="post-comments-count waline-comment-count" data-path="/en/20220816/db-book-note/" itemprop="commentCount"></span> Comments </a> <span data-aos="zoom-in" class="article-visitor-link"> <span class="waline-pageview-count" data-path="/en/20220816/db-book-note/">0</span> <em class="post-meta-item-text">Readings</em> </span> <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/en/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag" title="数据库">数据库</a></li></ul> </footer> </div> <nav id="article-nav" aria-label="Article navigation" data-aos="fade-up"> <div class="article-nav-link-wrap left"> <img data-src="https://d-sketon.top/img/_backwebp480/bg28.webp" data-sizes="auto" alt="hexo-minecraft-skin-viewer插件Demo" class="lazyload"> <a href="/en/20220902/hexo-mcskin-demo/" aria-label="Prev: hexo-minecraft-skin-viewer插件Demo" title="Prev: hexo-minecraft-skin-viewer插件Demo"></a> <div class="article-nav-caption">Prev</div> <h3 class="article-nav-title"> hexo-minecraft-skin-viewer插件Demo </h3> </div> <div class="article-nav-link-wrap right"> <img data-src="https://d-sketon.top/img/_backwebp480/bg10.webp" data-sizes="auto" alt="个人博客无用和恶意爬虫整理" class="lazyload"> <a href="/en/20220712/spider-collection/" aria-label="Next: 个人博客无用和恶意爬虫整理" title="Next: 个人博客无用和恶意爬虫整理"></a> <div class="article-nav-caption">Next</div> <h3 class="article-nav-title"> 个人博客无用和恶意爬虫整理 </h3> </div> </nav> </article> <section id="comments" data-aos="fade-up"> <div class="comment-header"> <h2 class="comment-title">Leave a comment</h2> <div class="comment-selector"> <div class="comment-selector-wrap"> <div class="selector-item" data-selector="waline"> <span>waline</span> </div> </div> </div> </div> <div class="comment-content"> <div class="comment waline-comment" data-aos="fade-up" id="waline-comment"> </div> </div> </section> </section> </div> <footer id="footer" aria-label="Site footer"> <div style="width:100%;overflow:hidden"> <div class="footer-line"></div> </div> <div id="footer-info"> <div> <span class="icon-copyright"></span> 2020-2025 <span class="footer-info-sep rotate"></span> D-Sketon </div> <div> Powered by&nbsp;<a href="https://hexo.io/" rel="nofollow noopener noreferrer" target="_blank">Hexo</a>&nbsp; Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="nofollow noopener noreferrer" target="_blank">Reimu</a> </div> <div> <span class="icon-brush"></span> 168.6k &nbsp;|&nbsp; <span class="icon-coffee"></span> 13:38 </div> <div> <span class="icon-eye"></span> <span id="busuanzi_container_site_pv">Number of visits&nbsp;<span id="busuanzi_value_site_pv"></span></span> &nbsp;|&nbsp; <span class="icon-user"></span> <span id="busuanzi_container_site_uv">Number of visitors&nbsp;<span id="busuanzi_value_site_uv"></span></span> </div> </div> </footer> <div class="sidebar-top"> <div class="rotate sidebar-top-taichi"></div> <div class="arrow-up"></div> </div> <div id="mask" class="hide"></div> </div> <nav id="mobile-nav" aria-label="Mobile navigation"> <div class="sidebar-wrap"> <div class="sidebar-toc-sidebar"><h3 class="toc-title">Contents</h3> <div class="sidebar-toc-wrapper toc-div-class"> <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text"> 引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-database"><span class="toc-number">1.1.</span> <span class="toc-text"> 数据库-DataBase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-dbmsdatabase-management-system"><span class="toc-number">1.2.</span> <span class="toc-text"> 数据库管理系统-DBMS（DataBase Management System）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text"> 数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.4.</span> <span class="toc-text"> 数据抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8Binstance%E5%92%8C%E6%A8%A1%E5%BC%8Fschema"><span class="toc-number">1.5.</span> <span class="toc-text"> 实例（instance）和模式（schema）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E8%A8%80"><span class="toc-number">1.6.</span> <span class="toc-text"> 数据库语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80ddl"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 数据定义语言（DDL）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80dml"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 数据操纵语言（DML）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-number">1.7.</span> <span class="toc-text"> SQL 查询语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">1.8.</span> <span class="toc-text"> 数据库设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E"><span class="toc-number">1.9.</span> <span class="toc-text"> 数据库引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">1.10.</span> <span class="toc-text"> 存储管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text"> 查询处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.12.</span> <span class="toc-text"> 事务管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text"> 关系模型介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text"> 关系模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8Fdatabase-schema"><span class="toc-number">2.2.</span> <span class="toc-text"> 数据库模式（database schema）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%AE"><span class="toc-number">2.3.</span> <span class="toc-text"> 键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0relational-algebra"><span class="toc-number">2.4.</span> <span class="toc-text"> 关系代数（relational algebra）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97select"><span class="toc-number">2.4.1.</span> <span class="toc-text"> 选择运算（select）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1%E8%BF%90%E7%AE%97projection"><span class="toc-number">2.4.2.</span> <span class="toc-text"> 投影运算（projection）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E8%BF%90%E7%AE%97product"><span class="toc-number">2.4.3.</span> <span class="toc-text"> 笛卡尔积运算（product）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%90%E7%AE%97join"><span class="toc-number">2.4.4.</span> <span class="toc-text"> 连接运算（join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">2.4.5.</span> <span class="toc-text"> 集合运算</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%A4intersection"><span class="toc-number">2.4.5.1.</span> <span class="toc-text"> 交（intersection）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B6union"><span class="toc-number">2.4.5.2.</span> <span class="toc-text"> 并（union）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%AEdifference"><span class="toc-number">2.4.5.3.</span> <span class="toc-text"> 差（difference）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E5%90%8D%E8%BF%90%E7%AE%97rename"><span class="toc-number">2.4.6.</span> <span class="toc-text"> 更名运算（rename）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97assignment"><span class="toc-number">2.4.7.</span> <span class="toc-text"> 赋值运算（assignment）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E8%BF%90%E7%AE%97aggregation"><span class="toc-number">2.4.8.</span> <span class="toc-text"> 聚合运算（aggregation）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.4.9.</span> <span class="toc-text"> 等价查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text"> SQL介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E7%BB%84%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text"> SQL组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.</span> <span class="toc-text"> 数据定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8"><span class="toc-number">3.3.</span> <span class="toc-text"> 建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8"><span class="toc-number">3.4.</span> <span class="toc-text"> 更新表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.5.</span> <span class="toc-text"> 查询语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97-2"><span class="toc-number">3.6.</span> <span class="toc-text"> 集合运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%80%BC"><span class="toc-number">3.7.</span> <span class="toc-text"> 空值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E5%92%8C%E7%A9%BA%E5%80%BC"><span class="toc-number">3.7.1.</span> <span class="toc-text"> 聚集函数和空值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.8.</span> <span class="toc-text"> 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%88%90%E5%91%98%E8%B5%84%E6%A0%BC"><span class="toc-number">3.8.1.</span> <span class="toc-text"> 集合成员资格</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%AF%94%E8%BE%83"><span class="toc-number">3.8.2.</span> <span class="toc-text"> 集合比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E5%85%B3%E7%B3%BB%E6%B5%8B%E8%AF%95"><span class="toc-number">3.8.3.</span> <span class="toc-text"> 空关系测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E5%85%83%E7%BB%84%E5%AD%98%E5%9C%A8%E6%80%A7%E6%B5%8B%E8%AF%95"><span class="toc-number">3.8.4.</span> <span class="toc-text"> 重复元组存在性测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#from%E5%AD%90%E5%8F%A5%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.8.5.</span> <span class="toc-text"> FROM子句的子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#with%E5%AD%90%E5%8F%A5"><span class="toc-number">3.8.6.</span> <span class="toc-text"> WITH子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2scalar-subquery"><span class="toc-number">3.8.7.</span> <span class="toc-text"> 标量子查询（scalar subquery）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.9.</span> <span class="toc-text"> 删除语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.10.</span> <span class="toc-text"> 插入语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.11.</span> <span class="toc-text"> 修改语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7sql"><span class="toc-number">4.</span> <span class="toc-text"> 中级SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text"> 连接表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5inner-join"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 内连接（inner join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5outer-join"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 外连接（outer join）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 连接条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">4.2.</span> <span class="toc-text"> 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%9B%B4%E6%96%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 视图更新</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">4.3.</span> <span class="toc-text"> 事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.4.</span> <span class="toc-text"> 完整性约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql%E5%9B%BA%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">4.5.</span> <span class="toc-text"> SQL固有属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%BC%BA%E7%9C%81%E5%80%BC"><span class="toc-number">4.6.</span> <span class="toc-text"> 类型转换&amp;缺省值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8Budt%E5%9F%9F"><span class="toc-number">4.7.</span> <span class="toc-text"> 用户自定义类型（UDT）&amp;域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">4.8.</span> <span class="toc-text"> 索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83"><span class="toc-number">4.9.</span> <span class="toc-text"> 授权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%88%E4%BA%88%E4%B8%8E%E6%94%B6%E5%9B%9E"><span class="toc-number">4.9.1.</span> <span class="toc-text"> 权限授予与收回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2"><span class="toc-number">4.9.2.</span> <span class="toc-text"> 角色</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7sql"><span class="toc-number">5.</span> <span class="toc-text"> 高级SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80%E8%AE%BF%E9%97%AEsql"><span class="toc-number">5.1.</span> <span class="toc-text"> 使用程序设计语言访问SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text"> 函数和过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 用于过程和函数的语言结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text"> 触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.4.</span> <span class="toc-text"> 递归查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%90%8D"><span class="toc-number">5.5.</span> <span class="toc-text"> 排名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%AA%97"><span class="toc-number">5.6.</span> <span class="toc-text"> 分窗</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8e-r%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.</span> <span class="toc-text"> 使用E-R模型的数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93-%E8%81%94%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.1.</span> <span class="toc-text"> 实体-联系模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E9%9B%86"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 实体集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 联系集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.3.</span> <span class="toc-text"> 复杂属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%9F%BA%E6%95%B0"><span class="toc-number">6.1.4.</span> <span class="toc-text"> 映射基数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE"><span class="toc-number">6.2.</span> <span class="toc-text"> 主键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E9%9B%86-2"><span class="toc-number">6.2.1.</span> <span class="toc-text"> 实体集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86-2"><span class="toc-number">6.2.2.</span> <span class="toc-text"> 联系集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%AE%9E%E4%BD%93%E9%9B%86"><span class="toc-number">6.2.3.</span> <span class="toc-text"> 弱实体集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E7%9A%84e-r%E7%89%B9%E6%80%A7"><span class="toc-number">6.3.</span> <span class="toc-text"> 扩展的E-R特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E5%8C%96specialization%E6%A6%82%E5%8C%96generalization"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 特化（Specialization）&#x2F;概化（Generalization）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86aggregation"><span class="toc-number">6.3.2.</span> <span class="toc-text"> 聚集（Aggregation）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86e-r%E5%9B%BE%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text"> 将E-R图转换为关系模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.1.</span> <span class="toc-text"> 强实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E5%A4%8D%E6%9D%82%E5%B1%9E%E6%80%A7%E7%9A%84%E5%BC%BA%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.2.</span> <span class="toc-text"> 具有复杂属性的强实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E5%AE%9E%E4%BD%93%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.3.</span> <span class="toc-text"> 弱实体集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E7%B3%BB%E9%9B%86%E7%9A%84%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.4.4.</span> <span class="toc-text"> 联系集的表示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%86%97%E4%BD%99"><span class="toc-number">6.4.5.</span> <span class="toc-text"> 模式的冗余</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%90%88%E5%B9%B6"><span class="toc-number">6.4.6.</span> <span class="toc-text"> 模式的合并</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93-%E8%81%94%E7%B3%BB%E8%AE%BE%E8%AE%A1%E9%97%AE%E9%A2%98"><span class="toc-number">6.5.</span> <span class="toc-text"> 实体-联系设计问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#e-r%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%88%9B%E5%BB%BA%E9%94%99%E8%AF%AF"><span class="toc-number">6.5.1.</span> <span class="toc-text"> E-R图中的创建错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BD%93%E9%9B%86%E8%BF%98%E6%98%AF%E5%B1%9E%E6%80%A7"><span class="toc-number">6.5.2.</span> <span class="toc-text"> 使用实体集还是属性？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BD%93%E9%9B%86%E8%BF%98%E6%98%AF%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.5.3.</span> <span class="toc-text"> 使用实体集还是联系集？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E5%85%83%E8%BF%98%E6%98%AFn%E5%85%83%E8%81%94%E7%B3%BB%E9%9B%86"><span class="toc-number">6.5.4.</span> <span class="toc-text"> 二元还是n元联系集？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.</span> <span class="toc-text"> 关系数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A7%A3"><span class="toc-number">7.1.</span> <span class="toc-text"> 分解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3"><span class="toc-number">7.1.1.</span> <span class="toc-text"> 无损分解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E8%8C%83%E5%8C%96%E7%90%86%E8%AE%BA"><span class="toc-number">7.1.2.</span> <span class="toc-text"> 规范化理论</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E8%BF%9B%E8%A1%8C%E5%88%86%E8%A7%A3"><span class="toc-number">7.2.</span> <span class="toc-text"> 使用函数依赖进行分解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E6%83%AF%E4%BE%8B"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 符号惯例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%AE%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 键和函数依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%AE%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96-2"><span class="toc-number">7.2.2.1.</span> <span class="toc-text"> 键和函数依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B9%B3%E5%87%A1%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.2.</span> <span class="toc-text"> 平凡函数依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%A0%E9%80%92%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.3.</span> <span class="toc-text"> 传递依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.2.4.</span> <span class="toc-text"> 部分依赖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96%E9%9B%86%E7%9A%84%E9%97%AD%E5%8C%85"><span class="toc-number">7.2.3.</span> <span class="toc-text"> 函数依赖集的闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E9%9B%86%E7%9A%84%E9%97%AD%E5%8C%85"><span class="toc-number">7.2.4.</span> <span class="toc-text"> 属性集的闭包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.5.</span> <span class="toc-text"> 保持依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A6%86%E7%9B%96"><span class="toc-number">7.2.6.</span> <span class="toc-text"> 正则覆盖</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-number">7.2.6.1.</span> <span class="toc-text"> 无关属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A6%86%E7%9B%96-2"><span class="toc-number">7.2.6.2.</span> <span class="toc-text"> 正则覆盖</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E6%8D%9F%E5%88%86%E8%A7%A3%E5%92%8C%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96"><span class="toc-number">7.2.7.</span> <span class="toc-text"> 无损分解和函数依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.</span> <span class="toc-text"> 范式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bcnf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.1.</span> <span class="toc-text"> BCNF范式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bcnf%E7%9A%84%E6%A3%80%E6%B5%8B"><span class="toc-number">7.3.1.1.</span> <span class="toc-text"> BCNF的检测</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bcnf%E5%88%86%E8%A7%A3%E7%AE%97%E6%B3%95"><span class="toc-number">7.3.1.2.</span> <span class="toc-text"> BCNF分解算法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3nf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.2.</span> <span class="toc-text"> 3NF范式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3nf%E5%88%86%E8%A7%A3"><span class="toc-number">7.3.2.1.</span> <span class="toc-text"> 3NF分解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1nf%E8%8C%83%E5%BC%8F"><span class="toc-number">7.3.3.</span> <span class="toc-text"> 1NF范式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">8.</span> <span class="toc-text"> 数据存储结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.1.</span> <span class="toc-text"> 文件组织</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E9%95%BF%E8%AE%B0%E5%BD%95"><span class="toc-number">8.1.1.</span> <span class="toc-text"> 定长记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%98%E9%95%BF%E8%AE%B0%E5%BD%95"><span class="toc-number">8.1.2.</span> <span class="toc-text"> 变长记录</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%A7%BD%E7%9A%84%E9%A1%B5%E7%BB%93%E6%9E%84"><span class="toc-number">8.1.2.1.</span> <span class="toc-text"> 分槽的页结构</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8"><span class="toc-number">8.1.3.</span> <span class="toc-text"> 大对象存储</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AE%B0%E5%BD%95%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.</span> <span class="toc-text"> 文件中记录的组织</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 堆文件组织</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E7%94%B1%E7%A9%BA%E9%97%B4%E5%9B%BE"><span class="toc-number">8.2.1.1.</span> <span class="toc-text"> 自由空间图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.2.</span> <span class="toc-text"> 顺序文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%81%9A%E7%B0%87%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.3.</span> <span class="toc-text"> 多表聚簇文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.4.</span> <span class="toc-text"> B+树文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87"><span class="toc-number">8.2.5.</span> <span class="toc-text"> 哈希文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%92%E5%88%86"><span class="toc-number">8.2.6.</span> <span class="toc-text"> 划分</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%E5%AD%98%E5%82%A8"><span class="toc-number">8.3.</span> <span class="toc-text"> 数据字典存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">8.4.</span> <span class="toc-text"> 数据库缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">8.4.1.</span> <span class="toc-text"> 缓冲区管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A2%AB%E9%92%89%E4%BD%8F%E7%9A%84%E5%9D%97"><span class="toc-number">8.4.1.1.</span> <span class="toc-text"> 被钉住的块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E4%B8%8A%E7%9A%84%E5%85%B1%E4%BA%AB%E6%8E%92%E5%AE%83%E9%94%81"><span class="toc-number">8.4.1.2.</span> <span class="toc-text"> 缓冲区上的共享排它锁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%9B%BF%E6%8D%A2%E7%AD%96%E7%95%A5"><span class="toc-number">8.4.2.</span> <span class="toc-text"> 缓冲区替换策略</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-2"><span class="toc-number">9.</span> <span class="toc-text"> 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.</span> <span class="toc-text"> 顺序索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%A0%E5%AF%86%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.1.</span> <span class="toc-text"> 稠密索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A8%80%E7%96%8F%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.2.</span> <span class="toc-text"> 稀疏索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.3.</span> <span class="toc-text"> 多级索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%9B%B4%E6%96%B0"><span class="toc-number">9.1.4.</span> <span class="toc-text"> 索引更新</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%92%E5%85%A5"><span class="toc-number">9.1.4.1.</span> <span class="toc-text"> 插入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">9.1.4.2.</span> <span class="toc-text"> 删除</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">9.1.5.</span> <span class="toc-text"> 辅助索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E6%A0%91%E7%B4%A2%E5%BC%95"><span class="toc-number">9.2.</span> <span class="toc-text"> B+树索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-number">9.2.1.</span> <span class="toc-text"> B+树结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%B6%E8%8A%82%E7%82%B9"><span class="toc-number">9.2.1.1.</span> <span class="toc-text"> 叶节点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.2.2.</span> <span class="toc-text"> B+树的查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E6%8F%92%E5%85%A5"><span class="toc-number">9.2.3.</span> <span class="toc-text"> B+树的插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">9.2.4.</span> <span class="toc-text"> B+树的删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E5%94%AF%E4%B8%80%E6%80%A7%E6%90%9C%E7%B4%A2%E7%A0%81"><span class="toc-number">9.2.5.</span> <span class="toc-text"> 非唯一性搜索码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b%E6%A0%91%E6%89%A9%E5%B1%95"><span class="toc-number">9.3.</span> <span class="toc-text"> B+树扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%BB%84%E7%BB%87-2"><span class="toc-number">9.3.1.</span> <span class="toc-text"> B+树文件组织</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%E5%92%8C%E8%AE%B0%E5%BD%95%E9%87%8D%E5%88%86%E9%85%8D"><span class="toc-number">9.3.2.</span> <span class="toc-text"> 辅助索引和记录重分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">9.3.3.</span> <span class="toc-text"> 对字符串的索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b%E6%A0%91%E6%96%87%E4%BB%B6%E7%B4%A2%E5%BC%95"><span class="toc-number">9.3.4.</span> <span class="toc-text"> B树文件索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%A3%E5%88%97%E7%B4%A2%E5%BC%95"><span class="toc-number">9.4.</span> <span class="toc-text"> 散列索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95"><span class="toc-number">9.5.</span> <span class="toc-text"> 位图索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text"> 查询处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BB%A3%E4%BB%B7%E7%9A%84%E5%BA%A6%E9%87%8F"><span class="toc-number">10.1.</span> <span class="toc-text"> 查询代价的度量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97"><span class="toc-number">10.2.</span> <span class="toc-text"> 选择运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">10.3.</span> <span class="toc-text"> 排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E6%8E%92%E5%BA%8F-%E5%BD%92%E5%B9%B6%E7%AE%97%E6%B3%95"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 外排序-归并算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E6%8E%92%E5%BA%8F-%E5%BD%92%E5%B9%B6%E7%9A%84%E4%BB%A3%E4%BB%B7%E8%AE%A1%E7%AE%97"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 外排序-归并的代价计算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%BF%90%E7%AE%97"><span class="toc-number">10.4.</span> <span class="toc-text"> 连接运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.1.</span> <span class="toc-text"> 嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%97%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.2.</span> <span class="toc-text"> 块嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%B5%8C%E5%A5%97-%E5%BE%AA%E7%8E%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.3.</span> <span class="toc-text"> 索引嵌套-循环连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%92%E5%B9%B6-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.4.</span> <span class="toc-text"> 归并-连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E5%88%86%E6%9E%90"><span class="toc-number">10.4.4.1.</span> <span class="toc-text"> 代价分析</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E5%BD%92%E5%B9%B6-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.5.</span> <span class="toc-text"> 混合归并-连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%A3%E5%88%97-%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.4.6.</span> <span class="toc-text"> 散列-连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E5%88%86%E6%9E%90-2"><span class="toc-number">10.4.6.1.</span> <span class="toc-text"> 代价分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%BF%90%E7%AE%97"><span class="toc-number">10.5.</span> <span class="toc-text"> 其他运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D"><span class="toc-number">10.5.1.</span> <span class="toc-text"> 去重</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1"><span class="toc-number">10.5.2.</span> <span class="toc-text"> 投影</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97-3"><span class="toc-number">10.5.3.</span> <span class="toc-text"> 集合运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">10.5.4.</span> <span class="toc-text"> 外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86"><span class="toc-number">10.5.5.</span> <span class="toc-text"> 聚集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%89%A7%E8%A1%8C"><span class="toc-number">10.6.</span> <span class="toc-text"> 表达式执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E5%8C%96"><span class="toc-number">10.6.1.</span> <span class="toc-text"> 物化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-number">10.6.2.</span> <span class="toc-text"> 流水线</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.6.2.1.</span> <span class="toc-text"> 流水线的实现</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-2"><span class="toc-number">11.</span> <span class="toc-text"> 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">11.1.</span> <span class="toc-text"> 一个简单的事务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E5%92%8C%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-number">11.2.</span> <span class="toc-text"> 事务的原子性和持久性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="toc-number">11.3.</span> <span class="toc-text"> 事务的隔离性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">11.4.</span> <span class="toc-text"> 可串行化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E5%92%8C%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">11.5.</span> <span class="toc-text"> 事务的隔离性和原子性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E6%81%A2%E5%A4%8D%E8%B0%83%E5%BA%A6"><span class="toc-number">11.5.1.</span> <span class="toc-text"> 可恢复调度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%BA%A7%E8%81%94%E8%B0%83%E5%BA%A6"><span class="toc-number">11.5.2.</span> <span class="toc-text"> 无级联调度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E7%BA%A7%E5%88%AB"><span class="toc-number">11.6.</span> <span class="toc-text"> 事务的隔离性级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">12.</span> <span class="toc-text"> 并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E9%94%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.</span> <span class="toc-text"> 基于锁的协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">12.1.1.</span> <span class="toc-text"> 锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E9%98%B6%E6%AE%B5%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.2.</span> <span class="toc-text"> 两阶段封锁协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">12.1.3.</span> <span class="toc-text"> 封锁的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.1.3.1.</span> <span class="toc-text"> 基于图的协议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E5%A4%84%E7%90%86"><span class="toc-number">12.2.</span> <span class="toc-text"> 死锁处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E9%A2%84%E9%98%B2"><span class="toc-number">12.2.1.</span> <span class="toc-text"> 死锁预防</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E6%A3%80%E6%B5%8B"><span class="toc-number">12.2.2.</span> <span class="toc-text"> 死锁检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E6%81%A2%E5%A4%8D"><span class="toc-number">12.2.3.</span> <span class="toc-text"> 死锁恢复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%B2%92%E5%BA%A6"><span class="toc-number">12.3.</span> <span class="toc-text"> 多粒度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.4.</span> <span class="toc-text"> 基于时间戳的协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">12.4.1.</span> <span class="toc-text"> 时间戳</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E6%8E%92%E5%BA%8F%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.4.2.</span> <span class="toc-text"> 时间戳排序协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#thomas%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">12.4.3.</span> <span class="toc-text"> Thomas写规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%9C%89%E6%95%88%E6%80%A7%E6%A3%80%E6%9F%A5%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.5.</span> <span class="toc-text"> 基于有效性检查的协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E6%9C%BA%E5%88%B6"><span class="toc-number">12.6.</span> <span class="toc-text"> 多版本机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E6%97%B6%E9%97%B4%E6%88%B3%E6%8E%92%E5%BA%8F"><span class="toc-number">12.6.1.</span> <span class="toc-text"> 多版本时间戳排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E4%B8%A4%E9%98%B6%E6%AE%B5%E5%B0%81%E9%94%81"><span class="toc-number">12.6.2.</span> <span class="toc-text"> 多版本两阶段封锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E9%9A%94%E7%A6%BB"><span class="toc-number">12.7.</span> <span class="toc-text"> 快照隔离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7%E6%A3%80%E6%9F%A5%E6%AD%A5%E9%AA%A4"><span class="toc-number">12.7.1.</span> <span class="toc-text"> 更新事务的有效性检查步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%B3%BB%E7%BB%9F"><span class="toc-number">13.</span> <span class="toc-text"> 恢复系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E5%88%86%E7%B1%BB"><span class="toc-number">13.1.</span> <span class="toc-text"> 故障分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%80%A7"><span class="toc-number">13.2.</span> <span class="toc-text"> 恢复与原子性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">13.2.1.</span> <span class="toc-text"> 日志记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%AE%E6%94%B9"><span class="toc-number">13.2.2.</span> <span class="toc-text"> 数据库修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%81%9A%E5%92%8C%E6%92%A4%E9%94%80"><span class="toc-number">13.2.3.</span> <span class="toc-text"> 重做和撤销</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%82%B9"><span class="toc-number">13.2.4.</span> <span class="toc-text"> 检查点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95"><span class="toc-number">13.3.</span> <span class="toc-text"> 恢复算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9E%E6%BB%9A"><span class="toc-number">13.3.1.</span> <span class="toc-text"> 事务回滚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%B4%A9%E6%BA%83%E5%90%8E%E7%9A%84%E6%81%A2%E5%A4%8D"><span class="toc-number">13.3.2.</span> <span class="toc-text"> 系统崩溃后的恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E5%A4%84%E7%90%86%E7%9A%84%E4%BC%98%E5%8C%96"><span class="toc-number">13.3.3.</span> <span class="toc-text"> 提交处理的优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">13.4.</span> <span class="toc-text"> 缓冲区管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aries"><span class="toc-number">13.5.</span> <span class="toc-text"> ARIES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">13.5.1.</span> <span class="toc-text"> 数据结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95-2"><span class="toc-number">13.5.2.</span> <span class="toc-text"> 恢复算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.1.</span> <span class="toc-text"> 分析阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E5%81%9A%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.2.</span> <span class="toc-text"> 重做阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E9%98%B6%E6%AE%B5"><span class="toc-number">13.5.2.3.</span> <span class="toc-text"> 撤销阶段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%89%B9%E6%80%A7"><span class="toc-number">13.5.3.</span> <span class="toc-text"> 其他特性</span></a></li></ol></li></ol></li></ol> </div> </div> <div class="hidden sidebar-common-sidebar"><div class="sidebar-author"> <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="D-Sketon" class="lazyload"> <div class="sidebar-author-name">D-Sketon</div> <div class="sidebar-description">D-Sketon&#39;s blog</div> </div> <div class="sidebar-state"> <div class="sidebar-state-article"> <div>Post</div> <div class="sidebar-state-number">74</div> </div> <div class="sidebar-state-category"> <div>Category</div> <div class="sidebar-state-number">10</div> </div> <div class="sidebar-state-tag"> <div>Tag</div> <div class="sidebar-state-number">20</div> </div> </div> <div class="sidebar-social"> <div class="icon-github sidebar-social-icon"> <a href="https://github.com/D-Sketon" itemprop="url" target="_blank" aria-label="github" rel="nofollow noopener noreferrer"></a> </div> <div class="icon-bilibili sidebar-social-icon"> <a href="https://space.bilibili.com/20339857" itemprop="url" target="_blank" aria-label="bilibili" rel="nofollow noopener noreferrer"></a> </div> </div> <div class="sidebar-menu"> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/" aria-label="Home"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Home</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/archives" aria-label="Archives"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Archives</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/about" aria-label="About"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">About</div> </div> <div class="sidebar-menu-link-wrap"> <a class="sidebar-menu-link-dummy" href="/en/friend" aria-label="Friend"></a> <div class="icon rotate sidebar-menu-icon"> &#xe62b; </div> <div class="sidebar-menu-link">Friend</div> </div> </div> </div> </div> <div class="sidebar-btn-wrapper"> <div class="current sidebar-toc-btn"></div> <div class="sidebar-common-btn"></div> </div> </nav> </div> <div class="site-search"> <div class="popup reimu-popup"> <div class="reimu-search"> <div class="reimu-search-input-icon"></div> <div id="reimu-search-input"></div> <div class="popup-btn-close"></div> </div> <div class="reimu-results"> <div id="reimu-stats"></div> <div id="reimu-hits"></div> <div id="reimu-pagination" class="reimu-pagination"></div> </div> <img class="reimu-bg" src="/images/reimu.png"> </div> </div> <script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin></script> <script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin></script> <script src="/js/script.js"></script> <script src="/js/aos.js"></script> <script>var aosInit=()=>{AOS.init({duration:1e3,easing:'ease',once:!0,offset:50})};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',aosInit):aosInit();</script> <script src="/js/pjax_script.js" data-pjax></script> <script>var ALGOLIA_CONFIG={logo:'/images/algolia_logo.svg',algolia:{applicationID:'AIE5T9AKYQ',apiKey:'2b855b06a058dd80bc84972874e020aa',indexName:'reimu_new_algoliasearch',hits:{per_page:parseInt('10')},labels:{input_placeholder:'Search.....',hits_empty:'No results found for 「${query}」',hits_stats:'Found ${hits} results (in ${time} ms)'}}};</script> <script src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js" integrity="sha384-xvLS0jfKuoREs7pqkRI&#x2F;OI8GcqohO5S+jQz7ZBtQXnsXmD+9jDOOY4cL6dCPzlrk" crossorigin defer></script> <script src="https://npm.webcache.cn/@reimujs/instantsearch.js@4.57.0-beta.1/dist/instantsearch.production.min.js" integrity="sha384-aagKMe8nkqaP2DYQc8kkYOL5l+M5Q2WH&#x2F;Uhr4teOh0Ybp0RZj0kUSDm45qPikMjK" crossorigin defer></script> <script src="/js/algolia_search.js" defer></script> <script src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js" integrity="sha384-8LyaidD9GPxQQgLJO&#x2F;WRw&#x2F;O2h3BoNq&#x2F;ApI&#x2F;ecpvM6RsrCz2qP2ppBXUKihP4V&#x2F;2d" crossorigin></script> <script>window.firework&&window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["var(--red-0)"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'));</script> <script src="https://npm.webcache.cn/theme-shokax-pjax@0.0.3/dist/index.umd.js" integrity="sha384-xneY1WY8hOfUzswrE4CrYq35N4BdVcxqxwHPr9zawE&#x2F;jMSCxD+jAPU55x&#x2F;jj3wlf" crossorigin></script> <script src="/js/pjax.js"></script> <div id="lazy-script"> <div> <script data-pjax>window.REIMU_POST={author:'D-Sketon',title:'数据库系统概念 学习笔记',url:'https://d-sketon.github.io/20220816/db-book-note/',excerpt:'本笔记整理来自于《数据库系统概念》，可能会有疏漏的部分，敬请谅解',description:'本笔记整理来自于《数据库系统概念》，可能会有疏漏的部分，敬请谅解',stripContent:' 引言  数据库-DataBase  一个互相关联的数据的集合 大多数计算机应用程序的核心组件   数据库管理系统-DBMS（DataBase Management System）  一个互相关联的数据集合 访问这些数据的一组程序 提供了一种既方便又高效的存储和检索数据库信息的方法 由多个用户和应用程序访问   数据模型  关系模型  用表的集合来表述数据和数据间的联系   实体-联系（E-R）模型  使用称作实体的基本对象的集合，以及这些对象间的关系   半结构化数据模型  允许在其数据定义中',date:'Tue Aug 16 2022 15:48:09 GMT+0800',updated:'Sun Feb 02 2025 11:35:48 GMT+0800',cover:'/images/banner.webp'};</script> <script src="/js/insert_highlight.js" data-pjax></script> <script src="https://npm.webcache.cn/@zumer/snapdom@1.9.9/dist/snapdom.min.js" integrity="sha384-taz9Bq0wPqLsuiB4ix4blTozt&#x2F;y84cjbMX5ZWkfPPjpVBme8M&#x2F;jWopanNBcdH&#x2F;qp" crossorigin defer data-pjax></script> <script src="https://npm.webcache.cn/qrcode@1.5.1/build/qrcode.js" integrity="sha384-VT1EeewTCEXgndcPMQ0PzV+uVFYjxFIjmAA7s5gcMX9t4Dt5TD+OVQIn7NJWIXn7" crossorigin defer data-pjax></script> <script type="module" data-pjax>let PhotoSwipeLightbox=(await safeImport('https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js','sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/')).default,initPswp=(gallery,children)=>{0<_$$(gallery+' '+children).length&&new PhotoSwipeLightbox({gallery:gallery,children:children,pswpModule:()=>safeImport('https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js','sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s')}).init()},pswp=()=>{initPswp('.article-entry','a.article-gallery-item'),initPswp('.article-gallery','a.article-gallery-item'),window.lightboxStatus='done',window.removeEventListener('lightbox:ready',pswp)};'ready'===window.lightboxStatus?pswp():window.addEventListener('lightbox:ready',pswp);</script> <script data-pjax>var savedCommentType,configDefault,loadScript=(src,integrity)=>{var script=document.createElement('script');return script.src=src,integrity&&(script.integrity=integrity),script.crossOrigin='anonymous',script},commentConfigKeys=['waline'],commentConfig={waline:{enable:!0,load:async()=>{var container=document.querySelector('.waline-comment');container&&(container.style.display='block',container=(await safeImport('https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.mjs','sha384-9sbqJjrfGjbkI6/PI4nU/MvBfEmkkPC4YK9I4zBeMIf1CVCZdCMH/KinBEAZII/5')).init,window.walineInstance=container({el:'.waline-comment',serverURL:'https://reimu.d-sketon.top',lang:document.documentElement.lang||'en',locale:{},emoji:['https://unpkg.com/@waline/emojis@1.2.0/weibo','https://unpkg.com/@waline/emojis@1.2.0/alus','https://unpkg.com/@waline/emojis@1.2.0/bilibili','https://unpkg.com/@waline/emojis@1.2.0/qq','https://unpkg.com/@waline/emojis@1.2.0/tieba','https://unpkg.com/@waline/emojis@1.2.0/tw-emoji'],meta:['nick','mail','link'],requiredMeta:['nick','mail'],wordLimit:JSON.parse('0'),comment:!0,pageSize:JSON.parse('10'),dark:'html[data-theme="dark"]',pageview:JSON.parse('true')}))}}},defaultComment=(commentConfig.enable=commentConfigKeys.some(key=>commentConfig[key].enable),'');function loadComments(){if(commentConfig.enable){let loadedComments={valine:!1,waline:!1,twikoo:!1,gitalk:!1,giscus:!1},hideAllComments=()=>{document.querySelectorAll('.comment').forEach(container=>{container.style.display='none'})},loadCommentSystem=type=>{loadedComments[type]?document.querySelector(`.${type}-comment`).style.display='block':(commentConfig[type]?.load(),loadedComments[type]=!0)};var commentInit=()=>{var defaultSelectorItem;for(let item of document.querySelectorAll('.selector-item'))item.addEventListener('click',()=>{var commentType=item.getAttribute('data-selector');window.localStorage.setItem('commentType',commentType),(item=>{var commentItems=document.querySelectorAll('.selector-item');for(let i=0;i<commentItems.length;i++)commentItems[i].classList.remove('active');item.classList.add('active');item=item.getAttribute('data-selector');hideAllComments(),loadCommentSystem(item)})(item)});defaultComment&&(defaultSelectorItem=document.querySelector(`[data-selector="${defaultComment}"]`))&&(defaultSelectorItem.style.display='block',defaultSelectorItem.classList.add('active'),loadCommentSystem(defaultComment))};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',commentInit):commentInit()}}commentConfig.enable&&(savedCommentType=localStorage.getItem('commentType'),(defaultComment=savedCommentType&&commentConfig[savedCommentType]?.enable?savedCommentType:defaultComment)||commentConfig[configDefault='waline']?.enable&&(defaultComment=configDefault),defaultComment=defaultComment||commentConfigKeys.find(sys=>commentConfig[sys].enable)||''),loadComments();</script> </div> </div> <script>console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;'),console.log('%c Theme.Reimu v1.10.0 %c https://github.com/D-Sketon/hexo-theme-reimu ','color: white; background: #ff5252; padding:5px 0;','padding:4px;border:1px solid #ff5252;');</script> <script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin async></script> <script>'serviceWorker'in navigator&&navigator.serviceWorker.getRegistrations().then(registrations=>{for(var registration of registrations)registration.unregister()});</script> <script src="https://npm.webcache.cn/aplayer@1.10.1/dist/APlayer.min.js" integrity="sha384-gdGYZwHnfJM54evoZhpO0s6ZF5BQiybkiyW7VXr+h5UfruuRL&#x2F;aORyw+5+HZoU6e" crossorigin></script> <script>var meting_api='https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r';</script> <script>if(window.matchMedia('(max-width: 959px)').matches){let meting=_$('meting-js');if(meting){meting.setAttribute('fixed','true');let aside=meting.parentNode?.parentNode;'ASIDE'===aside?.tagName&&(meting.parentNode.removeChild(meting),document.body.appendChild(meting))}}</script> <script src="https://npm.webcache.cn/meting@2.0.1/dist/Meting.min.js" integrity="sha384-ASVlpKF80A22OXTK3tfEjZm1EL6uFMKIC4p8+0maanw1S&#x2F;IyB+Y4JG+ZDU7GpKE8" crossorigin></script> <script data-pjax>setTimeout(()=>{var e,echartsList=Object.keys(window).filter(e=>e.startsWith('eChartecharts')&&!e.endsWith('ResizeHandler')).map(e=>window[e]),updateEchartsDarkMode=e=>{if(echartsList?.length)for(var t of echartsList)t?.setTheme('dark'===e?'dark':'default')},_emode=(document.body.addEventListener('dark-theme-set',()=>updateEchartsDarkMode('dark')),document.body.addEventListener('light-theme-set',()=>updateEchartsDarkMode('default')),localStorage.getItem('dark_mode'));'auto'===_emode?(e=window.matchMedia('(prefers-color-scheme: dark)').matches,updateEchartsDarkMode(e?'dark':'default')):updateEchartsDarkMode('true'===_emode?'dark':'default')},2e3);</script> </body></html>